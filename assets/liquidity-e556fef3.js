import{_ as Y,a as ee,b as oe}from"./AppDescriptionTop-95ed4564.js";import{s as ae,_ as te}from"./swap-circle-51fd3f38.js";import{_ as ne}from"./SelectToken.vue_vue_type_script_setup_true_lang-d0e8a789.js";import{s as se,u as le,w as G,x as ie,y as ce,z as ue,v as k,B as re,C as O,ax as P,a6 as M,aF as x,Q as de,I as F,aG as pe,V as me,W as _e,H as fe,G as ke,o as C,i as D,j as l,Z as c,$ as j,a3 as e,ay as ge,ad as X,a1 as z,a0 as L,a2 as s,a5 as f,a4 as ve,a7 as W,a8 as K,az as we,aA as ye,aB as Te,a9 as he,aC as Be,_ as Se}from"./index-23dcd2e9.js";import{o as be}from"./common-21d1f462.js";import{u as Z}from"./swap-76fa729f.js";import"./PoolsListItem.vue_vue_type_script_setup_true_lang-cb659dd1.js";import"./associatedTokenAccount-85f34be0.js";const Ae=se("liquidity",()=>{const q=le(),v=G(),o=ie(),{publicKey:h}=ce(),{notify:y}=ue(),T=Z(),t=k(()=>T.tokenSwap),n=k(()=>T.state),S=k(()=>T.swapClient),a=re({slippageDialog:!1,swapping:!1,active:!1,slippage:.01,rate:0,maxTokenB:0,amountTokenA:0,amountTokenB:0});O([()=>n.value.direction,()=>n.value.from.amount,()=>n.value.poolBalance],async()=>{const u=Number(a.amountTokenA??0),r=P(Number(n.value.poolBalance[n.value.from.mint]??0),n.value.from.decimals),p=P(Number(n.value.poolBalance[n.value.to.mint]??0),n.value.to.decimals);if(u===0||Number.isNaN(u)){a.amountTokenB=0,a.rate=Number(p)/Number(r),a.maxTokenB=0;return}const d=p-r*p/(r+u);a.rate=u?d/u:p/r,a.amountTokenB=d?Number(M(d*(1-n.value.fees.ownerTrade-n.value.fees.trade),n.value.to.decimals)):0,a.maxTokenB=x(a.amountTokenB+a.amountTokenB*a.slippage,n.value.to.decimals)},{immediate:!0});function i(){T.loadPoolTokenAccounts(),a.amountTokenA=0,a.amountTokenB=0}async function H(){if(!v.certificateValid)return de();if(!t.value||!h.value){console.log("TokenSwap is not initialized...");return}o.value.publicKey||y({type:"info",message:"Please connect your wallet first"});const r=Number(x(a.amountTokenA??0,n.value.from.decimals)),p=Number(x(v.tokenBalance(n.value.from.mint)??0,n.value.from.decimals)),d=Number(x(a.amountTokenB??0,n.value.to.decimals));if(r>p){y({type:"negative",message:"Insufficient balance."});return}try{a.swapping=!0;const m=n.value.direction===0?t.value.data.tokenAMint:t.value.data.tokenBMint,g=n.value.direction===0?t.value.data.tokenBMint:t.value.data.tokenAMint,$=n.value.direction===0?t.value.data.tokenA:t.value.data.tokenB,I=n.value.direction===0?t.value.data.tokenB:t.value.data.tokenA;console.log("userSourceMint = ",m.toBase58()),console.log("userDestinationMint = ",g.toBase58()),console.log("userSourceMint = ",m.toBase58()),console.log("userDestinationMint = ",g.toBase58());const b=await F(m,o.value.publicKey),Q=await F(g,o.value.publicKey),B=r;console.log("toAmount = ",d),console.log("slippage = ",a.slippage),console.log("slippage 2 = ",d*a.slippage);const w=S.value.swapAuthority(t.value.pubkey);console.log("proofRequest = ",v.certificate?.pubkey.toBase58()),console.log("swapAuthority = ",w),console.log("tokenSwap = ",t.value.pubkey.toBase58()),console.log("userSource = ",b.toBase58()),console.log("userDestination = ",Q.toBase58()),console.log("poolSource = ",$.toBase58()),console.log("poolDestination = ",I.toBase58()),console.log("poolMint = ",t.value.data.poolMint.toBase58()),console.log("poolFee = ",t.value.data.poolFeeAccount.toBase58()),console.log("amountIn = ",B),console.log("maxTokenB = ",a.maxTokenB);const _=await S.value.swap({proofRequest:v.certificate?.pubkey,authority:w,tokenSwap:t.value.pubkey,userSource:b,userDestination:Q,poolSource:$,poolDestination:I,poolMint:t.value.data.poolMint,poolFee:t.value.data.poolFeeAccount,amountIn:B,minimumAmountOut:a.maxTokenB,sourceTokenMint:m,destinationTokenMint:g},{commitment:"confirmed"});pe(`https://explorer.solana.com/tx/${_}?cluster=${q.cluster}`),i()}catch(m){console.log(m)}finally{a.swapping=!1}}async function N(){if(!t.value||!h.value){console.log("TokenSwap is not initialized...");return}const u=n.value.direction===0?t.value.data.tokenAMint:t.value.data.tokenBMint,r=await F(u,o.value.publicKey),p=await F(t.value.data.poolMint,o.value.publicKey),d=Number(x(a.amountTokenA??0,n.value.from.decimals)),m=await S.value.depositSingleTokenTypeExactAmountIn({tokenSwap:t.value?.pubkey,poolMint:t.value.data.poolMint,source:r,destination:p,swapTokenA:t.value.data.tokenA,swapTokenB:t.value.data.tokenB,sourceTokenAmount:d,minimumPoolTokenAmount:0});i(),y({message:"Transaction confirmed",type:"positive",actions:[{label:"Explore",color:"white",target:"_blank",href:`https://explorer.solana.com/tx/${m}?cluster=${q.cluster}`,onClick:()=>!1}]})}function R(){a.slippageDialog=!0}function V(){a.slippageDialog=!1}return{state:a,closeSlippage:V,openSlippage:R,addLiquiditySubmit:H,depositSingleToken:N}}),xe={class:"swap-form"},Me={class:"swap-field"},Ce={class:"swap-field__info"},De={class:"row items-end"},qe=s("div",{class:"col swap-field__label"},null,-1),Ne={class:"col-8 col-xs-10 row justify-end swap-field__balance"},Ve={key:0,class:"insufficient-error"},$e={class:"swap-change"},Ie=["innerHTML"],Qe={class:"swap-field"},Fe={class:"swap-field__info q-mt-sm"},Le={class:"row"},Ke={class:"col swap-field__balance"},Pe={class:"swap-submit q-mt-lg"},He={key:0,class:"text-weight-medium fs-13 text-center q-mt-md text-negative"},Re={key:1,class:"row q-mt-md text-center relative-position full-width"},ze={class:"absolute-right swap-rate__refresh"},Ue={class:"swap-info q-mt-lg"},Ee=me({__name:"DepositSingleCard",setup(q){const v=Z(),{state:o,loadingPoolTokens:h,changeDirection:y,openSlippage:T,closeSlippage:t,setMax:n,loadPoolTokenAccounts:S}=v,a=k(()=>v.tokenSwap),U=Ae(),{state:i,depositSingleToken:H}=U,{handleSearchToken:N,handleFilterToken:R,tokens:V}=_e();R(fe);const u=G(),r=k(()=>o.poolBalance[o.from.mint]?P(o.poolBalance[o.from.mint],o.from.decimals):0),p=k(()=>o.poolBalance[o.to.mint]?P(o.poolBalance[o.to.mint],o.to.decimals):0),d=ke(0),m=k(()=>`transform: rotate(${d.value*180}deg)`),g=k(()=>u.tokenBalance(o.from.mint)),$=k(()=>u.tokenBalance(o.to.mint));function I(){y(),d.value++}function b(w,_){o[_?"to":"from"]=w}function Q(){n(g.value)}const B=k(()=>Number(i.amountTokenA)>g.value?"Insufficient funds":!1);return O([()=>i.amountTokenA,a,g],w=>{i.active=!B.value}),(w,_)=>{const E=ne,J=te;return C(),D(X,null,[l(j,{class:"swap-card swap-widget"},{default:c(()=>[l(z,{class:"swap-card__header"},{default:c(()=>[L(" Liquidity ")]),_:1}),l(z,{class:"swap-card__body"},{default:c(()=>[s("div",xe,[s("div",Me,[s("div",Ce,[s("div",De,[qe,s("div",Ne,[e(B)?(C(),D("div",Ve,f(e(B)),1)):ve("",!0),L(" Balance: "+f(e(M)(e(g)))+" "+f(e(o).from.symbol),1)])])]),l(W,{modelValue:e(i).amountTokenA,"onUpdate:modelValue":_[0]||(_[0]=A=>e(i).amountTokenA=A),maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input",onKeypress:e(be)},{append:c(()=>[l(K,{dense:"",unelevated:"",ripple:!1,class:"swap-input__max",onClick:Q},{default:c(()=>[L(" MAX ")]),_:1}),l(E,{options:e(V),token:e(o).from,"swap-token":String(e(o).to.symbol),onHandleSearchToken:e(N),onSetToken:b},null,8,["options","token","swap-token","onHandleSearchToken"])]),_:1},8,["modelValue","onKeypress"])]),s("div",$e,[l(K,{ripple:!1,dense:"",unelevated:"",style:we(e(m)),onClick:I},{default:c(()=>[s("i",{innerHTML:e(ae)},null,8,Ie)]),_:1},8,["style"])]),s("div",Qe,[s("div",Fe,[s("div",Le,[s("div",Ke," Balance: "+f(e(M)(e($)))+" "+f(e(o).to.symbol),1)])]),l(W,{readonly:"",maxlength:14,outlined:"",class:"swap-input"},{append:c(()=>[l(E,{"swap-token":String(e(o).from.symbol),options:e(V),direction:!0,token:e(o).to,"destination-unavailable":!e(a),onHandleSearchToken:e(N),onSetToken:b},null,8,["swap-token","options","token","destination-unavailable","onHandleSearchToken"])]),_:1})])]),l(J,{class:"q-mt-md"}),s("div",Pe,[l(K,{loading:e(i).swapping,disable:!e(i).active||!e(a),rounded:"",ripple:!1,onClick:e(H)},{default:c(()=>[L(" Add Liquidity ("+f(e(o).from.symbol)+") ",1)]),_:1},8,["loading","disable","onClick"])]),e(a)?(C(),D("div",Re,[s("div",ze,[l(K,{loading:e(h),class:"swap-card__reload",unelevated:"",color:w.$q.dark.isActive?"white":"primary",round:"",onClick:e(S)},{default:c(()=>[l(ye,{name:e(Te),color:w.$q.dark.isActive?"primary":"white"},null,8,["name","color"])]),_:1},8,["loading","color","onClick"])])])):(C(),D("div",He," Pool not found ")),s("div",Ue,[s("dl",null,[s("dt",null,"Pool "+f(e(o).from.symbol)+" balance",1),s("dd",null,f(e(M)(e(r))),1)]),s("dl",null,[s("dt",null,"Pool "+f(e(o).to.symbol)+" balance",1),s("dd",null,f(e(M)(e(p))),1)])])]),_:1}),l(he,{showing:e(o)?.loading,class:"swap-loading",color:"grey"},null,8,["showing"])]),_:1}),l(ge,{modelValue:e(i).slippageDialog,"onUpdate:modelValue":_[2]||(_[2]=A=>e(i).slippageDialog=A),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[l(j,null,{default:c(()=>[l(z,null,{default:c(()=>[l(Be,{modelValue:e(i).slippage,"onUpdate:modelValue":[_[1]||(_[1]=A=>e(i).slippage=A),e(t)],spread:"","no-caps":"",unelevated:"",ripple:!1,"toggle-color":"secondary",color:"white","text-color":"dark",options:[{label:"0.1%",value:.001},{label:"0.5%",value:.005},{label:"1%",value:.01},{label:"5%",value:.05}]},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),je={},We={class:"main-block row justify-center"};function Ge(q,v){const o=Y,h=Ee,y=ee,T=oe;return C(),D(X,null,[l(o,{class:"q-mt-lg"}),s("div",We,[l(h)]),l(y,{class:"q-mt-lg"}),l(T,{class:"q-mt-lg"})],64)}const to=Se(je,[["render",Ge]]);export{to as default};
