import{_ as U,a as R}from"./AppDescription-9203de90.js";import{_ as z}from"./PoolsListItem.vue_vue_type_script_setup_true_lang-c70ea80f.js";import{ar as $,as as Q,at as J,x as K,L as m,y as W,z as Z,A as _,au as N,J as P,ak as k,av as E,Z as j,o as v,j as y,k as g,a8 as s,ae as O,a7 as u,aa as I,aw as V,F as G,ax as H,ay as X,a9 as x,ai as q,az as Y,a2 as oo,_ as eo}from"./index-33cf60a3.js";import{u as C}from"./swap-d290b7ed.js";import{_ as to}from"./AppDescriptionTop-557a275a.js";import"./internal-b113e877.js";async function so(n){const{data:t}=await $.get(`${D(n)}`);return t}async function ao(n){const{data:t}=await $.get(`${D(n)}/transactions?type=swap`);return t}async function no(n){const{data:t}=await $.get(`${D(n)}/coin-price`);return t}function D(n){return n==="mainnet-beta"?Q:J}const F=K("pools-stats",()=>{const n=m([]),t=m(!0),l=m([]),c=m(!0),i=m({}),d=m(!0),T=m({}),B=m({tvl:0,volume24:0,fees24:0}),A=W(),S=Z(),b=C(),w=_(()=>b.tokenSwapsAllFiltered),L=N(async()=>{t.value=!0;try{n.value=await so(A.cluster)}catch(a){console.error("get pools data: ",a)}finally{t.value=!1}},500);P(w,L,{immediate:!0}),setInterval(L,6e4);const M=N(async()=>{c.value=!0;try{l.value=await ao(A.cluster)}catch(a){console.error("get tx data: ",a)}finally{c.value=!1}},500);P(()=>A.cluster,M,{immediate:!0}),setInterval(M,6e4);const p=N(async()=>{d.value=!0;try{i.value=await no(A.cluster)}catch(a){console.error("get tx data: ",a)}finally{d.value=!1}},500);return p(),setInterval(p,6e4),P([n,l,i],()=>{if(t.value||c.value||d.value)return;const a={tvl:0,volume24:0,fees24:0},e=w.value.reduce((o,f)=>(o[f.pubkey.toBase58()]={tokenAMint:f.data.tokenAMint.toBase58(),tokenBMint:f.data.tokenBMint.toBase58(),poolTokenSupply:0,amountTokenA:0,amountTokenB:0,tvl:0,volume24:0,fees24:0,apr24:0},o),{});n.value?.forEach(o=>{e[o.address]&&(e[o.address].amountTokenA=Number(o.tokenABalance),e[o.address].amountTokenB=Number(o.tokenBBalance),e[o.address].poolTokenSupply=Number(o.poolTokenSupply))}),l.value?.forEach(o=>{if(e[o.poolAddress]){const f=S.tokenByMint(e[o.poolAddress].tokenAMint),h=S.tokenByMint(e[o.poolAddress].tokenBMint);if(Number(o.amountTokenA)>0){const r=k(Number(o.amountTokenA),f?.decimals)*o.priceTokenA;e[o.poolAddress].volume24+=r,e[o.poolAddress].fees24+=k(Number(o.feeTokenB),h?.decimals)*o.priceTokenB,a.volume24+=r}if(Number(o.amountTokenB)>0){const r=k(Number(o.amountTokenB),h?.decimals)*o.priceTokenB;e[o.poolAddress].volume24+=k(Number(o.amountTokenB),h?.decimals)*o.priceTokenB,a.volume24+=r}if(Number(o.feeTokenA)>0){const r=k(Number(o.feeTokenA),f?.decimals)*o.priceTokenA;e[o.poolAddress].fees24+=r,a.fees24+=r}if(Number(o.feeTokenB)>0){const r=k(Number(o.feeTokenB),h?.decimals)*o.priceTokenB;e[o.poolAddress].fees24+=r,a.fees24+=r}}}),Object.keys(e).forEach(o=>{const f=S.tokenByMint(e[o].tokenAMint),h=S.tokenByMint(e[o].tokenBMint),r=k(e[o].amountTokenA,f?.decimals)*(i.value[E[e[o].tokenAMint]]??0)+k(e[o].amountTokenB,h?.decimals)*(i.value[E[e[o].tokenBMint]]??0);e[o].tvl=r,a.tvl+=r,e[o].apr24=e[o].fees24/e[o].tvl*365}),T.value=e,B.value=a,console.log("[pools stats]: ",e),console.log("[pools stats] total: ",a)}),{poolsLoading:t,txLoading:c,priceLoading:d,poolsStats:T,poolsStatsTotal:B}}),lo={class:"row justify-start"},co={class:"pools-total q-mr-md q-mb-md"},ro=u("div",{class:"pools-total__name"}," Total value locked ",-1),io={class:"pools-total__value"},uo={class:"pools-total q-mb-md"},po=u("div",{class:"pools-total__name"}," Volume 24h ",-1),mo={class:"pools-total__value"},_o=j({__name:"PoolsTotal",setup(n){const t=F(),l=_(()=>t.poolsStatsTotal),c=_(()=>t.poolsLoading),i=_(()=>t.txLoading),d=_(()=>t.priceLoading);return(T,B)=>(v(),y("div",null,[g(O,{showing:s(l).tvl===0&&(s(c)||s(i)||s(d)),class:"swap-loading",color:"grey"},null,8,["showing"]),u("div",lo,[u("div",co,[ro,u("div",io," $"+I(s(V).format(s(l).tvl)),1)]),u("div",uo,[po,u("div",mo," $"+I(s(V).format(s(l).volume24)),1)])])]))}}),fo={key:0,class:"full-width row items-center justify-start q-px-lg"},ko={key:0,class:"q-mb-md q-ml-auto"},vo=u("span",{class:"q-mr-sm"},"My Liquidity",-1),go={class:"full-width"},yo={class:"row justify-center q-pl-lg"},To={key:0,class:"text-h5"},Bo=j({__name:"PoolsList",setup(n){const{connected:t}=G(),l=m(!1),c=C(),i=_(()=>c.tokenSwapsAllFiltered.filter(b=>!t.value||!l.value||c.userPoolsTokens[b.data.poolMint.toBase58()])),d=_(()=>c.userPoolsTokens),{state:T}=c,B=F(),A=_(()=>B.poolsLoading),S=_(()=>B.poolsStats);return(b,w)=>{const L=_o,M=z;return v(),y(q,null,[s(t)?(v(),y("div",fo,[g(L,{class:"q-mb-md"}),s(t)?(v(),y("div",ko,[vo,g(X,{modelValue:s(l),"onUpdate:modelValue":w[0]||(w[0]=p=>H(l)?l.value=p:null),color:"secondary",dense:"",class:"app-toggle"},null,8,["modelValue"])])):x("",!0)])):x("",!0),u("div",go,[g(O,{showing:s(T)?.loading||s(A),class:"swap-loading",color:"grey"},null,8,["showing"]),u("div",yo,[(v(!0),y(q,null,Y(s(i),(p,a)=>(v(),oo(M,{key:p.pubkey.toBase58()??a,pubkey:p.pubkey,data:p.data,"user-tokens":s(d)[p.data.poolMint.toBase58()],"pool-stats":s(S)[p.pubkey.toBase58()],class:"q-mr-lg q-mb-lg"},null,8,["pubkey","data","user-tokens","pool-stats"]))),128)),!s(T).loading&&!s(i).length?(v(),y("div",To," Pools not found ")):x("",!0)])])],64)}}}),Ao={},So={class:"main-block row justify-center"};function ho(n,t){const l=to,c=Bo,i=U,d=R;return v(),y(q,null,[g(l,{class:"q-mt-lg"}),u("div",So,[g(c)]),g(i,{class:"q-mt-lg"}),g(d,{class:"q-mt-lg"})],64)}const xo=eo(Ao,[["render",ho]]);export{xo as default};
