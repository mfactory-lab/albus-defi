import{_ as F,a as R}from"./AppDescription-7389733f.js";import{_ as Q}from"./PoolsListItem.vue_vue_type_script_setup_true_lang-d178b8ef.js";import{an as $,ao as G,ap as K,s as W,G as m,u as Z,t as z,v as _,aq as N,C as P,ag as k,ar as V,V as j,o as v,i as y,j as g,a4 as s,aa as C,a3 as u,a6 as E,as as I,y as H,at as J,au as X,a5 as q,ae as x,av as Y,Z as oo,_ as eo}from"./index-8a22f477.js";import{u as O}from"./swap-c884cd83.js";import{_ as to}from"./AppDescriptionTop-91f4f0c2.js";import"./associatedTokenAccount-0df006f8.js";async function so(n){const{data:t}=await $.get(`${D(n)}`);return t}async function ao(n){const{data:t}=await $.get(`${D(n)}/transactions?type=swap`);return t}async function no(n){const{data:t}=await $.get(`${D(n)}/coin-price`);return t}function D(n){return n==="mainnet-beta"?G:K}const U=W("pools-stats",()=>{const n=m([]),t=m(!0),l=m([]),c=m(!0),i=m({}),d=m(!0),T=m({}),B=m({tvl:0,volume24:0,fees24:0}),M=Z(),A=z(),b=O(),h=_(()=>b.tokenSwapsAllFiltered),L=N(async()=>{t.value=!0;try{n.value=await so()}catch(a){console.error("get pools data: ",a)}finally{t.value=!1}},500);P(h,L,{immediate:!0});const w=N(async()=>{c.value=!0;try{l.value=await ao()}catch(a){console.error("get tx data: ",a)}finally{c.value=!1}},500);P(()=>M.cluster,w,{immediate:!0}),setInterval(w,6e4);const p=N(async()=>{d.value=!0;try{i.value=await no()}catch(a){console.error("get tx data: ",a)}finally{d.value=!1}},500);return p(),setInterval(p,6e4),P([n,l,i],()=>{if(t.value||c.value||d.value)return;const a={tvl:0,volume24:0,fees24:0},e=h.value.reduce((o,f)=>(o[f.pubkey.toBase58()]={tokenAMint:f.data.tokenAMint.toBase58(),tokenBMint:f.data.tokenBMint.toBase58(),poolTokenSupply:0,amountTokenA:0,amountTokenB:0,tvl:0,volume24:0,fees24:0,apr24:0},o),{});n.value?.forEach(o=>{e[o.address]&&(e[o.address].amountTokenA=Number(o.tokenABalance),e[o.address].amountTokenB=Number(o.tokenBBalance),e[o.address].poolTokenSupply=Number(o.poolTokenSupply))}),l.value?.forEach(o=>{if(e[o.poolAddress]){const f=A.tokenByMint(e[o.poolAddress].tokenAMint),S=A.tokenByMint(e[o.poolAddress].tokenBMint);if(Number(o.amountTokenA)>0){const r=k(Number(o.amountTokenA),f?.decimals)*o.priceTokenA;e[o.poolAddress].volume24+=r,e[o.poolAddress].fees24+=k(Number(o.feeTokenB),S?.decimals)*o.priceTokenB,a.volume24+=r}if(Number(o.amountTokenB)>0){const r=k(Number(o.amountTokenB),S?.decimals)*o.priceTokenB;e[o.poolAddress].volume24+=k(Number(o.amountTokenB),S?.decimals)*o.priceTokenB,a.volume24+=r}if(Number(o.feeTokenA)>0){const r=k(Number(o.feeTokenA),f?.decimals)*o.priceTokenA;e[o.poolAddress].fees24+=r,a.fees24+=r}if(Number(o.feeTokenB)>0){const r=k(Number(o.feeTokenB),S?.decimals)*o.priceTokenB;e[o.poolAddress].fees24+=r,a.fees24+=r}}}),Object.keys(e).forEach(o=>{const f=A.tokenByMint(e[o].tokenAMint),S=A.tokenByMint(e[o].tokenBMint),r=k(e[o].amountTokenA,f?.decimals)*(i.value[V[e[o].tokenAMint]]??0)+k(e[o].amountTokenB,S?.decimals)*(i.value[V[e[o].tokenBMint]]??0);e[o].tvl=r,a.tvl+=r,e[o].apr24=e[o].fees24/e[o].tvl*365}),T.value=e,B.value=a,console.log("[pools stats]: ",e),console.log("[pools stats] total: ",a)}),{poolsLoading:t,txLoading:c,priceLoading:d,poolsStats:T,poolsStatsTotal:B}}),lo={class:"row justify-start"},co={class:"pools-total q-mr-md q-mb-md"},ro=u("div",{class:"pools-total__name"}," Total value locked ",-1),io={class:"pools-total__value"},uo={class:"pools-total q-mb-md"},po=u("div",{class:"pools-total__name"}," Volume 24h ",-1),mo={class:"pools-total__value"},_o=j({__name:"PoolsTotal",setup(n){const t=U(),l=_(()=>t.poolsStatsTotal),c=_(()=>t.poolsLoading),i=_(()=>t.txLoading),d=_(()=>t.priceLoading);return(T,B)=>(v(),y("div",null,[g(C,{showing:s(l).tvl===0&&(s(c)||s(i)||s(d)),class:"swap-loading",color:"grey"},null,8,["showing"]),u("div",lo,[u("div",co,[ro,u("div",io," $"+E(s(I).format(s(l).tvl)),1)]),u("div",uo,[po,u("div",mo," $"+E(s(I).format(s(l).volume24)),1)])])]))}}),fo={key:0,class:"full-width row items-center justify-start q-px-lg"},ko={key:0,class:"q-mb-md q-ml-auto"},vo=u("span",{class:"q-mr-sm"},"My Liquidity",-1),go={class:"full-width"},yo={class:"row justify-center q-pl-lg"},To={key:0,class:"text-h5"},Bo=j({__name:"PoolsList",setup(n){const{connected:t}=H(),l=m(!1),c=O(),i=_(()=>c.tokenSwapsAllFiltered.filter(b=>!t.value||!l.value||c.userPoolsTokens[b.data.poolMint.toBase58()])),d=_(()=>c.userPoolsTokens),{state:T}=c,B=U(),M=_(()=>B.poolsLoading),A=_(()=>B.poolsStats);return(b,h)=>{const L=_o,w=Q;return v(),y(x,null,[s(t)?(v(),y("div",fo,[g(L,{class:"q-mb-md"}),s(t)?(v(),y("div",ko,[vo,g(X,{modelValue:s(l),"onUpdate:modelValue":h[0]||(h[0]=p=>J(l)?l.value=p:null),color:"secondary",dense:"",class:"app-toggle"},null,8,["modelValue"])])):q("",!0)])):q("",!0),u("div",go,[g(C,{showing:s(T)?.loading||s(M),class:"swap-loading",color:"grey"},null,8,["showing"]),u("div",yo,[(v(!0),y(x,null,Y(s(i),(p,a)=>(v(),oo(w,{key:p.pubkey.toBase58()??a,pubkey:p.pubkey,data:p.data,"user-tokens":s(d)[p.data.poolMint.toBase58()],"pool-stats":s(A)[p.pubkey.toBase58()],class:"q-mr-lg q-mb-lg"},null,8,["pubkey","data","user-tokens","pool-stats"]))),128)),!s(T).loading&&!s(i).length?(v(),y("div",To," Pools not found ")):q("",!0)])])],64)}}}),Ao={},So={class:"main-block row justify-center"};function ho(n,t){const l=to,c=Bo,i=F,d=R;return v(),y(x,null,[g(l,{class:"q-mt-lg"}),u("div",So,[g(c)]),g(i,{class:"q-mt-lg"}),g(d,{class:"q-mt-lg"})],64)}const qo=eo(Ao,[["render",ho]]);export{qo as default};
