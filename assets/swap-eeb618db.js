import{m as f,ao as Ae,ap as ge,a as Le,q as E,ba as xe,bb as ze,aq as nt,bc as rt,k as a,bd as B,n as x,be as it,S as Pe,R as y,s as at,u as st,w as ct,x as ut,y as lt,z as pt,v as dt,K as De,P as mt,G as z,A as Ie,B as ft,bf as Ce,W as yt,H as ht,C as S,bg as Ne,I as fe,J as kt,bh as wt,bi as St,ax as Ke,a6 as At,aH as C,Q as gt,bj as N}from"./index-d0b1a4e3.js";import{b as M,d as bt,A as vt,g as ye,T as he,a as ke,c as we,N as Re}from"./associatedTokenAccount-f2987423.js";var R;(function(e){e[e.InitializeMint=0]="InitializeMint",e[e.InitializeAccount=1]="InitializeAccount",e[e.InitializeMultisig=2]="InitializeMultisig",e[e.Transfer=3]="Transfer",e[e.Approve=4]="Approve",e[e.Revoke=5]="Revoke",e[e.SetAuthority=6]="SetAuthority",e[e.MintTo=7]="MintTo",e[e.Burn=8]="Burn",e[e.CloseAccount=9]="CloseAccount",e[e.FreezeAccount=10]="FreezeAccount",e[e.ThawAccount=11]="ThawAccount",e[e.TransferChecked=12]="TransferChecked",e[e.ApproveChecked=13]="ApproveChecked",e[e.MintToChecked=14]="MintToChecked",e[e.BurnChecked=15]="BurnChecked",e[e.InitializeAccount2=16]="InitializeAccount2",e[e.SyncNative=17]="SyncNative",e[e.InitializeAccount3=18]="InitializeAccount3",e[e.InitializeMultisig2=19]="InitializeMultisig2",e[e.InitializeMint2=20]="InitializeMint2",e[e.GetAccountDataSize=21]="GetAccountDataSize",e[e.InitializeImmutableOwner=22]="InitializeImmutableOwner",e[e.AmountToUiAmount=23]="AmountToUiAmount",e[e.UiAmountToAmount=24]="UiAmountToAmount",e[e.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",e[e.TransferFeeExtension=26]="TransferFeeExtension",e[e.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",e[e.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",e[e.Reallocate=29]="Reallocate",e[e.MemoTransferExtension=30]="MemoTransferExtension",e[e.CreateNativeMint=31]="CreateNativeMint",e[e.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",e[e.InterestBearingMintExtension=33]="InterestBearingMintExtension",e[e.CpiGuardExtension=34]="CpiGuardExtension",e[e.InitializePermanentDelegate=35]="InitializePermanentDelegate",e[e.TransferHookExtension=36]="TransferHookExtension",e[e.MetadataPointerExtension=39]="MetadataPointerExtension"})(R||(R={}));function Tt(e,t,n){if(n.length){e.push({pubkey:t,isSigner:!1,isWritable:!1});for(const r of n)e.push({pubkey:r instanceof f?r:r.publicKey,isSigner:!0,isWritable:!1})}else e.push({pubkey:t,isSigner:!0,isWritable:!1});return e}const Oe=Ae([ge("instruction")]);function Bt(e,t,n,r=[],s=M){const l=Tt([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],n,r),v=Le.Buffer.alloc(Oe.span);return Oe.encode({instruction:R.CloseAccount},v),new E({keys:l,programId:s,data:v})}const Mt=Ae([xe("mintAuthorityOption"),ze("mintAuthority"),nt("supply"),ge("decimals"),rt("isInitialized"),xe("freezeAuthorityOption"),ze("freezeAuthority")]);Mt.span;async function Et(e,t,n=!1,r=M,s=vt){if(!n&&!f.isOnCurve(t.toBuffer()))throw new bt;const[l]=await f.findProgramAddress([t.toBuffer(),r.toBuffer(),e.toBuffer()],s);return l}const qe=Ae([ge("instruction")]);function Ft(e,t=M){const n=[{pubkey:e,isSigner:!1,isWritable:!0}],r=Le.Buffer.alloc(qe.span);return qe.encode({instruction:R.SyncNative},r),new E({keys:n,programId:t,data:r})}var Wt=Object.defineProperty,xt=(e,t,n)=>t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,i=(e,t,n)=>(xt(e,typeof t!="symbol"?t+"":t,n),n);const Ue=new a.BeetArgsStruct([["tradeFeeNumerator",a.u64],["tradeFeeDenominator",a.u64],["ownerTradeFeeNumerator",a.u64],["ownerTradeFeeDenominator",a.u64],["ownerWithdrawFeeNumerator",a.u64],["ownerWithdrawFeeDenominator",a.u64],["hostFeeNumerator",a.u64],["hostFeeDenominator",a.u64]],"FeesInfo"),Ge=new a.BeetArgsStruct([["curveType",a.u8],["curveParameters",a.uniformFixedSizeArray(a.u8,32)]],"CurveInfo"),Se=[135,144,215,161,140,125,41,96];class b{constructor(t,n,r,s,l,v,A,k,g,u,T,P){this.isInitialized=t,this.bumpSeed=n,this.tokenProgramId=r,this.tokenA=s,this.tokenB=l,this.poolMint=v,this.tokenAMint=A,this.tokenBMint=k,this.poolFeeAccount=g,this.fees=u,this.curve=T,this.policy=P}static fromArgs(t){return new b(t.isInitialized,t.bumpSeed,t.tokenProgramId,t.tokenA,t.tokenB,t.poolMint,t.tokenAMint,t.tokenBMint,t.poolFeeAccount,t.fees,t.curve,t.policy)}static fromAccountInfo(t,n=0){return b.deserialize(t.data,n)}static async fromAccountAddress(t,n,r){const s=await t.getAccountInfo(n,r);if(s==null)throw new Error(`Unable to find TokenSwap account at ${n}`);return b.fromAccountInfo(s,0)[0]}static gpaBuilder(t=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){return B.GpaBuilder.fromStruct(t,K)}static deserialize(t,n=0){return K.deserialize(t,n)}serialize(){return K.serialize({accountDiscriminator:Se,...this})}static byteSize(t){const n=b.fromArgs(t);return K.toFixedFromValue({accountDiscriminator:Se,...n}).byteSize}static async getMinimumBalanceForRentExemption(t,n,r){return n.getMinimumBalanceForRentExemption(b.byteSize(t),r)}pretty(){return{isInitialized:this.isInitialized,bumpSeed:this.bumpSeed,tokenProgramId:this.tokenProgramId.toBase58(),tokenA:this.tokenA.toBase58(),tokenB:this.tokenB.toBase58(),poolMint:this.poolMint.toBase58(),tokenAMint:this.tokenAMint.toBase58(),tokenBMint:this.tokenBMint.toBase58(),poolFeeAccount:this.poolFeeAccount.toBase58(),fees:this.fees,curve:this.curve,policy:this.policy}}}const K=new a.FixableBeetStruct([["accountDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["isInitialized",a.bool],["bumpSeed",a.u8],["tokenProgramId",B.publicKey],["tokenA",B.publicKey],["tokenB",B.publicKey],["poolMint",B.publicKey],["tokenAMint",B.publicKey],["tokenBMint",B.publicKey],["poolFeeAccount",B.publicKey],["fees",Ue],["curve",Ge],["policy",a.coption(B.publicKey)]],b.fromArgs,"TokenSwap"),d=new Map,m=new Map;class O extends Error{constructor(){super("Swap account already in use"),i(this,"code",6e3),i(this,"name","AlreadyInUse"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,O)}}d.set(6e3,()=>new O);m.set("AlreadyInUse",()=>new O);class q extends Error{constructor(){super("Invalid program address generated from bump seed and key"),i(this,"code",6001),i(this,"name","InvalidProgramAddress"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,q)}}d.set(6001,()=>new q);m.set("InvalidProgramAddress",()=>new q);class L extends Error{constructor(){super("Input account owner is not the program address"),i(this,"code",6002),i(this,"name","InvalidOwner"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,L)}}d.set(6002,()=>new L);m.set("InvalidOwner",()=>new L);class U extends Error{constructor(){super("Output pool account owner cannot be the program address"),i(this,"code",6003),i(this,"name","InvalidOutputOwner"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,U)}}d.set(6003,()=>new U);m.set("InvalidOutputOwner",()=>new U);class G extends Error{constructor(){super("Deserialized account is not an SPL Token mint"),i(this,"code",6004),i(this,"name","ExpectedMint"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,G)}}d.set(6004,()=>new G);m.set("ExpectedMint",()=>new G);class J extends Error{constructor(){super("Deserialized account is not an SPL Token account"),i(this,"code",6005),i(this,"name","ExpectedAccount"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,J)}}d.set(6005,()=>new J);m.set("ExpectedAccount",()=>new J);class $ extends Error{constructor(){super("Input token account empty"),i(this,"code",6006),i(this,"name","EmptySupply"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$)}}d.set(6006,()=>new $);m.set("EmptySupply",()=>new $);class H extends Error{constructor(){super("Pool token mint has a non-zero supply"),i(this,"code",6007),i(this,"name","InvalidSupply"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,H)}}d.set(6007,()=>new H);m.set("InvalidSupply",()=>new H);class Q extends Error{constructor(){super("Token account has a delegate"),i(this,"code",6008),i(this,"name","InvalidDelegate"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Q)}}d.set(6008,()=>new Q);m.set("InvalidDelegate",()=>new Q);class V extends Error{constructor(){super("InvalidInput"),i(this,"code",6009),i(this,"name","InvalidInput"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,V)}}d.set(6009,()=>new V);m.set("InvalidInput",()=>new V);class j extends Error{constructor(){super("Address of the provided swap token account is incorrect"),i(this,"code",6010),i(this,"name","IncorrectSwapAccount"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,j)}}d.set(6010,()=>new j);m.set("IncorrectSwapAccount",()=>new j);class Z extends Error{constructor(){super("Address of the provided pool token mint is incorrect"),i(this,"code",6011),i(this,"name","IncorrectPoolMint"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Z)}}d.set(6011,()=>new Z);m.set("IncorrectPoolMint",()=>new Z);class X extends Error{constructor(){super("InvalidOutput"),i(this,"code",6012),i(this,"name","InvalidOutput"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,X)}}d.set(6012,()=>new X);m.set("InvalidOutput",()=>new X);class Y extends Error{constructor(){super("General calculation failure due to overflow or underflow"),i(this,"code",6013),i(this,"name","CalculationFailure"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Y)}}d.set(6013,()=>new Y);m.set("CalculationFailure",()=>new Y);class _ extends Error{constructor(){super("Invalid instruction"),i(this,"code",6014),i(this,"name","InvalidInstruction"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,_)}}d.set(6014,()=>new _);m.set("InvalidInstruction",()=>new _);class ee extends Error{constructor(){super("Swap input token accounts have the same mint"),i(this,"code",6015),i(this,"name","RepeatedMint"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ee)}}d.set(6015,()=>new ee);m.set("RepeatedMint",()=>new ee);class te extends Error{constructor(){super("Swap instruction exceeds desired slippage limit"),i(this,"code",6016),i(this,"name","ExceededSlippage"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,te)}}d.set(6016,()=>new te);m.set("ExceededSlippage",()=>new te);class oe extends Error{constructor(){super("Token account has a close authority"),i(this,"code",6017),i(this,"name","InvalidCloseAuthority"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,oe)}}d.set(6017,()=>new oe);m.set("InvalidCloseAuthority",()=>new oe);class ne extends Error{constructor(){super("Pool token mint has a freeze authority"),i(this,"code",6018),i(this,"name","InvalidFreezeAuthority"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ne)}}d.set(6018,()=>new ne);m.set("InvalidFreezeAuthority",()=>new ne);class re extends Error{constructor(){super("Pool fee token account incorrect"),i(this,"code",6019),i(this,"name","IncorrectFeeAccount"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,re)}}d.set(6019,()=>new re);m.set("IncorrectFeeAccount",()=>new re);class ie extends Error{constructor(){super("Given pool token amount results in zero trading tokens"),i(this,"code",6020),i(this,"name","ZeroTradingTokens"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ie)}}d.set(6020,()=>new ie);m.set("ZeroTradingTokens",()=>new ie);class ae extends Error{constructor(){super("Fee calculation failed due to overflow, underflow, or unexpected 0"),i(this,"code",6021),i(this,"name","FeeCalculationFailure"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ae)}}d.set(6021,()=>new ae);m.set("FeeCalculationFailure",()=>new ae);class se extends Error{constructor(){super("Conversion to u64/u128 failed with an overflow or underflow"),i(this,"code",6022),i(this,"name","ConversionFailure"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,se)}}d.set(6022,()=>new se);m.set("ConversionFailure",()=>new se);class ce extends Error{constructor(){super("The provided fee does not match the program owner's constraints"),i(this,"code",6023),i(this,"name","InvalidFee"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ce)}}d.set(6023,()=>new ce);m.set("InvalidFee",()=>new ce);class ue extends Error{constructor(){super("The provided token program does not match the token program expected by the swap"),i(this,"code",6024),i(this,"name","IncorrectTokenProgramId"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ue)}}d.set(6024,()=>new ue);m.set("IncorrectTokenProgramId",()=>new ue);class le extends Error{constructor(){super("The provided curve type is not supported by the program owner"),i(this,"code",6025),i(this,"name","UnsupportedCurveType"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,le)}}d.set(6025,()=>new le);m.set("UnsupportedCurveType",()=>new le);class pe extends Error{constructor(){super("The provided curve parameters are invalid"),i(this,"code",6026),i(this,"name","InvalidCurve"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,pe)}}d.set(6026,()=>new pe);m.set("InvalidCurve",()=>new pe);class de extends Error{constructor(){super("The operation cannot be performed on the given curve"),i(this,"code",6027),i(this,"name","UnsupportedCurveOperation"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,de)}}d.set(6027,()=>new de);m.set("UnsupportedCurveOperation",()=>new de);new a.BeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)]],"CloseAccountInstructionArgs");const zt=new a.BeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["poolTokenAmount",a.u64],["maximumTokenAAmount",a.u64],["maximumTokenBAmount",a.u64]],"DepositAllTokenTypesInstructionArgs"),Pt=[32,95,69,60,75,79,205,238];function Dt(e,t,n=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){const[r]=zt.serialize({instructionDiscriminator:Pt,...t}),s=[{pubkey:e.tokenSwap,isWritable:!1,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:e.userTransferAuthority,isWritable:!1,isSigner:!0},{pubkey:e.userTokenA,isWritable:!0,isSigner:!1},{pubkey:e.userTokenB,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenA,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenB,isWritable:!0,isSigner:!1},{pubkey:e.poolMint,isWritable:!0,isSigner:!1},{pubkey:e.destination,isWritable:!0,isSigner:!1},{pubkey:e.tokenProgram??M,isWritable:!1,isSigner:!1}];if(e.anchorRemainingAccounts!=null)for(const l of e.anchorRemainingAccounts)s.push(l);return new E({programId:n,keys:s,data:r})}const It=new a.BeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["sourceTokenAmount",a.u64],["minimumPoolTokenAmount",a.u64]],"DepositSingleTokenTypeInstructionArgs"),Ct=[175,0,152,41,199,0,148,43];function Nt(e,t,n=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){const[r]=It.serialize({instructionDiscriminator:Ct,...t}),s=[{pubkey:e.tokenSwap,isWritable:!1,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:e.userTransferAuthority,isWritable:!1,isSigner:!0},{pubkey:e.source,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenA,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenB,isWritable:!0,isSigner:!1},{pubkey:e.poolMint,isWritable:!0,isSigner:!1},{pubkey:e.destination,isWritable:!0,isSigner:!1},{pubkey:e.tokenProgram??M,isWritable:!1,isSigner:!1}];if(e.anchorRemainingAccounts!=null)for(const l of e.anchorRemainingAccounts)s.push(l);return new E({programId:n,keys:s,data:r})}const Kt=new a.FixableBeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["feesInput",Ue],["curveInput",Ge],["policy",a.coption(B.publicKey)]],"InitializeInstructionArgs"),Rt=[175,175,109,31,13,152,155,237];function Ot(e,t,n=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){const[r]=Kt.serialize({instructionDiscriminator:Rt,...t}),s=[{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:e.tokenSwap,isWritable:!0,isSigner:!0},{pubkey:e.poolMint,isWritable:!0,isSigner:!1},{pubkey:e.tokenA,isWritable:!0,isSigner:!1},{pubkey:e.tokenB,isWritable:!0,isSigner:!1},{pubkey:e.poolFee,isWritable:!0,isSigner:!1},{pubkey:e.destination,isWritable:!0,isSigner:!1},{pubkey:e.tokenProgram??M,isWritable:!1,isSigner:!1}];if(e.anchorRemainingAccounts!=null)for(const l of e.anchorRemainingAccounts)s.push(l);return new E({programId:n,keys:s,data:r})}const qt=new a.BeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["amountIn",a.u64],["minimumAmountOut",a.u64]],"SwapInstructionArgs"),Lt=[248,198,158,145,225,117,135,200];function Ut(e,t,n=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){const[r]=qt.serialize({instructionDiscriminator:Lt,...t}),s=[{pubkey:e.proofRequest??n,isWritable:!1,isSigner:!1},{pubkey:e.tokenSwap,isWritable:!1,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:e.userTransferAuthority,isWritable:!1,isSigner:!0},{pubkey:e.userSource,isWritable:!0,isSigner:!1},{pubkey:e.userDestination,isWritable:!0,isSigner:!1},{pubkey:e.poolSource,isWritable:!0,isSigner:!1},{pubkey:e.poolDestination,isWritable:!0,isSigner:!1},{pubkey:e.poolMint,isWritable:!0,isSigner:!1},{pubkey:e.poolFee,isWritable:!0,isSigner:!1},{pubkey:e.hostFeeAccount??n,isWritable:!1,isSigner:!1},{pubkey:e.tokenProgram??M,isWritable:!1,isSigner:!1}];if(e.anchorRemainingAccounts!=null)for(const l of e.anchorRemainingAccounts)s.push(l);return new E({programId:n,keys:s,data:r})}const Gt=new a.BeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["poolTokenAmount",a.u64],["minimumTokenAAmount",a.u64],["minimumTokenBAmount",a.u64]],"WithdrawAllTokenTypesInstructionArgs"),Jt=[189,254,156,174,210,9,164,216];function $t(e,t,n=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){const[r]=Gt.serialize({instructionDiscriminator:Jt,...t}),s=[{pubkey:e.tokenSwap,isWritable:!1,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:e.userTransferAuthority,isWritable:!1,isSigner:!0},{pubkey:e.poolMint,isWritable:!0,isSigner:!1},{pubkey:e.source,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenA,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenB,isWritable:!0,isSigner:!1},{pubkey:e.destTokenA,isWritable:!0,isSigner:!1},{pubkey:e.destTokenB,isWritable:!0,isSigner:!1},{pubkey:e.poolFee,isWritable:!0,isSigner:!1},{pubkey:e.tokenProgram??M,isWritable:!1,isSigner:!1}];if(e.anchorRemainingAccounts!=null)for(const l of e.anchorRemainingAccounts)s.push(l);return new E({programId:n,keys:s,data:r})}const Ht=new a.BeetArgsStruct([["instructionDiscriminator",a.uniformFixedSizeArray(a.u8,8)],["destinationTokenAmount",a.u64],["maximumPoolTokenAmount",a.u64]],"WithdrawSingleTokenTypeInstructionArgs"),Qt=[111,171,21,77,237,181,241,56];function Vt(e,t,n=new f("ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq")){const[r]=Ht.serialize({instructionDiscriminator:Qt,...t}),s=[{pubkey:e.tokenSwap,isWritable:!1,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:e.userTransferAuthority,isWritable:!1,isSigner:!0},{pubkey:e.poolMint,isWritable:!0,isSigner:!1},{pubkey:e.source,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenA,isWritable:!0,isSigner:!1},{pubkey:e.swapTokenB,isWritable:!0,isSigner:!1},{pubkey:e.destination,isWritable:!0,isSigner:!1},{pubkey:e.poolFee,isWritable:!0,isSigner:!1},{pubkey:e.tokenProgram??M,isWritable:!1,isSigner:!1}];if(e.anchorRemainingAccounts!=null)for(const l of e.anchorRemainingAccounts)s.push(l);return new E({programId:n,keys:s,data:r})}var Je=(e=>(e[e.ConstantProduct=0]="ConstantProduct",e[e.ConstantPrice=1]="ConstantPrice",e[e.Offset=2]="Offset",e))(Je||{});a.fixedScalarEnum(Je);var $e=(e=>(e[e.Floor=0]="Floor",e[e.Ceiling=1]="Ceiling",e))($e||{});a.fixedScalarEnum($e);var He=(e=>(e[e.AtoB=0]="AtoB",e[e.BtoA=1]="BtoA",e))(He||{});a.fixedScalarEnum(He);const jt="ASWfaoztykN8Lz1P2uwuvwWR61SvFrvn6acM1sJpxKtq",Zt=new f(jt);class Xt{constructor(t){i(this,"programId",Zt),this.provider=t}get connection(){return this.provider.connection}swapAuthority(t){return f.findProgramAddressSync([t.toBuffer()],this.programId)[0]}async createTokenSwap(t,n){const r=new x,s=t.tokenSwap??it.generate(),l=Array.from({length:32}),v=Array.from(t.curveParameters??[]);for(let T=0;T<v.length;T++)l[T]=v[T];const A={curveType:t.curveType,curveParameters:l},k=b.byteSize({bumpSeed:0,curve:A,fees:{tradeFeeNumerator:0,tradeFeeDenominator:0,ownerTradeFeeNumerator:0,ownerTradeFeeDenominator:0,ownerWithdrawFeeNumerator:0,ownerWithdrawFeeDenominator:0,hostFeeNumerator:0,hostFeeDenominator:0},isInitialized:!1,policy:f.default,poolFeeAccount:f.default,poolMint:f.default,tokenA:f.default,tokenAMint:f.default,tokenB:f.default,tokenBMint:f.default,tokenProgramId:f.default}),g=await this.connection.getMinimumBalanceForRentExemption(k);r.add(Pe.createAccount({fromPubkey:this.provider.publicKey,newAccountPubkey:s.publicKey,programId:this.programId,lamports:g,space:k})),r.add(Ot({authority:this.swapAuthority(s.publicKey),tokenSwap:s.publicKey,destination:t.destination,poolMint:t.poolMint,poolFee:t.poolFee,tokenA:t.tokenA,tokenB:t.tokenB},{feesInput:{tradeFeeNumerator:new y(t.fees.tradeFeeNumerator.toString()),tradeFeeDenominator:new y(t.fees.tradeFeeDenominator.toString()),ownerTradeFeeNumerator:new y(t.fees.ownerTradeFeeNumerator.toString()),ownerTradeFeeDenominator:new y(t.fees.ownerTradeFeeDenominator.toString()),ownerWithdrawFeeNumerator:new y(t.fees.ownerWithdrawFeeNumerator.toString()),ownerWithdrawFeeDenominator:new y(t.fees.ownerWithdrawFeeDenominator.toString()),hostFeeNumerator:new y(t.fees.hostFeeNumerator.toString()),hostFeeDenominator:new y(t.fees.hostFeeDenominator.toString())},curveInput:A,policy:t.policy??null}));const u=await this.provider.sendAndConfirm(r,[s],n);return{tokenSwap:s.publicKey,signature:u}}async swap(t,n){var r;const s=new x;try{await ye(this.connection,t.userDestination)}catch(l){(l instanceof he||l instanceof ke)&&t.destinationTokenMint&&s.add(we(this.provider.publicKey,t.userDestination,this.provider.publicKey,t.destinationTokenMint))}return await this.handleWrappedSol({tx:s,amount:t.amountIn,userSource:t.userSource,sourceTokenMint:t.sourceTokenMint}),s.add(Ut({authority:this.swapAuthority(t.tokenSwap),userTransferAuthority:this.provider.publicKey,userSource:t.userSource,userDestination:t.userDestination,tokenSwap:t.tokenSwap,poolFee:t.poolFee,poolMint:t.poolMint,poolSource:t.poolSource,poolDestination:t.poolDestination,proofRequest:t.proofRequest,hostFeeAccount:t.hostFeeAccount},{amountIn:new y(t.amountIn.toString()),minimumAmountOut:new y(t.minimumAmountOut.toString())})),t.destinationTokenMint&&((r=t.destinationTokenMint)==null?void 0:r.toBase58())===Re.toBase58()&&s.add(Bt(t.userDestination,this.provider.publicKey,this.provider.publicKey)),this.provider.sendAndConfirm(s,[],n)}async depositAllTokenTypes(t,n){const r=Dt({authority:this.swapAuthority(t.tokenSwap),userTransferAuthority:this.provider.publicKey,tokenSwap:t.tokenSwap,poolMint:t.poolMint,destination:t.destination,userTokenA:t.userTokenA,userTokenB:t.userTokenB,swapTokenA:t.swapTokenA,swapTokenB:t.swapTokenB},{poolTokenAmount:new y(t.poolTokenAmount.toString()),maximumTokenAAmount:new y(t.maximumTokenA.toString()),maximumTokenBAmount:new y(t.maximumTokenB.toString())}),s=new x().add(r);return this.provider.sendAndConfirm(s,[],n)}async withdrawAllTokenTypes(t,n){const r=$t({authority:this.swapAuthority(t.tokenSwap),userTransferAuthority:this.provider.publicKey,tokenSwap:t.tokenSwap,poolMint:t.poolMint,poolFee:t.poolFee,source:t.source,destTokenA:t.destTokenA,destTokenB:t.destTokenB,swapTokenA:t.swapTokenA,swapTokenB:t.swapTokenB},{poolTokenAmount:new y(t.poolTokenAmount.toString()),minimumTokenAAmount:new y(t.minimumTokenA.toString()),minimumTokenBAmount:new y(t.minimumTokenB.toString())}),s=new x().add(r);return this.provider.sendAndConfirm(s,[],n)}async depositSingleTokenTypeExactAmountIn(t,n){const r=new x;try{await ye(this.connection,t.destination)}catch(s){(s instanceof he||s instanceof ke)&&r.add(we(this.provider.publicKey,t.destination,this.provider.publicKey,t.poolMint))}return await this.handleWrappedSol({tx:r,amount:t.sourceTokenAmount,userSource:t.source,sourceTokenMint:t.sourceTokenMint}),r.add(Nt({authority:this.swapAuthority(t.tokenSwap),userTransferAuthority:this.provider.publicKey,tokenSwap:t.tokenSwap,poolMint:t.poolMint,source:t.source,destination:t.destination,swapTokenA:t.swapTokenA,swapTokenB:t.swapTokenB},{sourceTokenAmount:new y(t.sourceTokenAmount.toString()),minimumPoolTokenAmount:new y(t.minimumPoolTokenAmount.toString())})),this.provider.sendAndConfirm(r,[],n)}async withdrawSingleTokenTypeExactAmountOut(t,n){const r=Vt({authority:this.swapAuthority(t.tokenSwap),userTransferAuthority:this.provider.publicKey,tokenSwap:t.tokenSwap,poolMint:t.poolMint,poolFee:t.poolFee,source:t.source,destination:t.destination,swapTokenA:t.swapTokenA,swapTokenB:t.swapTokenB},{destinationTokenAmount:new y(t.destinationTokenAmount.toString()),maximumPoolTokenAmount:new y(t.maximumPoolTokenAmount.toString())}),s=new x().add(r);return this.provider.sendAndConfirm(s,[],n)}async load(t,n){return b.fromAccountAddress(this.provider.connection,new f(t),n)}async loadAll(t={}){const n=b.gpaBuilder().addFilter("accountDiscriminator",Se);return t.noData&&(n.config.dataSlice={offset:0,length:0}),t.tokenProgramId&&n.addFilter("tokenProgramId",new f(t.tokenProgramId)),t.poolMint&&n.addFilter("poolMint",new f(t.poolMint)),t.tokenAMint&&n.addFilter("tokenAMint",new f(t.tokenAMint)),t.tokenBMint&&n.addFilter("tokenBMint",new f(t.tokenBMint)),(await n.run(this.provider.connection)).map(({pubkey:r,account:s})=>({pubkey:r,data:t.noData?null:b.fromAccountInfo(s)[0]}))}async handleWrappedSol(t){var n;if(t.sourceTokenMint&&((n=t.sourceTokenMint)==null?void 0:n.toBase58())===Re.toBase58()){let r=0;try{if((await Et(t.sourceTokenMint,this.provider.publicKey)).toBase58()!==t.userSource.toBase58())return;const l=await ye(this.connection,t.userSource);r=Number(l.amount)}catch(l){(l instanceof he||l instanceof ke)&&t.tx.add(we(this.provider.publicKey,t.userSource,this.provider.publicKey,t.sourceTokenMint))}const s=Number(t.amount);t.amount>r&&t.tx.add(Pe.transfer({fromPubkey:this.provider.publicKey,toPubkey:t.userSource,lamports:s-r}),Ft(t.userSource))}}}var Yt=(e=>(e[e.ASC=0]="ASC",e[e.DESC=1]="DESC",e))(Yt||{});const oo=at("swap",()=>{const e=st(),t=ct(),n=ut(),{publicKey:r}=lt(),{notify:s}=pt(),l=dt(()=>new Xt(new De(e.connection,n.value??{publicKey:mt.default},De.defaultOptions()))),v=z({}),A=z([]),k=z([]),g=z([]),u=z(),T=Ie("token-a",""),P=Ie("token-b",""),o=ft({loading:!1,slippageDialog:!1,poolBalance:{},poolTokenSupply:0,from:Ce,to:Ce,swapping:!1,active:!1,slippage:.01,rate:0,minimumReceived:0,impact:0,fees:{host:0,trade:0,ownerTrade:0,ownerWithdraw:0},direction:0}),{handleFilterToken:Qe,tokens:F}=yt();Qe(ht),S(F,()=>{F.value.length>=2&&(o.from=F.value.find(c=>c.mint===T.value)??F.value[0],o.to=F.value.find(c=>c.mint===P.value)??F.value[1])},{immediate:!0}),S(()=>o.from,()=>{o.from&&(T.value=o.from.mint)}),S(()=>o.to,()=>{o.to&&(P.value=o.to.mint)}),S([n,()=>e.cluster],async c=>{Ve().then(),c||Ze()},{immediate:!0}),S([r,k],Ne(async()=>{if(r.value&&k.value.length>0){const c={};for(const p of k.value)try{const h=await fe(p.data.poolMint,r.value),w=await kt(e.connection,h);c[p.data.poolMint.toBase58()]=Number(w.amount),console.log("userAcc === ",w)}catch{}v.value=c}},500),{immediate:!0});async function Ve(){o.loading=!0;try{console.log("swapClient ================: ",l.value),A.value=await l.value.loadAll(),console.log("swaps ================: ",A.value)}catch(c){console.log(c),A.value=[]}finally{o.loading=!1}}const me=z(!1),D=Ne(async()=>{if(console.log("loadPoolTokenAccounts ========= "),!!u.value){me.value=!0;try{const c=await wt(e.connection,l.value.swapAuthority(u.value.pubkey)),p={};for(const w of c)p[`${w.mint}`]=w.amount;o.poolBalance=p;const h=await St(e.connection,u.value.data.poolMint);o.poolTokenSupply=Number(h.supply),console.log("[Pool Balance] poolMint",h),console.log("[Pool Balance]",o.poolBalance),console.log("[Pool Balance] poolTokenSupply",o.poolTokenSupply)}catch(c){console.log("[Pool Balance] error",c)}finally{me.value=!1}}},500);setInterval(D,6e4);function je(c){u.value=c,console.log("setTokenSwap: ",u.value)}S([A,()=>t.servicePolicy],async()=>{console.log("tokenSwapsAll: ",A.value),k.value=A.value.filter(c=>!!t.servicePolicy.find(p=>p.pubkey.toBase58()===c.data.policy?.toBase58()))},{immediate:!0}),S([k,()=>o.from?.mint,()=>o.to?.mint,()=>t.servicePolicy],async()=>{if(console.log("tokenSwapsAllFiltered: ",k.value),k.value&&o.from?.mint&&o.to?.mint&&o.from.mint!==o.to.mint&&t.servicePolicy.length)if(g.value=k.value.filter(c=>{const p=c.data?.tokenAMint.toBase58(),h=c.data?.tokenBMint.toBase58();return p===o.from.mint&&h===o.to.mint||p===o.to.mint&&h===o.from.mint}),g.value.length){if(g.value.length>1){const c=g.value.find(p=>t.state.certificates?.find(h=>h.data?.policy.toBase58()===p.data.policy?.toBase58()));c&&(u.value=c)}u.value=g.value[0]}else u.value=void 0;else g.value=[],u.value=void 0,t.setContractPolicy("","swap"),o.poolBalance={}},{immediate:!0}),S([u],async()=>{console.log("Token SWAP: ",u.value),t.setContractPolicy(u.value?.data.policy?.toBase58()??"","swap"),u.value&&(D(),u.value.data.tokenAMint.toBase58()===o.from.mint?o.direction=0:o.direction=1)},{immediate:!0});function Ze(){o.loading=!1,o.slippageDialog=!1,o.poolBalance={},o.poolTokenSupply=0}S([()=>o.direction,()=>o.from.amount,()=>o.poolBalance],async()=>{const c=Number(o.from.amount??0),p=Ke(Number(o.poolBalance[o.from.mint]??0),o.from.decimals),h=Ke(Number(o.poolBalance[o.to.mint]??0),o.to.decimals);if(c===0||Number.isNaN(c)){o.to.amount=0,o.rate=Number(h)/Number(p),o.impact=0,o.minimumReceived=0;return}const w=h-p*h/(p+c);o.rate=c?w/c:h/p,o.to.amount=w?Number(At(w*(1-o.fees.ownerTrade-o.fees.trade),o.to.decimals)):0,o.impact=c?1-w/c/(h/p):0,o.minimumReceived=C(o.to.amount-o.to.amount*o.slippage,o.to.decimals)},{immediate:!0});async function Xe(){if(!t.certificateValid)return gt();if(!u.value||!r.value){console.log("TokenSwap is not initialized...");return}n.value.publicKey||s({type:"info",message:"Please connect your wallet first"});const p=Number(C(o.from.amount??0,o.from.decimals)),h=Number(C(t.tokenBalance(o.from.mint)??0,o.from.decimals)),w=Number(C(o.to.amount??0,o.to.decimals));if(p>h){s({type:"negative",message:"Insufficient balance."});return}try{o.swapping=!0;const W=o.direction===0?u.value.data.tokenAMint:u.value.data.tokenBMint,I=o.direction===0?u.value.data.tokenBMint:u.value.data.tokenAMint,Te=o.direction===0?u.value.data.tokenA:u.value.data.tokenB,Be=o.direction===0?u.value.data.tokenB:u.value.data.tokenA;console.log("userSourceMint = ",W.toBase58()),console.log("userDestinationMint = ",I.toBase58()),console.log("userSourceMint = ",W.toBase58()),console.log("userDestinationMint = ",I.toBase58());const Me=await fe(W,n.value.publicKey),Ee=await fe(I,n.value.publicKey),Fe=p;console.log("toAmount = ",w),console.log("slippage = ",o.slippage),console.log("slippage 2 = ",w*o.slippage);const We=l.value.swapAuthority(u.value.pubkey);console.log("proofRequest = ",t.certificate?.pubkey.toBase58()),console.log("swapAuthority = ",We),console.log("tokenSwap = ",u.value.pubkey.toBase58()),console.log("userSource = ",Me.toBase58()),console.log("userDestination = ",Ee.toBase58()),console.log("poolSource = ",Te.toBase58()),console.log("poolDestination = ",Be.toBase58()),console.log("poolMint = ",u.value.data.poolMint.toBase58()),console.log("poolFee = ",u.value.data.poolFeeAccount.toBase58()),console.log("amountIn = ",Fe),console.log("minimumAmountOut = ",o.minimumReceived);const ot=await l.value.swap({proofRequest:t.certificate?.pubkey,authority:We,tokenSwap:u.value.pubkey,userSource:Me,userDestination:Ee,poolSource:Te,poolDestination:Be,poolMint:u.value.data.poolMint,poolFee:u.value.data.poolFeeAccount,amountIn:Fe,minimumAmountOut:o.minimumReceived,sourceTokenMint:W,destinationTokenMint:I},{commitment:"confirmed"});s({message:"Transaction confirmed",type:"positive",actions:[{label:"Explore",color:"white",target:"_blank",href:`https://explorer.solana.com/tx/${ot}?cluster=${e.cluster}`,onClick:()=>!1}]}),be()}catch(W){console.log(W)}finally{o.swapping=!1}}function Ye(){const{from:c,to:p}=o;o.rate=0,o.to={...c,amount:void 0},o.from={...p,amount:void 0},o.direction=o.direction===0?1:0}function _e(){o.slippageDialog=!0}function et(){o.slippageDialog=!1}function tt(c){o.from.amount=c}function be(){D(),o.from.amount=void 0,o.to.amount=void 0}S(()=>n.value?.publicKey,c=>{c||be()}),S(()=>o.to,c=>{c.amount&&(c.amount=void 0)});function ve(c){return{host:N(c.fees.hostFeeNumerator,c.fees.hostFeeDenominator),trade:N(c.fees.tradeFeeNumerator,c.fees.tradeFeeDenominator),ownerTrade:N(c.fees.ownerTradeFeeNumerator,c.fees.ownerTradeFeeDenominator),ownerWithdraw:N(c.fees.ownerWithdrawFeeNumerator,c.fees.ownerWithdrawFeeDenominator)}}return S(u,c=>{if(!c)return;const p=ve(c.data);o.fees.host=p.host,o.fees.trade=p.trade,o.fees.ownerTrade=p.ownerTrade,o.fees.ownerWithdraw=p.ownerWithdraw,console.log("fees ==== ",o.fees)}),{state:o,tokenSwapsAllFiltered:k,tokenSwaps:g,tokenSwap:u,swapClient:l,loadingPoolTokens:me,loadPoolTokenAccounts:D,setTokenSwap:je,setMax:tt,closeSlippage:et,openSlippage:_e,changeDirection:Ye,swapSubmit:Xe,getPoolFee:ve,tokenAMint:T,tokenBMint:P,userPoolsTokens:v}});export{Yt as S,Je as s,oo as u};
