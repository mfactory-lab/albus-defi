import{_ as R,a as U,b as G}from"./AppDescriptionTop-5cde9845.js";import{_ as K}from"./PoolsListItem.vue_vue_type_script_setup_true_lang-0cff7acd.js";import{aE as $,aF as D,s as Q,G as m,u as H,t as J,v as _,aG as N,C as P,ax as k,aH as E,V as C,o as v,i as y,j as g,a3 as t,a9 as I,a2 as u,a5 as V,aI as j,y as W,aJ as Y,aK as z,a4 as x,ad as q,aL as X,Y as Z,_ as oo}from"./index-a2855520.js";import{u as F}from"./swap-cb94d25d.js";import"./associatedTokenAccount-fb973eb5.js";async function eo(){const{data:r}=await $.get(`${D}`);return r}async function to(){const{data:r}=await $.get(`${D}/transactions?type=swap`);return r}async function so(){const{data:r}=await $.get(`${D}/coin-price`);return r}const O=Q("pools-stats",()=>{const r=m([]),a=m(!0),n=m([]),l=m(!0),i=m({}),d=m(!0),T=m({}),B=m({tvl:0,volume24:0,fees24:0}),M=H(),S=J(),b=F(),A=_(()=>b.tokenSwapsAllFiltered),L=N(async()=>{a.value=!0;try{r.value=await eo()}catch(s){console.error("get pools data: ",s)}finally{a.value=!1}},500);P(A,L,{immediate:!0});const w=N(async()=>{l.value=!0;try{n.value=await to()}catch(s){console.error("get tx data: ",s)}finally{l.value=!1}},500);P(()=>M.cluster,w,{immediate:!0}),setInterval(w,6e4);const p=N(async()=>{d.value=!0;try{i.value=await so()}catch(s){console.error("get tx data: ",s)}finally{d.value=!1}},500);return p(),setInterval(p,6e4),P([r,n,i],()=>{if(a.value||l.value||d.value)return;const s={tvl:0,volume24:0,fees24:0},e=A.value.reduce((o,f)=>(o[f.pubkey.toBase58()]={tokenAMint:f.data.tokenAMint.toBase58(),tokenBMint:f.data.tokenBMint.toBase58(),poolTokenSupply:0,amountTokenA:0,amountTokenB:0,tvl:0,volume24:0,fees24:0,apr24:0},o),{});r.value?.forEach(o=>{e[o.address]&&(e[o.address].amountTokenA=Number(o.tokenABalance),e[o.address].amountTokenB=Number(o.tokenBBalance),e[o.address].poolTokenSupply=Number(o.poolTokenSupply))}),n.value?.forEach(o=>{if(e[o.poolAddress]){const f=S.tokenByMint(e[o.poolAddress].tokenAMint),h=S.tokenByMint(e[o.poolAddress].tokenBMint);if(Number(o.amountTokenA)>0){const c=k(Number(o.amountTokenA),f?.decimals)*o.priceTokenA;e[o.poolAddress].volume24+=c,e[o.poolAddress].fees24+=k(Number(o.feeTokenB),h?.decimals)*o.priceTokenB,s.volume24+=c}if(Number(o.amountTokenB)>0){const c=k(Number(o.amountTokenB),h?.decimals)*o.priceTokenB;e[o.poolAddress].volume24+=k(Number(o.amountTokenB),h?.decimals)*o.priceTokenB,s.volume24+=c}if(Number(o.feeTokenA)>0){const c=k(Number(o.feeTokenA),f?.decimals)*o.priceTokenA;e[o.poolAddress].fees24+=c,s.fees24+=c}if(Number(o.feeTokenB)>0){const c=k(Number(o.feeTokenB),h?.decimals)*o.priceTokenB;e[o.poolAddress].fees24+=c,s.fees24+=c}}}),Object.keys(e).forEach(o=>{const f=S.tokenByMint(e[o].tokenAMint),h=S.tokenByMint(e[o].tokenBMint),c=k(e[o].amountTokenA,f?.decimals)*(i.value[E[e[o].tokenAMint]]??0)+k(e[o].amountTokenB,h?.decimals)*(i.value[E[e[o].tokenBMint]]??0);e[o].tvl=c,s.tvl+=c,e[o].apr24=e[o].fees24/e[o].tvl*365}),T.value=e,B.value=s,console.log("[pools stats]: ",e),console.log("[pools stats] total: ",s)}),{poolsLoading:a,txLoading:l,priceLoading:d,poolsStats:T,poolsStatsTotal:B}}),ao={class:"row justify-start"},no={class:"pools-total q-mr-md q-mb-md"},lo=u("div",{class:"pools-total__name"}," Total value locked ",-1),co={class:"pools-total__value"},ro={class:"pools-total q-mb-md"},io=u("div",{class:"pools-total__name"}," Volume 24h ",-1),uo={class:"pools-total__value"},po=C({__name:"PoolsTotal",setup(r){const a=O(),n=_(()=>a.poolsStatsTotal),l=_(()=>a.poolsLoading),i=_(()=>a.txLoading),d=_(()=>a.priceLoading);return(T,B)=>(v(),y("div",null,[g(I,{showing:t(n).tvl===0&&(t(l)||t(i)||t(d)),class:"swap-loading",color:"grey"},null,8,["showing"]),u("div",ao,[u("div",no,[lo,u("div",co," $"+V(t(j).format(t(n).tvl)),1)]),u("div",ro,[io,u("div",uo," $"+V(t(j).format(t(n).volume24)),1)])])]))}}),mo={key:0,class:"full-width row items-center justify-start q-px-lg"},_o={key:0,class:"q-mb-md q-ml-auto"},fo=u("span",{class:"q-mr-sm"},"My Liquidity",-1),ko={class:"full-width"},vo={class:"row justify-center q-pl-lg"},go={key:0,class:"text-h5"},yo=C({__name:"PoolsList",setup(r){const{connected:a}=W(),n=m(!1),l=F(),i=_(()=>l.tokenSwapsAllFiltered.filter(b=>!a.value||!n.value||l.userPoolsTokens[b.data.poolMint.toBase58()])),d=_(()=>l.userPoolsTokens),{state:T}=l,B=O(),M=_(()=>B.poolsLoading),S=_(()=>B.poolsStats);return(b,A)=>{const L=po,w=K;return v(),y(q,null,[t(a)?(v(),y("div",mo,[g(L,{class:"q-mb-md"}),t(a)?(v(),y("div",_o,[fo,g(z,{modelValue:t(n),"onUpdate:modelValue":A[0]||(A[0]=p=>Y(n)?n.value=p:null),color:"secondary",dense:"",class:"app-toggle"},null,8,["modelValue"])])):x("",!0)])):x("",!0),u("div",ko,[g(I,{showing:t(T)?.loading||t(M),class:"swap-loading",color:"grey"},null,8,["showing"]),u("div",vo,[(v(!0),y(q,null,X(t(i),(p,s)=>(v(),Z(w,{key:p.pubkey.toBase58()??s,pubkey:p.pubkey,data:p.data,"user-tokens":t(d)[p.data.poolMint.toBase58()],"pool-stats":t(S)[p.pubkey.toBase58()],class:"q-mr-lg q-mb-lg"},null,8,["pubkey","data","user-tokens","pool-stats"]))),128)),!t(T).loading&&!t(i).length?(v(),y("div",go," Pools not found ")):x("",!0)])])],64)}}}),To={},Bo={class:"main-block row justify-center"};function So(r,a){const n=R,l=yo,i=U,d=G;return v(),y(q,null,[g(n,{class:"q-mt-lg"}),u("div",Bo,[g(l)]),g(i,{class:"q-mt-lg"}),g(d,{class:"q-mt-lg"})],64)}const Lo=oo(To,[["render",So]]);export{Lo as default};
