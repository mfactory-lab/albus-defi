import{_ as eo,a as ao,b as to}from"./AppDescriptionTop-2f6245df.js";import{o as no,_ as so}from"./PolicyCard.vue_vue_type_script_setup_true_lang-34172639.js";import{s as lo,_ as io}from"./swap-circle-c986f5ce.js";import{_ as co}from"./SelectToken.vue_vue_type_script_setup_true_lang-25f3a3f0.js";import{s as uo,u as ro,w as O,x as po,y as mo,z as _o,v as p,B as fo,C as X,ax as C,a6 as B,aF as F,Q as go,I as W,aG as ko,V as vo,W as wo,H as yo,G as ho,o as q,i as M,j as s,Z as r,$ as E,a3 as o,ay as Bo,ad as Z,a1 as K,a0 as I,a2 as a,a5 as c,a4 as To,a7 as G,a8 as P,az as bo,aA as So,aB as Ao,a9 as xo,aC as qo,aD as Mo,_ as Co}from"./index-3eaef042.js";import{u as J}from"./swap-1182c459.js";import"./PoolsListItem.vue_vue_type_script_setup_true_lang-d96397ca.js";import"./associatedTokenAccount-c139d347.js";const Do=uo("liquidity",()=>{const H=ro(),g=O(),e=po(),{publicKey:S}=mo(),{notify:T}=_o(),m=J(),l=p(()=>m.tokenSwap),n=p(()=>m.state),D=p(()=>m.swapClient),t=fo({slippageDialog:!1,swapping:!1,active:!1,slippage:.01,rate:0,maxTokenB:0,amountTokenA:0,amountTokenB:0});X([()=>n.value.direction,()=>n.value.from.amount,()=>n.value.poolBalance],async()=>{const _=Number(t.amountTokenA??0),d=C(Number(n.value.poolBalance[n.value.from.mint]??0),n.value.from.decimals),k=C(Number(n.value.poolBalance[n.value.to.mint]??0),n.value.to.decimals);if(_===0||Number.isNaN(_)){t.amountTokenB=0,t.rate=Number(k)/Number(d),t.maxTokenB=0;return}const v=k-d*k/(d+_);t.rate=_?v/_:k/d,t.amountTokenB=v?Number(B(v*(1-n.value.fees.ownerTrade-n.value.fees.trade),n.value.to.decimals)):0,t.maxTokenB=F(t.amountTokenB+t.amountTokenB*t.slippage,n.value.to.decimals)},{immediate:!0});function i(){m.loadPoolTokenAccounts(),t.amountTokenA=0,t.amountTokenB=0}async function R(){if(!g.certificateValid)return go();if(!l.value||!S.value){console.log("TokenSwap is not initialized...");return}e.value.publicKey||T({type:"info",message:"Please connect your wallet first"});const d=Number(F(t.amountTokenA??0,n.value.from.decimals)),k=Number(F(g.tokenBalance(n.value.from.mint)??0,n.value.from.decimals)),v=Number(F(t.amountTokenB??0,n.value.to.decimals));if(d>k){T({type:"negative",message:"Insufficient balance."});return}try{t.swapping=!0;const w=n.value.direction===0?l.value.data.tokenAMint:l.value.data.tokenBMint,y=n.value.direction===0?l.value.data.tokenBMint:l.value.data.tokenAMint,V=n.value.direction===0?l.value.data.tokenA:l.value.data.tokenB,b=n.value.direction===0?l.value.data.tokenB:l.value.data.tokenA;console.log("userSourceMint = ",w.toBase58()),console.log("userDestinationMint = ",y.toBase58()),console.log("userSourceMint = ",w.toBase58()),console.log("userDestinationMint = ",y.toBase58());const L=await W(w,e.value.publicKey),$=await W(y,e.value.publicKey),A=d;console.log("toAmount = ",v),console.log("slippage = ",t.slippage),console.log("slippage 2 = ",v*t.slippage);const Q=D.value.swapAuthority(l.value.pubkey);console.log("proofRequest = ",g.certificate?.pubkey.toBase58()),console.log("swapAuthority = ",Q),console.log("tokenSwap = ",l.value.pubkey.toBase58()),console.log("userSource = ",L.toBase58()),console.log("userDestination = ",$.toBase58()),console.log("poolSource = ",V.toBase58()),console.log("poolDestination = ",b.toBase58()),console.log("poolMint = ",l.value.data.poolMint.toBase58()),console.log("poolFee = ",l.value.data.poolFeeAccount.toBase58()),console.log("amountIn = ",A),console.log("maxTokenB = ",t.maxTokenB);const x=await D.value.swap({proofRequest:g.certificate?.pubkey,authority:Q,tokenSwap:l.value.pubkey,userSource:L,userDestination:$,poolSource:V,poolDestination:b,poolMint:l.value.data.poolMint,poolFee:l.value.data.poolFeeAccount,amountIn:A,minimumAmountOut:t.maxTokenB,sourceTokenMint:w,destinationTokenMint:y},{commitment:"confirmed"});ko(`https://explorer.solana.com/tx/${x}?cluster=${H.cluster}`),i()}catch(w){console.log(w)}finally{t.swapping=!1}}function N(){t.slippageDialog=!0}function U(){t.slippageDialog=!1}return{state:t,closeSlippage:U,openSlippage:N,addLiquiditySubmit:R}}),No={class:"swap-form"},Vo={class:"swap-field"},Lo={class:"swap-field__info"},$o={class:"row items-end"},Qo=a("div",{class:"col swap-field__label"},null,-1),Fo={class:"col-8 col-xs-10 row justify-end swap-field__balance"},Io={key:0,class:"insufficient-error"},Po={class:"swap-change"},Ho=["innerHTML"],Ro={class:"swap-field"},Uo={class:"swap-field__info q-mt-sm"},Ko={class:"row"},zo={class:"col swap-field__balance"},jo={class:"swap-info q-mt-md q-pt-xs"},Wo=a("dt",null,"Max amount",-1),Eo=a("dt",null,"Slippage Tolerance",-1),Go={class:"swap-submit q-mt-md"},Oo={key:0,class:"text-weight-medium fs-13 text-center q-mt-md text-negative"},Xo={key:1,class:"row q-mt-md text-center relative-position full-width"},Zo={class:"swap-rate q-mx-auto"},Jo={class:"absolute-right swap-rate__refresh"},Yo={class:"swap-info q-mt-md"},oe=vo({__name:"LiquidityCard",setup(H){const g=J(),{state:e,loadingPoolTokens:S,changeDirection:T,openSlippage:m,closeSlippage:l,setMax:n,loadPoolTokenAccounts:D}=g,t=p(()=>g.tokenSwap),z=Do(),{state:i,addLiquiditySubmit:R}=z,{handleSearchToken:N,handleFilterToken:U,tokens:_}=wo();U(yo);const d=O(),k=p(()=>e.poolBalance[e.from.mint]?C(e.poolBalance[e.from.mint],e.from.decimals):0),v=p(()=>e.poolBalance[e.to.mint]?C(e.poolBalance[e.to.mint],e.to.decimals):0),w=h=>Mo.format(h),y=ho(0),V=p(()=>`transform: rotate(${y.value*180}deg)`),b=p(()=>d.tokenBalance(e.from.mint)),L=p(()=>d.tokenBalance(e.to.mint));function $(){T(),y.value++}function A(h,u){e[u?"to":"from"]=h}function Q(){n(b.value)}const x=p(()=>Number(i.amountTokenA)>b.value?"Insufficient funds":!1);return X(()=>i.amountTokenA,h=>{i.active=!x.value}),(h,u)=>{const j=co,Y=io,oo=so;return q(),M(Z,null,[s(E,{class:"swap-card swap-widget"},{default:r(()=>[s(K,{class:"swap-card__header"},{default:r(()=>[I(" Liquidity ")]),_:1}),s(K,{class:"swap-card__body"},{default:r(()=>[a("div",No,[a("div",Vo,[a("div",Lo,[a("div",$o,[Qo,a("div",Fo,[o(x)?(q(),M("div",Io,c(o(x)),1)):To("",!0),I(" Balance: "+c(o(B)(o(b)))+" "+c(o(e).from.symbol),1)])])]),s(G,{modelValue:o(i).amountTokenA,"onUpdate:modelValue":u[0]||(u[0]=f=>o(i).amountTokenA=f),maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input",onKeypress:o(no)},{append:r(()=>[s(P,{dense:"",unelevated:"",ripple:!1,class:"swap-input__max",onClick:Q},{default:r(()=>[I(" MAX ")]),_:1}),s(j,{options:o(_),token:o(e).from,"swap-token":String(o(e).to.symbol),onHandleSearchToken:o(N),onSetToken:A},null,8,["options","token","swap-token","onHandleSearchToken"])]),_:1},8,["modelValue","onKeypress"])]),a("div",Po,[s(P,{ripple:!1,dense:"",unelevated:"",style:bo(o(V)),onClick:$},{default:r(()=>[a("i",{innerHTML:o(lo)},null,8,Ho)]),_:1},8,["style"])]),a("div",Ro,[a("div",Uo,[a("div",Ko,[a("div",zo," Balance: "+c(o(B)(o(L)))+" "+c(o(e).to.symbol),1)])]),s(G,{modelValue:o(i).amountTokenB,"onUpdate:modelValue":u[1]||(u[1]=f=>o(i).amountTokenB=f),readonly:"",maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input"},{append:r(()=>[s(j,{"swap-token":String(o(e).from.symbol),options:o(_),direction:!0,token:o(e).to,"destination-unavailable":!o(t),onHandleSearchToken:o(N),onSetToken:A},null,8,["swap-token","options","token","destination-unavailable","onHandleSearchToken"])]),_:1},8,["modelValue"])])]),a("div",jo,[a("dl",null,[Wo,a("dd",null,c(o(B)(o(C)(o(i).maxTokenB,o(e).to.decimals)))+" "+c(o(e).to.symbol.toUpperCase()),1)]),a("dl",null,[Eo,a("dd",null,[a("a",{href:"#",onClick:u[2]||(u[2]=(...f)=>o(m)&&o(m)(...f))},c(w(o(i).slippage)),1)])])]),s(Y,{class:"q-mt-md"}),s(oo,{class:"q-mt-md q-mx-auto"}),a("div",Go,[s(P,{loading:o(i).swapping,disable:!o(i).active||!o(t),rounded:"",ripple:!1,onClick:o(R)},{default:r(()=>[I(" Add Liquidity ")]),_:1},8,["loading","disable","onClick"])]),o(t)?(q(),M("div",Xo,[a("div",Zo," 1 "+c(o(e).from.symbol)+" â‰ˆ "+c(o(B)(o(e).rate))+" "+c(o(e).to.symbol),1),a("div",Jo,[s(P,{loading:o(S),class:"swap-card__reload",unelevated:"",color:h.$q.dark.isActive?"white":"primary",round:"",onClick:o(D)},{default:r(()=>[s(So,{name:o(Ao),color:h.$q.dark.isActive?"primary":"white"},null,8,["name","color"])]),_:1},8,["loading","color","onClick"])])])):(q(),M("div",Oo," Pool not found ")),a("div",Yo,[a("dl",null,[a("dt",null,"Pool "+c(o(e).from.symbol)+" balance",1),a("dd",null,c(o(B)(o(k))),1)]),a("dl",null,[a("dt",null,"Pool "+c(o(e).to.symbol)+" balance",1),a("dd",null,c(o(B)(o(v))),1)])])]),_:1}),s(xo,{showing:o(e)?.loading,class:"swap-loading",color:"grey"},null,8,["showing"])]),_:1}),s(Bo,{modelValue:o(i).slippageDialog,"onUpdate:modelValue":u[4]||(u[4]=f=>o(i).slippageDialog=f),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:r(()=>[s(E,null,{default:r(()=>[s(K,null,{default:r(()=>[s(qo,{modelValue:o(i).slippage,"onUpdate:modelValue":[u[3]||(u[3]=f=>o(i).slippage=f),o(l)],spread:"","no-caps":"",unelevated:"",ripple:!1,"toggle-color":"secondary",color:"white","text-color":"dark",options:[{label:"0.1%",value:.001},{label:"0.5%",value:.005},{label:"1%",value:.01},{label:"5%",value:.05}]},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),ee={},ae={class:"main-block row justify-center"};function te(H,g){const e=eo,S=oe,T=ao,m=to;return q(),M(Z,null,[s(e,{class:"q-mt-lg"}),a("div",ae,[s(S)]),s(T,{class:"q-mt-lg"}),s(m,{class:"q-mt-lg"})],64)}const pe=Co(ee,[["render",te]]);export{pe as default};
