import{_ as ao,a as no,b as to}from"./AppDescriptionTop-cb3d9878.js";import{_ as lo}from"./PolicyCard.vue_vue_type_script_setup_true_lang-896d9f7f.js";import{_ as so}from"./SelectPool.vue_vue_type_script_setup_true_lang-ee77ed37.js";import{_ as io}from"./SelectToken.vue_vue_type_script_setup_true_lang-07257198.js";import{s as uo,u as co,w as G,x as mo,y as ro,z as po,v as _,B as ko,C as J,ax as D,a6 as B,aH as v,I as H,V as fo,W as _o,H as W,o as q,i as V,j as s,Z as d,$ as O,a3 as o,ay as go,ad as Y,a1 as L,a0 as C,a2 as t,a5 as u,a4 as X,a7 as z,a8 as K,aA as vo,aB as To,a9 as Ao,aC as Bo,aD as wo,X as yo,ab as bo,ac as ho,N as So,_ as xo}from"./index-6926c3bf.js";import{o as Z}from"./common-21d1f462.js";import{u as oo}from"./swap-4760e605.js";import"./PoolsListItem.vue_vue_type_script_setup_true_lang-21a922b2.js";import"./associatedTokenAccount-f565638e.js";const No=uo("liquidity",()=>{const Q=co(),h=G(),n=mo(),{publicKey:$}=ro(),{notify:g}=po(),p=oo(),i=_(()=>p.tokenSwap),e=_(()=>p.state),I=_(()=>p.swapClient),a=ko({slippageDialog:!1,swapping:!1,active:!1,slippage:.01,rate:0,poolAmount:0,amountTokenA:0,amountTokenB:0,maxAmountTokenA:0,maxAmountTokenB:0}),E=async(T=!1)=>{console.log("calcRate ====== ");const w=Number((T?a.amountTokenB:a.amountTokenA)??0);console.log("calcRate changedToken ====== ",w);const S=Number(D(Number(e.value.poolBalance[e.value.from.mint]??0),e.value.from.decimals)),x=Number(D(Number(e.value.poolBalance[e.value.to.mint]??0),e.value.to.decimals)),k=T?S/x:x/S;if(w===0||Number.isNaN(w)){console.log("calcRate clear ====== "),a.poolAmount=0,T?(a.amountTokenA=0,a.maxAmountTokenA=0):(a.amountTokenB=0,a.maxAmountTokenB=0);return}console.log("calcRate rate ====== ",k),T?a.amountTokenA=Number(B(k*a.amountTokenB,e.value.to.decimals)):a.amountTokenB=Number(B(k*a.amountTokenA,e.value.from.decimals)),a.maxAmountTokenA=a.amountTokenA*(1+a.slippage),a.maxAmountTokenB=a.amountTokenB*(1+a.slippage);const c=a.amountTokenA,f=e.value.from;a.poolAmount=Math.floor(v(c,f.decimals)/e.value.poolBalance[f.mint]*e.value.poolTokenSupply)};J([()=>e.value.poolBalance,()=>a.slippage],()=>E(),{immediate:!0});function j(){p.loadPoolTokenAccounts(),a.maxAmountTokenA=0,a.maxAmountTokenB=0,a.amountTokenA=0,a.amountTokenB=0}async function R(){if(!i.value||!$.value){console.log("TokenSwap is not initialized...");return}n.value.publicKey||g({type:"info",message:"Please connect your wallet first"});const w=Number(v(a.amountTokenA??0,e.value.from.decimals)),S=Number(v(h.tokenBalance(e.value.from.mint)??0,e.value.from.decimals));if(w>S){g({type:"negative",message:`Insufficient balance ${e.value.from.symbol}.`});return}const x=Number(v(a.amountTokenA??0,e.value.to.decimals)),k=Number(v(h.tokenBalance(e.value.to.mint)??0,e.value.to.decimals));if(x>k){g({type:"negative",message:`Insufficient balance ${e.value.to.symbol}.`});return}try{a.swapping=!0;let c=a.amountTokenA,f=a.amountTokenB,y=e.value.from,A=e.value.to;i.value.data.tokenBMint.toBase58()===e.value.from.mint&&(c=a.amountTokenB,f=a.amountTokenA,y=e.value.to,A=e.value.from);const N=await H(i.value.data.tokenAMint,n.value.publicKey),m=await H(i.value.data.tokenBMint,n.value.publicKey),l=await H(i.value.data.poolMint,n.value.publicKey);console.log("slippage = ",a.slippage);const b=I.value.swapAuthority(i.value.pubkey);console.log("destination = ",l.toBase58()),console.log("userTokenA = ",N.toBase58()),console.log("userTokenB = ",m.toBase58()),console.log("swapAuthority = ",b.toBase58()),console.log("tokenSwap = ",i.value.pubkey.toBase58()),console.log("poolMint = ",i.value.data.poolMint.toBase58()),console.log("swapTokenA Mint = ",i.value.data.tokenAMint.toBase58()),console.log("swapTokenA = ",i.value.data.tokenA.toBase58()),console.log("swapTokenB Mint = ",i.value.data.tokenBMint.toBase58()),console.log("swapTokenB = ",i.value.data.tokenB.toBase58()),console.log("TokenA = ",y.symbol),console.log("maximumTokenA = ",c),console.log("maximumTokenA = ",v(c,y.decimals)),console.log("TokenB = ",A.symbol),console.log("maximumTokenB = ",f),console.log("maximumTokenB = ",v(f,A.decimals)),console.log("poolTokenAmount = ",a.poolAmount);const M=await I.value.depositAllTokenTypes({tokenSwap:i.value.pubkey,poolMint:i.value.data.poolMint,destination:l,userTokenA:N,userTokenB:m,swapTokenA:i.value.data.tokenA,swapTokenB:i.value.data.tokenB,poolTokenAmount:a.poolAmount,maximumTokenA:Math.floor(v(c,y.decimals)*(1+a.slippage)),maximumTokenB:Math.floor(v(f,A.decimals)*(1+a.slippage)),tokenAMint:i.value.data.tokenAMint,tokenBMint:i.value.data.tokenBMint},{commitment:"confirmed"});g({message:"Transaction confirmed",type:"positive",actions:[{label:"Explore",color:"white",target:"_blank",href:`https://explorer.solana.com/tx/${M}?cluster=${Q.cluster}`,onClick:()=>!1}]}),j()}catch(c){console.log(c),`${c}`.includes("User rejected the request")||g({type:"negative",message:`${c}`})}finally{a.swapping=!1}}function F(){a.slippageDialog=!0}function U(){a.slippageDialog=!1}return{state:a,calcRate:E,closeSlippage:U,openSlippage:F,depositBothTokens:R}}),Mo={class:"swap-form"},Co={class:"swap-field"},qo={class:"swap-field__info"},Vo={class:"row items-end justify-end"},$o={class:"col-8 col-xs-10 row justify-end swap-field__balance"},Eo={key:0,class:"insufficient-error"},Po={class:"swap-field q-pt-xs"},Do={class:"swap-field__info q-mt-sm"},Io={class:"row items-end justify-end"},Ro={class:"col-8 col-xs-10 row justify-end swap-field__balance"},Uo={key:0,class:"insufficient-error"},Ko={class:"swap-info q-mt-md q-pt-xs"},Qo=t("dt",null,"Pool tokens amount",-1),jo=t("dt",null,"Slippage Tolerance",-1),Fo={class:"swap-submit q-mt-md"},Ho={key:0,class:"text-weight-medium fs-13 text-center q-mt-md text-negative"},Lo={key:1,class:"row q-mt-md text-center relative-position full-width"},Wo={class:"absolute-right swap-rate__refresh"},Oo={class:"swap-info q-mt-md"},Xo=fo({__name:"DepositBothCard",setup(Q){const h=oo(),{state:n,loadingPoolTokens:$,loadPoolTokenAccounts:g}=h,p=_(()=>h.tokenSwap),i=No(),{state:e,depositBothTokens:I,calcRate:a,openSlippage:E,closeSlippage:j}=i,{handleSearchToken:R,handleFilterToken:F,tokens:U}=_o();F(W);const T=G(),w=_(()=>n.poolBalance[n.from.mint]?D(n.poolBalance[n.from.mint],n.from.decimals):0),S=_(()=>n.poolBalance[n.to.mint]?D(n.poolBalance[n.to.mint],n.to.decimals):0),x=m=>wo.format(m),k=_(()=>T.tokenBalance(n.from.mint)),c=_(()=>T.tokenBalance(n.to.mint));function f(m,l){n[l?"to":"from"]=m}function y(m=!1){const l=m?"to":"from",b=m?"amountTokenB":"amountTokenA",M=m?c.value:k.value;n[l]?.mint===W||n[l]?.mint===yo?e[b]=M-bo-3*ho-So:e[b]=M,a(m)}const A=_(()=>Number(e.amountTokenA)>k.value?"Insufficient funds":!1),N=_(()=>Number(e.amountTokenB)>c.value?"Insufficient funds":!1);return J([()=>e.amountTokenA,k,()=>e.amountTokenB,c],m=>{e.active=!A.value&&!N.value}),(m,l)=>{const b=io,M=so,eo=lo;return q(),V(Y,null,[s(O,{class:"swap-card swap-widget"},{default:d(()=>[s(L,{class:"swap-card__header"},{default:d(()=>[C(" Deposit ")]),_:1}),s(L,{class:"swap-card__body"},{default:d(()=>[t("div",Mo,[t("div",Co,[t("div",qo,[t("div",Vo,[t("div",$o,[o(A)?(q(),V("div",Eo,u(o(A)),1)):X("",!0),C(" Balance: "+u(o(B)(o(k)))+" "+u(o(n).from.symbol),1)])])]),s(z,{modelValue:o(e).amountTokenA,"onUpdate:modelValue":[l[1]||(l[1]=r=>o(e).amountTokenA=r),l[2]||(l[2]=r=>{const P=String(r);P[P.length-1]!=="."&&o(a)()})],maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input",onKeypress:o(Z)},{append:d(()=>[s(K,{dense:"",unelevated:"",ripple:!1,class:"swap-input__max",onClick:l[0]||(l[0]=r=>y())},{default:d(()=>[C(" MAX ")]),_:1}),s(b,{options:o(U),token:o(n).from,"swap-token":String(o(n).to.symbol),onHandleSearchToken:o(R),onSetToken:f},null,8,["options","token","swap-token","onHandleSearchToken"])]),_:1},8,["modelValue","onKeypress"])]),t("div",Po,[t("div",Do,[t("div",Io,[t("div",Ro,[o(N)?(q(),V("div",Uo,u(o(N)),1)):X("",!0),C(" Balance: "+u(o(B)(o(c)))+" "+u(o(n).to.symbol),1)])])]),s(z,{modelValue:o(e).amountTokenB,"onUpdate:modelValue":[l[4]||(l[4]=r=>o(e).amountTokenB=r),l[5]||(l[5]=r=>{const P=String(r);P[P.length-1]!=="."&&o(a)(!0)})],maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input",onKeypress:o(Z)},{append:d(()=>[s(K,{dense:"",unelevated:"",ripple:!1,class:"swap-input__max",onClick:l[3]||(l[3]=r=>y(!0))},{default:d(()=>[C(" MAX ")]),_:1}),s(b,{"swap-token":String(o(n).from.symbol),options:o(U),direction:!0,token:o(n).to,"destination-unavailable":!o(p),onHandleSearchToken:o(R),onSetToken:f},null,8,["swap-token","options","token","destination-unavailable","onHandleSearchToken"])]),_:1},8,["modelValue","onKeypress"])])]),t("div",Ko,[t("dl",null,[t("dt",null,"Max "+u(o(n).from.symbol.toUpperCase())+" amount",1),t("dd",null,u(o(B)(o(e).maxAmountTokenA,o(n).from.decimals))+" "+u(o(n).from.symbol.toUpperCase()),1)]),t("dl",null,[t("dt",null,"Max "+u(o(n).to.symbol.toUpperCase())+" amount",1),t("dd",null,u(o(B)(o(e).maxAmountTokenB,o(n).to.decimals))+" "+u(o(n).to.symbol.toUpperCase()),1)]),t("dl",null,[Qo,t("dd",null,u(o(D)(o(e).poolAmount,9)),1)]),t("dl",null,[jo,t("dd",null,[t("a",{href:"#",onClick:l[6]||(l[6]=(...r)=>o(E)&&o(E)(...r))},u(x(o(e).slippage)),1)])])]),s(M,{class:"q-mt-md"}),s(eo,{class:"q-mt-md q-mx-auto"}),t("div",Fo,[s(K,{loading:o(e).swapping,disable:!o(e).active||!o(p)||!o(e).amountTokenA,rounded:"",ripple:!1,onClick:o(I)},{default:d(()=>[C(" Add Liquidity ")]),_:1},8,["loading","disable","onClick"])]),o(p)?(q(),V("div",Lo,[t("div",Wo,[s(K,{loading:o($),class:"swap-card__reload",unelevated:"",color:m.$q.dark.isActive?"white":"primary",round:"",onClick:o(g)},{default:d(()=>[s(vo,{name:o(To),color:m.$q.dark.isActive?"primary":"white"},null,8,["name","color"])]),_:1},8,["loading","color","onClick"])])])):(q(),V("div",Ho," Pool not found ")),t("div",Oo,[t("dl",null,[t("dt",null,"Pool "+u(o(n).from.symbol)+" balance",1),t("dd",null,u(o(B)(o(w))),1)]),t("dl",null,[t("dt",null,"Pool "+u(o(n).to.symbol)+" balance",1),t("dd",null,u(o(B)(o(S))),1)])])]),_:1}),s(Ao,{showing:o(n)?.loading,class:"swap-loading",color:"grey"},null,8,["showing"])]),_:1}),s(go,{modelValue:o(e).slippageDialog,"onUpdate:modelValue":l[8]||(l[8]=r=>o(e).slippageDialog=r),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:d(()=>[s(O,null,{default:d(()=>[s(L,null,{default:d(()=>[s(Bo,{modelValue:o(e).slippage,"onUpdate:modelValue":[l[7]||(l[7]=r=>o(e).slippage=r),o(j)],spread:"","no-caps":"",unelevated:"",ripple:!1,"toggle-color":"secondary",color:"white","text-color":"dark",options:[{label:"0.1%",value:.001},{label:"0.5%",value:.005},{label:"1%",value:.01},{label:"5%",value:.05}]},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),zo={},Zo={class:"main-block row justify-center"};function Go(Q,h){const n=ao,$=Xo,g=no,p=to;return q(),V(Y,null,[s(n,{class:"q-mt-lg"}),t("div",Zo,[s($)]),s(g,{class:"q-mt-lg"}),s(p,{class:"q-mt-lg"})],64)}const ie=xo(zo,[["render",Go]]);export{ie as default};
