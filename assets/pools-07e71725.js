import{_ as R,a as G,b as K}from"./AppDescriptionTop-dc342aec.js";import{_ as Q}from"./PoolsListItem.vue_vue_type_script_setup_true_lang-29958987.js";import{aE as q,aF as $,s as U,G as p,u as H,t as J,v as m,aG as L,C as N,ax as f,aH as V,V as C,o as v,i as A,j as k,a3 as t,a9 as I,a2 as g,a5 as D,a6 as E,y as W,aI as Y,aJ as z,a4 as j,ad as P,aK as X,Y as Z,_ as oo}from"./index-248adac9.js";import{u as F}from"./swap-4ae2bda5.js";import"./associatedTokenAccount-f16a5f7e.js";async function eo(){const{data:r}=await q.get(`${$}`);return r}async function to(){const{data:r}=await q.get(`${$}/transactions?type=swap`);return r}async function so(){const{data:r}=await q.get(`${$}/coin-price`);return r}const O=U("pools-stats",()=>{const r=p([]),a=p(!0),n=p([]),l=p(!0),i=p({}),u=p(!0),y=p({}),B=p({tvl:0,volume24:0,fees24:0}),M=H(),T=J(),b=F(),w=m(()=>b.tokenSwapsAllFiltered),x=L(async()=>{a.value=!0;try{r.value=await eo()}catch(s){console.error("get pools data: ",s)}finally{a.value=!1}},500);N(w,x,{immediate:!0});const h=L(async()=>{l.value=!0;try{n.value=await to()}catch(s){console.error("get tx data: ",s)}finally{l.value=!1}},500);N(()=>M.cluster,h,{immediate:!0}),setInterval(h,6e4);const d=L(async()=>{u.value=!0;try{i.value=await so()}catch(s){console.error("get tx data: ",s)}finally{u.value=!1}},500);return d(),setInterval(d,6e4),N([r,n,i],()=>{if(a.value||l.value||u.value)return;const s={tvl:0,volume24:0,fees24:0},e=w.value.reduce((o,_)=>(o[_.pubkey.toBase58()]={tokenAMint:_.data.tokenAMint.toBase58(),tokenBMint:_.data.tokenBMint.toBase58(),poolTokenSupply:0,amountTokenA:0,amountTokenB:0,tvl:0,volume24:0,fees24:0,apr24:0},o),{});r.value?.forEach(o=>{e[o.address]&&(e[o.address].amountTokenA=Number(o.tokenABalance),e[o.address].amountTokenB=Number(o.tokenBBalance),e[o.address].poolTokenSupply=Number(o.poolTokenSupply))}),n.value?.forEach(o=>{if(e[o.poolAddress]){const _=T.tokenByMint(e[o.poolAddress].tokenAMint),S=T.tokenByMint(e[o.poolAddress].tokenBMint);if(Number(o.amountTokenA)>0){const c=f(Number(o.amountTokenA),_?.decimals)*o.priceTokenA;e[o.poolAddress].volume24+=c,e[o.poolAddress].fees24+=f(Number(o.feeTokenB),S?.decimals)*o.priceTokenB,s.volume24+=c}if(Number(o.amountTokenB)>0){const c=f(Number(o.amountTokenB),S?.decimals)*o.priceTokenB;e[o.poolAddress].volume24+=f(Number(o.amountTokenB),S?.decimals)*o.priceTokenB,s.volume24+=c}if(Number(o.feeTokenA)>0){const c=f(Number(o.feeTokenA),_?.decimals)*o.priceTokenA;e[o.poolAddress].fees24+=c,s.fees24+=c}if(Number(o.feeTokenB)>0){const c=f(Number(o.feeTokenB),S?.decimals)*o.priceTokenB;e[o.poolAddress].fees24+=c,s.fees24+=c}}}),Object.keys(e).forEach(o=>{const _=T.tokenByMint(e[o].tokenAMint),S=T.tokenByMint(e[o].tokenBMint),c=f(e[o].amountTokenA,_?.decimals)*(i.value[V[e[o].tokenAMint]]??0)+f(e[o].amountTokenB,S?.decimals)*(i.value[V[e[o].tokenBMint]]??0);e[o].tvl=c,s.tvl+=c,e[o].apr24=e[o].fees24/e[o].tvl*365}),y.value=e,B.value=s,console.log("[pools stats]: ",e),console.log("[pools stats] total: ",s)}),{poolsLoading:a,txLoading:l,priceLoading:u,poolsStats:y,poolsStatsTotal:B}}),no={class:"full-width q-pl-md"},ao={class:"row justify-start text-subtitle1 q-pl-xs"},lo={class:"q-mr-md"},co=C({__name:"PoolsTotal",setup(r){const a=O(),n=m(()=>a.poolsStatsTotal),l=m(()=>a.poolsLoading),i=m(()=>a.txLoading),u=m(()=>a.priceLoading);return(y,B)=>(v(),A("div",no,[k(I,{showing:t(n).tvl===0&&(t(l)||t(i)||t(u)),class:"swap-loading",color:"grey"},null,8,["showing"]),g("div",ao,[g("span",lo,"TVL: $"+D(t(E)(t(n).tvl,2)),1),g("span",null,"Volume 24h: $"+D(t(E)(t(n).volume24,2)),1)])]))}}),ro={key:0,class:"full-width app-description row items-center justify-start q-mb-md"},io=g("span",{class:"q-mr-sm"},"My Liquidity",-1),uo={class:"row justify-center"},po={key:0,class:"text-h5"},mo=C({__name:"PoolsList",setup(r){const{connected:a}=W(),n=p(!1),l=F(),i=m(()=>l.tokenSwapsAllFiltered.filter(b=>!a.value||!n.value||l.userPoolsTokens[b.data.poolMint.toBase58()])),u=m(()=>l.userPoolsTokens),{state:y}=l,B=O(),M=m(()=>B.poolsLoading),T=m(()=>B.poolsStats);return(b,w)=>{const x=co,h=Q;return v(),A(P,null,[k(x,{class:"q-mb-sm"}),t(a)?(v(),A("div",ro,[io,k(z,{modelValue:t(n),"onUpdate:modelValue":w[0]||(w[0]=d=>Y(n)?n.value=d:null),color:"secondary",dense:"",class:"app-toggle"},null,8,["modelValue"])])):j("",!0),g("div",null,[k(I,{showing:t(y)?.loading||t(M),class:"swap-loading",color:"grey"},null,8,["showing"]),g("div",uo,[(v(!0),A(P,null,X(t(i),(d,s)=>(v(),Z(h,{key:d.pubkey.toBase58()??s,pubkey:d.pubkey,data:d.data,"user-tokens":t(u)[d.data.poolMint.toBase58()],"pool-stats":t(T)[d.pubkey.toBase58()],class:"q-mx-sm q-mb-md"},null,8,["pubkey","data","user-tokens","pool-stats"]))),128)),!t(y).loading&&!t(i).length?(v(),A("div",po," Pools not found ")):j("",!0)])])],64)}}}),_o={},fo={class:"main-block row justify-center"};function ko(r,a){const n=R,l=mo,i=G,u=K;return v(),A(P,null,[k(n,{class:"q-mt-lg"}),g("div",fo,[k(l)]),k(i,{class:"q-mt-lg"}),k(u,{class:"q-mt-lg"})],64)}const So=oo(_o,[["render",ko]]);export{So as default};
