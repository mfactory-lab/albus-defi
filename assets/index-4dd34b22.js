import{E as m,P as g,h as _}from"./index-106e9c1f.js";var x=globalThis&&globalThis.__extends||function(){var s=function(o,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},s(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(o,e);function t(){this.constructor=o}o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),T=function(s){x(o,s);function o(){return s!==null&&s.apply(this,arguments)||this}return o}(m),h=globalThis&&globalThis.__awaiter||function(s,o,e,t){function r(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function u(c){try{i(t.next(c))}catch(d){a(d)}}function l(c){try{i(t.throw(c))}catch(d){a(d)}}function i(c){c.done?n(c.value):r(c.value).then(u,l)}i((t=t.apply(s,o||[])).next())})};class A extends m{constructor(o,e){if(super(),this._network=e,this._publicKey=null,this._popup=null,this._handlerAdded=!1,this._nextRequestId=1,this._autoApprove=!1,this._responsePromises=new Map,this.handleMessage=t=>{var r;if(this._injectedProvider&&t.source===window||t.origin===((r=this._providerUrl)===null||r===void 0?void 0:r.origin)&&t.source===this._popup){if(t.data.method==="connected"){const n=new g(t.data.params.publicKey);(!this._publicKey||!this._publicKey.equals(n))&&(this._publicKey&&!this._publicKey.equals(n)&&this.handleDisconnect(),this._publicKey=n,this._autoApprove=!!t.data.params.autoApprove,this.emit("connect",this._publicKey))}else if(t.data.method==="disconnected")this.handleDisconnect();else if(t.data.result||t.data.error){const n=this._responsePromises.get(t.data.id);if(n){const[a,u]=n;t.data.result?a(t.data.result):u(new Error(t.data.error))}}}},this._beforeUnload=()=>{this.disconnect()},E(o))this._injectedProvider=o;else if(j(o))this._providerUrl=new URL(o),this._providerUrl.hash=new URLSearchParams({origin:window.location.origin,network:this._network}).toString();else throw new Error("provider parameter must be an injected provider or a URL string.")}handleConnect(){var o;return this._handlerAdded||(this._handlerAdded=!0,window.addEventListener("message",this.handleMessage),window.addEventListener("beforeunload",this._beforeUnload)),this._injectedProvider?new Promise(e=>{this.sendRequest("connect",{}),e()}):(window.name="parent",this._popup=window.open((o=this._providerUrl)===null||o===void 0?void 0:o.toString(),"_blank","location,resizable,width=460,height=675"),new Promise(e=>{this.once("connect",e)}))}handleDisconnect(){this._handlerAdded&&(this._handlerAdded=!1,window.removeEventListener("message",this.handleMessage),window.removeEventListener("beforeunload",this._beforeUnload)),this._publicKey&&(this._publicKey=null,this.emit("disconnect")),this._responsePromises.forEach(([,o],e)=>{this._responsePromises.delete(e),o(new Error("Wallet disconnected"))})}sendRequest(o,e){return h(this,void 0,void 0,function*(){if(o!=="connect"&&!this.connected)throw new Error("Wallet not connected");const t=this._nextRequestId;return++this._nextRequestId,new Promise((r,n)=>{var a,u,l,i;this._responsePromises.set(t,[r,n]),this._injectedProvider?this._injectedProvider.postMessage({jsonrpc:"2.0",id:t,method:o,params:Object.assign({network:this._network},e)}):((a=this._popup)===null||a===void 0||a.postMessage({jsonrpc:"2.0",id:t,method:o,params:e},(l=(u=this._providerUrl)===null||u===void 0?void 0:u.origin)!==null&&l!==void 0?l:""),this.autoApprove||(i=this._popup)===null||i===void 0||i.focus())})})}get publicKey(){return this._publicKey}get connected(){return this._publicKey!==null}get autoApprove(){return this._autoApprove}connect(){return h(this,void 0,void 0,function*(){this._popup&&this._popup.close(),yield this.handleConnect()})}disconnect(){return h(this,void 0,void 0,function*(){this._injectedProvider&&(yield this.sendRequest("disconnect",{})),this._popup&&this._popup.close(),this.handleDisconnect()})}sign(o,e){return h(this,void 0,void 0,function*(){if(!(o instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");const t=yield this.sendRequest("sign",{data:o,display:e}),r=_.decode(t.signature),n=new g(t.publicKey);return{signature:r,publicKey:n}})}signTransaction(o){return h(this,void 0,void 0,function*(){const e=yield this.sendRequest("signTransaction",{message:_.encode(o.serializeMessage())}),t=_.decode(e.signature),r=new g(e.publicKey);return o.addSignature(r,t),o})}signAllTransactions(o){return h(this,void 0,void 0,function*(){const e=yield this.sendRequest("signAllTransactions",{messages:o.map(n=>_.encode(n.serializeMessage()))}),t=e.signatures.map(n=>_.decode(n)),r=new g(e.publicKey);return o=o.map((n,a)=>(n.addSignature(r,t[a]),n)),o})}diffieHellman(o){return h(this,void 0,void 0,function*(){if(!(o instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");return yield this.sendRequest("diffieHellman",{publicKey:o})})}}function j(s){return typeof s=="string"}function E(s){return O(s)&&"postMessage"in s&&typeof s.postMessage=="function"}function O(s){return typeof s=="object"&&s!==null}var k=globalThis&&globalThis.__extends||function(){var s=function(o,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},s(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(o,e);function t(){this.constructor=o}o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),v=globalThis&&globalThis.__awaiter||function(s,o,e,t){function r(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function u(c){try{i(t.next(c))}catch(d){a(d)}}function l(c){try{i(t.throw(c))}catch(d){a(d)}}function i(c){c.done?n(c.value):r(c.value).then(u,l)}i((t=t.apply(s,o||[])).next())})},w=globalThis&&globalThis.__generator||function(s,o){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},t,r,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(i){return function(c){return l([i,c])}}function l(i){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,r&&(n=i[0]&2?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,r=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(i[0]===6&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=o.call(s,e)}catch(c){i=[6,c],r=0}finally{t=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},P=function(s){k(o,s);function o(e,t){var r=s.call(this)||this;return r._instance=null,r._handleConnect=function(){r.emit("connect")},r._handleDisconnect=function(){window.clearInterval(r._pollTimer),r.emit("disconnect")},r._provider=e,r._network=t,r}return Object.defineProperty(o.prototype,"publicKey",{get:function(){return this._instance.publicKey||null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"connected",{get:function(){return this._instance.connected||!1},enumerable:!1,configurable:!0}),o.prototype.connect=function(){return v(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this._instance=new A(this._provider,this._network),this._instance.on("connect",this._handleConnect),this._instance.on("disconnect",this._handleDisconnect),this._pollTimer=window.setInterval(function(){var r,n;((n=(r=e._instance)===null||r===void 0?void 0:r._popup)===null||n===void 0?void 0:n.closed)!==!1&&e._handleDisconnect()},200),[4,this._instance.connect()];case 1:return t.sent(),[2]}})})},o.prototype.disconnect=function(){return v(this,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return this._instance.removeAllListeners("connect"),this._instance.removeAllListeners("disconnect"),[4,this._instance.disconnect()];case 1:return e.sent(),[2]}})})},o.prototype.signTransaction=function(e){return v(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._instance.signTransaction(e)];case 1:return[2,t.sent()]}})})},o.prototype.signAllTransactions=function(e){return v(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._instance.signAllTransactions(e)];case 1:return[2,t.sent()]}})})},o.prototype.signMessage=function(e,t){return t===void 0&&(t="hex"),v(this,void 0,void 0,function(){var r;return w(this,function(n){switch(n.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._instance.sign(e,t)];case 1:return r=n.sent().signature,[2,Uint8Array.from(r)]}})})},o}(T),K=globalThis&&globalThis.__extends||function(){var s=function(o,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},s(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(o,e);function t(){this.constructor=o}o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),y=globalThis&&globalThis.__awaiter||function(s,o,e,t){function r(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function u(c){try{i(t.next(c))}catch(d){a(d)}}function l(c){try{i(t.throw(c))}catch(d){a(d)}}function i(c){c.done?n(c.value):r(c.value).then(u,l)}i((t=t.apply(s,o||[])).next())})},b=globalThis&&globalThis.__generator||function(s,o){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},t,r,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(i){return function(c){return l([i,c])}}function l(i){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,r&&(n=i[0]&2?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,r=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(i[0]===6&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=o.call(s,e)}catch(c){i=[6,c],r=0}finally{t=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},S=function(s){K(o,s);function o(e,t){var r=s.call(this)||this;return r._provider=e,r._network=t,r}return Object.defineProperty(o.prototype,"publicKey",{get:function(){return this._provider.publicKey},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"connected",{get:function(){return this._provider.isConnected},enumerable:!1,configurable:!0}),o.prototype.connect=function(){return y(this,void 0,void 0,function(){var e;return b(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),this.connected)throw new Error("Wallet already connected");return[4,this._provider.connect()];case 1:return t.sent(),this.emit("connect"),[3,3];case 2:throw e=t.sent(),this.emit("disconnect"),e;case 3:return[2]}})})},o.prototype.disconnect=function(){return y(this,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._provider.disconnect()];case 1:return e.sent(),this.emit("disconnect"),[2]}})})},o.prototype.signTransaction=function(e){return y(this,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._provider.signTransaction(e,this._network)];case 1:return[2,t.sent()]}})})},o.prototype.signAllTransactions=function(e){return y(this,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._provider.signAllTransactions(e,this._network)];case 1:return[2,t.sent()]}})})},o.prototype.signMessage=function(e){return y(this,void 0,void 0,function(){var t;return b(this,function(r){switch(r.label){case 0:if(!this.connected)throw new Error("Wallet not connected");if(!(e instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");return[4,this._provider.signMessage(e)];case 1:return t=r.sent().signature,[2,t]}})})},o}(T),I=globalThis&&globalThis.__extends||function(){var s=function(o,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},s(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(o,e);function t(){this.constructor=o}o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),f=globalThis&&globalThis.__awaiter||function(s,o,e,t){function r(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function u(c){try{i(t.next(c))}catch(d){a(d)}}function l(c){try{i(t.throw(c))}catch(d){a(d)}}function i(c){c.done?n(c.value):r(c.value).then(u,l)}i((t=t.apply(s,o||[])).next())})},p=globalThis&&globalThis.__generator||function(s,o){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},t,r,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(i){return function(c){return l([i,c])}}function l(i){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,r&&(n=i[0]&2?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,r=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(i[0]===6&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=o.call(s,e)}catch(c){i=[6,c],r=0}finally{t=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},U=function(s){I(o,s);function o(e){var t=s.call(this)||this;return t._network="mainnet-beta",t._adapterInstance=null,t._connectHandler=null,t._connected=function(){t._connectHandler&&(t._connectHandler.resolve(),t._connectHandler=null),t.emit("connect",t.publicKey)},t._disconnected=function(){t._connectHandler&&(t._connectHandler.reject(),t._connectHandler=null),t._adapterInstance=null,t.emit("disconnect")},e?.network&&(t._network=e?.network),e?.provider?t._provider=e?.provider:window.salmon?t._provider=window.salmon:t._provider="https://app.salmonwallet.io",t}return Object.defineProperty(o.prototype,"publicKey",{get:function(){var e;return((e=this._adapterInstance)===null||e===void 0?void 0:e.publicKey)||null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isConnected",{get:function(){var e;return!!(!((e=this._adapterInstance)===null||e===void 0)&&e.connected)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"connected",{get:function(){return this.isConnected},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"autoApprove",{get:function(){return!1},enumerable:!1,configurable:!0}),o.prototype.connect=function(){return f(this,void 0,void 0,function(){var e=this;return p(this,function(t){switch(t.label){case 0:return this.connected?[2]:(typeof this._provider=="string"?this._adapterInstance=new P(this._provider,this._network):this._adapterInstance=new S(this._provider,this._network),this._adapterInstance.on("connect",this._connected),this._adapterInstance.on("disconnect",this._disconnected),this._adapterInstance.connect(),[4,new Promise(function(r,n){e._connectHandler={resolve:r,reject:n}})]);case 1:return t.sent(),[2]}})})},o.prototype.disconnect=function(){return f(this,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return this._adapterInstance?[4,this._adapterInstance.disconnect()]:[2];case 1:return e.sent(),[2]}})})},o.prototype.signTransaction=function(e){return f(this,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._adapterInstance.signTransaction(e)];case 1:return[2,t.sent()]}})})},o.prototype.signAllTransactions=function(e){return f(this,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._adapterInstance.signAllTransactions(e)];case 1:return[2,t.sent()]}})})},o.prototype.signMessage=function(e,t){return t===void 0&&(t="utf8"),f(this,void 0,void 0,function(){return p(this,function(r){switch(r.label){case 0:if(!this.connected)throw new Error("Wallet not connected");return[4,this._adapterInstance.signMessage(e,t)];case 1:return[2,r.sent()]}})})},o.prototype.sign=function(e,t){return t===void 0&&(t="utf8"),f(this,void 0,void 0,function(){return p(this,function(r){switch(r.label){case 0:return[4,this.signMessage(e,t)];case 1:return[2,r.sent()]}})})},o}(m);export{U as default};
