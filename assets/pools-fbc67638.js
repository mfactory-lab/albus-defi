import{_ as R,a as G,b as K}from"./AppDescriptionTop-a6ddb582.js";import{_ as Q}from"./PoolsListItem.vue_vue_type_script_setup_true_lang-efe7af8a.js";import{aE as L,aF as $,s as U,G as d,u as H,t as J,v as B,aG as P,C as x,ax as _,aH as V,V as C,o as k,i as T,j as f,a3 as a,a9 as I,a2 as v,a5 as D,a6 as E,y as W,aI as Y,aJ as z,a4 as j,ad as q,aK as X,Y as Z,_ as ee}from"./index-ee4f1418.js";import{u as F}from"./swap-9623c50b.js";import"./associatedTokenAccount-3d1f84da.js";async function oe(){const{data:l}=await L.get(`${$}`);return l}async function te(){const{data:l}=await L.get(`${$}/transactions?type=swap`);return l}async function se(){const{data:l}=await L.get(`${$}/coin-price`);return l}const O=U("pools-stats",()=>{const l=d([]),r=d(!0),s=d([]),c=d(!0),i=d({}),p=d(!0),S=d({}),A=d({tvl:0,volume24:0,fees24:0}),M=H(),g=J(),b=F(),w=B(()=>b.tokenSwapsAllFiltered),N=P(async()=>{r.value=!0;try{l.value=await oe()}catch(t){console.error("get pools data: ",t)}finally{r.value=!1}},500);x(w,N,{immediate:!0});const h=P(async()=>{c.value=!0;try{s.value=await te()}catch(t){console.error("get tx data: ",t)}finally{c.value=!1}},500);x(()=>M.cluster,h,{immediate:!0}),setInterval(h,6e4);const u=P(async()=>{p.value=!0;try{i.value=await se()}catch(t){console.error("get tx data: ",t)}finally{p.value=!1}},500);return u(),setInterval(u,6e4),x([l,s,i],()=>{if(r.value||c.value||p.value)return;const t={tvl:0,volume24:0,fees24:0},o=w.value.reduce((e,m)=>(e[m.pubkey.toBase58()]={tokenAMint:m.data.tokenAMint.toBase58(),tokenBMint:m.data.tokenBMint.toBase58(),poolTokenSupply:0,amountTokenA:0,amountTokenB:0,tvl:0,volume24:0,fees24:0,apr24:0},e),{});l.value?.forEach(e=>{o[e.address]&&(o[e.address].amountTokenA=Number(e.tokenABalance),o[e.address].amountTokenB=Number(e.tokenBBalance),o[e.address].poolTokenSupply=Number(e.poolTokenSupply))}),s.value?.forEach(e=>{if(o[e.poolAddress]){const m=g.tokenByMint(o[e.poolAddress].tokenAMint),y=g.tokenByMint(o[e.poolAddress].tokenBMint);if(Number(e.amountTokenA)>0){const n=_(Number(e.amountTokenA),m?.decimals)*e.priceTokenA;o[e.poolAddress].volume24+=n,o[e.poolAddress].fees24+=_(Number(e.feeTokenB),y?.decimals)*e.priceTokenB,t.volume24+=n}if(Number(e.amountTokenB)>0){const n=_(Number(e.amountTokenB),y?.decimals)*e.priceTokenB;o[e.poolAddress].volume24+=_(Number(e.amountTokenB),y?.decimals)*e.priceTokenB,t.volume24+=n}if(Number(e.feeTokenA)>0){const n=_(Number(e.feeTokenA),m?.decimals)*e.priceTokenA;o[e.poolAddress].fees24+=n,t.fees24+=n}if(Number(e.feeTokenB)>0){const n=_(Number(e.feeTokenB),y?.decimals)*e.priceTokenB;o[e.poolAddress].fees24+=n,t.fees24+=n}}}),Object.keys(o).forEach(e=>{const m=g.tokenByMint(o[e].tokenAMint),y=g.tokenByMint(o[e].tokenBMint),n=_(o[e].amountTokenA,m?.decimals)*(i.value[V[o[e].tokenAMint]]??0)+_(o[e].amountTokenB,y?.decimals)*(i.value[V[o[e].tokenBMint]]??0);o[e].tvl=n,t.tvl+=n,o[e].apr24=o[e].fees24/o[e].tvl*365}),S.value=o,A.value=t,console.log("[pools stats]: ",o),console.log("[pools stats] total: ",t)}),{poolsLoading:r,txLoading:c,priceLoading:p,poolsStats:S,poolsStatsTotal:A}}),ae={class:"full-width q-pl-md"},ne={class:"row justify-start text-subtitle1 q-pl-xs"},le={class:"q-mr-md"},ce=C({__name:"PoolsTotal",setup(l){const r=O(),s=B(()=>r.poolsStatsTotal);return(c,i)=>(k(),T("div",ae,[f(I,{showing:a(s).tvl===0,class:"swap-loading",color:"grey"},null,8,["showing"]),v("div",ne,[v("span",le,"TVL: $"+D(a(E)(a(s).tvl,2)),1),v("span",null,"Volume 24h: $"+D(a(E)(a(s).volume24,2)),1)])]))}}),re={key:0,class:"full-width app-description row items-center justify-start q-mb-md"},ie=v("span",{class:"q-mr-sm"},"My Liquidity",-1),ue={class:"row justify-center"},de={key:0,class:"text-h5"},pe=C({__name:"PoolsList",setup(l){const{connected:r}=W(),s=d(!1),c=F(),i=B(()=>c.tokenSwapsAllFiltered.filter(b=>!r.value||!s.value||c.userPoolsTokens[b.data.poolMint.toBase58()])),p=B(()=>c.userPoolsTokens),{state:S}=c,A=O(),M=B(()=>A.poolsLoading),g=B(()=>A.poolsStats);return(b,w)=>{const N=ce,h=Q;return k(),T(q,null,[f(N,{class:"q-mb-sm"}),a(r)?(k(),T("div",re,[ie,f(z,{modelValue:a(s),"onUpdate:modelValue":w[0]||(w[0]=u=>Y(s)?s.value=u:null),color:"secondary",dense:"",class:"app-toggle"},null,8,["modelValue"])])):j("",!0),v("div",null,[f(I,{showing:a(S)?.loading||a(M),class:"swap-loading",color:"grey"},null,8,["showing"]),v("div",ue,[(k(!0),T(q,null,X(a(i),(u,t)=>(k(),Z(h,{key:u.pubkey.toBase58()??t,pubkey:u.pubkey,data:u.data,"user-tokens":a(p)[u.data.poolMint.toBase58()],"pool-stats":a(g)[u.pubkey.toBase58()],class:"q-mx-sm q-mb-md"},null,8,["pubkey","data","user-tokens","pool-stats"]))),128)),!a(S).loading&&!a(i).length?(k(),T("div",de," Pools not found ")):j("",!0)])])],64)}}}),me={},_e={class:"main-block row justify-center"};function fe(l,r){const s=R,c=pe,i=G,p=K;return k(),T(q,null,[f(s,{class:"q-mt-lg"}),v("div",_e,[f(c)]),f(i,{class:"q-mt-lg"}),f(p,{class:"q-mt-lg"})],64)}const Te=ee(me,[["render",fe]]);export{Te as default};
