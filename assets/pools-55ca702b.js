import{_ as D,a as V,b as C}from"./AppDescriptionTop-abeaaf17.js";import{_ as I}from"./PoolsListItem.vue_vue_type_script_setup_true_lang-1b9c4cc8.js";import{aE as P,aF as x,s as $,G as i,u as j,t as F,v as M,aG as S,C as b,ax as p,aH as L,V as O,y as R,o as _,i as k,a3 as m,j as f,aI as G,aJ as K,a4 as q,a2 as A,a9 as Q,ad as h,aK as U,Y as H,_ as J}from"./index-ee7b9083.js";import{u as E}from"./swap-f0d1b728.js";import"./associatedTokenAccount-d7fe909a.js";async function W(){const{data:t}=await P.get(`${x}`);return t}async function Y(){const{data:t}=await P.get(`${x}/transactions?type=swap`);return t}async function z(){const{data:t}=await P.get(`${x}/coin-price`);return t}const X=$("pools-stats",()=>{const t=i([]),r=i(!0),s=i([]),a=i(!0),n=i({}),l=i(!0),w=i({}),T=j(),u=F(),g=E(),y=M(()=>g.tokenSwapsAllFiltered),d=S(async()=>{r.value=!0;try{t.value=await W()}catch(o){console.error("get pools data: ",o)}finally{r.value=!1}},500);b(y,d,{immediate:!0});const v=S(async()=>{a.value=!0;try{s.value=await Y()}catch(o){console.error("get tx data: ",o)}finally{a.value=!1}},500);b(()=>T.cluster,v,{immediate:!0}),setInterval(v,6e4);const N=S(async()=>{l.value=!0;try{n.value=await z()}catch(o){console.error("get tx data: ",o)}finally{l.value=!1}},500);return N(),setInterval(N,6e4),b([t,s,n],()=>{if(r.value||a.value||l.value)return;const o=y.value.reduce((e,c)=>(e[c.pubkey.toBase58()]={tokenAMint:c.data.tokenAMint.toBase58(),tokenBMint:c.data.tokenBMint.toBase58(),amountTokenA:0,amountTokenB:0,tvl:0,volume24:0,fees24:0,apr24:0},e),{});t.value?.forEach(e=>{o[e.address]&&(o[e.address].amountTokenA=Number(e.tokenABalance),o[e.address].amountTokenB=Number(e.tokenBBalance))}),s.value?.forEach(e=>{if(o[e.poolAddress]){const c=u.tokenByMint(o[e.poolAddress].tokenAMint),B=u.tokenByMint(o[e.poolAddress].tokenBMint);Number(e.amountTokenA)>0&&(o[e.poolAddress].volume24+=p(Number(e.amountTokenA),c?.decimals)*e.priceTokenA,o[e.poolAddress].fees24+=p(Number(e.feeTokenB),B?.decimals)*e.priceTokenB),Number(e.amountTokenB)>0&&(o[e.poolAddress].volume24+=p(Number(e.amountTokenB),B?.decimals)*e.priceTokenB,o[e.poolAddress].fees24+=p(Number(e.feeTokenA),c?.decimals)*e.priceTokenA)}}),Object.keys(o).forEach(e=>{const c=u.tokenByMint(o[e].tokenAMint),B=u.tokenByMint(o[e].tokenBMint);o[e].tvl=p(o[e].amountTokenA,c?.decimals)*(n.value[L[o[e].tokenAMint]]??0)+p(o[e].amountTokenB,B?.decimals)*(n.value[L[o[e].tokenBMint]]??0),o[e].apr24=o[e].fees24/o[e].tvl*365}),console.log("[pools stats]: ",o)}),{poolsLoading:r,txLoading:a,priceLoading:l,poolsStats:w}}),Z={key:0,class:"full-width app-description row items-center justify-start q-mb-md"},ee=A("span",{class:"q-mr-sm"},"My Liquidity",-1),oe={class:"row justify-center"},te={key:0,class:"text-h5"},se=O({__name:"PoolsList",setup(t){const{connected:r}=R(),s=i(!1),a=E(),n=M(()=>a.tokenSwapsAllFiltered.filter(u=>!r.value||!s.value||a.userPoolsTokens[u.data.poolMint.toBase58()])),{state:l}=a,w=X(),T=M(()=>w.poolsLoading);return(u,g)=>{const y=I;return _(),k(h,null,[m(r)?(_(),k("div",Z,[ee,f(K,{modelValue:m(s),"onUpdate:modelValue":g[0]||(g[0]=d=>G(s)?s.value=d:null),color:"secondary",dense:"",class:"app-toggle"},null,8,["modelValue"])])):q("",!0),A("div",null,[f(Q,{showing:m(l)?.loading||m(T),class:"swap-loading",color:"grey"},null,8,["showing"]),A("div",oe,[(_(!0),k(h,null,U(m(n),(d,v)=>(_(),H(y,{key:d.pubkey?.toBase58()??v,pubkey:d.pubkey,data:d.data,class:"q-mx-sm q-mb-md"},null,8,["pubkey","data"]))),128)),!m(l).loading&&!m(n).length?(_(),k("div",te," Pools not found ")):q("",!0)])])],64)}}}),ae={},ne={class:"main-block row justify-center"};function le(t,r){const s=D,a=se,n=V,l=C;return _(),k(h,null,[f(s,{class:"q-mt-lg"}),A("div",ne,[f(a)]),f(n,{class:"q-mt-lg"}),f(l,{class:"q-mt-lg"})],64)}const me=J(ae,[["render",le]]);export{me as default};
