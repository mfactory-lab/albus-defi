import{_ as ao,a as no,b as to}from"./AppDescriptionTop-2b354f0a.js";import{_ as lo}from"./PolicyCard.vue_vue_type_script_setup_true_lang-2427abe9.js";import{_ as so}from"./SelectPool.vue_vue_type_script_setup_true_lang-0d4284e4.js";import{_ as io}from"./SelectToken.vue_vue_type_script_setup_true_lang-92b75541.js";import{s as uo,u as co,w as Z,x as mo,y as ro,z as po,v as _,B as ko,C as G,ax as D,a6 as w,aF as k,I as H,V as fo,W as _o,H as go,o as C,i as N,j as i,Z as f,$ as z,a3 as o,ay as vo,ad as J,a1 as E,a0 as U,a2 as n,a5 as c,a4 as F,a7 as O,a8 as W,aA as To,aB as Bo,a9 as Ao,aC as wo,aD as yo,_ as bo}from"./index-d446608a.js";import{o as X}from"./common-21d1f462.js";import{u as Y}from"./swap-1028da8c.js";import"./PoolsListItem.vue_vue_type_script_setup_true_lang-b976895c.js";import"./associatedTokenAccount-a17f8b5b.js";const ho=uo("liquidity",()=>{const R=co(),S=Z(),a=mo(),{publicKey:V}=ro(),{notify:g}=po(),v=Y(),l=_(()=>v.tokenSwap),t=_(()=>v.state),s=_(()=>v.swapClient),e=ko({slippageDialog:!1,swapping:!1,active:!1,slippage:.01,rate:0,poolAmount:0,amountTokenA:0,amountTokenB:0,maxAmountTokenA:0,maxAmountTokenB:0}),$=async(T=!1)=>{console.log("calcRate ====== ");const B=Number((T?e.amountTokenB:e.amountTokenA)??0);console.log("calcRate changedToken ====== ",B);const M=Number(D(Number(t.value.poolBalance[t.value.from.mint]??0),t.value.from.decimals)),q=Number(D(Number(t.value.poolBalance[t.value.to.mint]??0),t.value.to.decimals)),y=T?M/q:q/M;if(B===0||Number.isNaN(B)){console.log("calcRate clear ====== "),e.poolAmount=0,T?(e.amountTokenA=0,e.maxAmountTokenA=0):(e.amountTokenB=0,e.maxAmountTokenB=0);return}console.log("calcRate rate ====== ",y),T?e.amountTokenA=Number(w(y*e.amountTokenB,t.value.to.decimals)):e.amountTokenB=Number(w(y*e.amountTokenA,t.value.from.decimals)),e.maxAmountTokenA=e.amountTokenA*(1+e.slippage),e.maxAmountTokenB=e.amountTokenB*(1+e.slippage);const m=e.amountTokenA,p=t.value.from;e.poolAmount=Math.floor(k(m,p.decimals)/t.value.poolBalance[p.mint]*t.value.poolTokenSupply)};G([()=>t.value.poolBalance,()=>e.slippage],()=>$(),{immediate:!0});function I(){v.loadPoolTokenAccounts(),e.maxAmountTokenA=0,e.maxAmountTokenB=0,e.amountTokenA=0,e.amountTokenB=0}async function j(){if(!l.value||!V.value){console.log("TokenSwap is not initialized...");return}a.value.publicKey||g({type:"info",message:"Please connect your wallet first"});const B=Number(k(e.amountTokenA??0,t.value.from.decimals)),M=Number(k(S.tokenBalance(t.value.from.mint)??0,t.value.from.decimals));if(B>M){g({type:"negative",message:`Insufficient balance ${t.value.from.symbol}.`});return}const q=Number(k(e.amountTokenA??0,t.value.to.decimals)),y=Number(k(S.tokenBalance(t.value.to.mint)??0,t.value.to.decimals));if(q>y){g({type:"negative",message:`Insufficient balance ${t.value.to.symbol}.`});return}try{e.swapping=!0;let m=e.amountTokenA,p=e.amountTokenB,A=t.value.from,b=t.value.to;l.value.data.tokenBMint.toBase58()===t.value.from.mint&&(m=e.amountTokenB,p=e.amountTokenA,A=t.value.to,b=t.value.from);const h=await H(l.value.data.tokenAMint,a.value.publicKey),x=await H(l.value.data.tokenBMint,a.value.publicKey),d=await H(l.value.data.poolMint,a.value.publicKey);console.log("slippage = ",e.slippage);const u=s.value.swapAuthority(l.value.pubkey);console.log("destination = ",d.toBase58()),console.log("userTokenA = ",h.toBase58()),console.log("userTokenB = ",x.toBase58()),console.log("swapAuthority = ",u.toBase58()),console.log("tokenSwap = ",l.value.pubkey.toBase58()),console.log("poolMint = ",l.value.data.poolMint.toBase58()),console.log("swapTokenA Mint = ",l.value.data.tokenAMint.toBase58()),console.log("swapTokenA = ",l.value.data.tokenA.toBase58()),console.log("swapTokenB Mint = ",l.value.data.tokenBMint.toBase58()),console.log("swapTokenB = ",l.value.data.tokenB.toBase58()),console.log("TokenA = ",A.symbol),console.log("maximumTokenA = ",m),console.log("maximumTokenA = ",k(m,A.decimals)),console.log("TokenB = ",b.symbol),console.log("maximumTokenB = ",p),console.log("maximumTokenB = ",k(p,b.decimals)),console.log("poolTokenAmount = ",e.poolAmount),console.log({tokenSwap:l.value.pubkey.toBase58(),poolMint:l.value.data.poolMint.toBase58(),destination:d.toBase58(),userTokenA:h.toBase58(),userTokenB:x.toBase58(),swapTokenA:l.value.data.tokenA.toBase58(),swapTokenB:l.value.data.tokenB.toBase58(),poolTokenAmount:e.poolAmount,maximumTokenA:Math.floor(k(m,A.decimals)*(1+e.slippage)),maximumTokenB:Math.floor(k(p,b.decimals)*(1+e.slippage))});const Q=await s.value.depositAllTokenTypes({tokenSwap:l.value.pubkey,poolMint:l.value.data.poolMint,destination:d,userTokenA:h,userTokenB:x,swapTokenA:l.value.data.tokenA,swapTokenB:l.value.data.tokenB,poolTokenAmount:e.poolAmount,maximumTokenA:Math.floor(k(m,A.decimals)*(1+e.slippage)),maximumTokenB:Math.floor(k(p,b.decimals)*(1+e.slippage)),tokenAMint:l.value.data.tokenAMint,tokenBMint:l.value.data.tokenBMint},{commitment:"confirmed"});g({message:"Transaction confirmed",type:"positive",actions:[{label:"Explore",color:"white",target:"_blank",href:`https://explorer.solana.com/tx/${Q}?cluster=${R.cluster}`,onClick:()=>!1}]}),I()}catch(m){console.log(m)}finally{e.swapping=!1}}function K(){e.slippageDialog=!0}function L(){e.slippageDialog=!1}return{state:e,calcRate:$,closeSlippage:L,openSlippage:K,depositBothTokens:j}}),xo={class:"swap-form"},So={class:"swap-field"},Mo={class:"swap-field__info"},qo={class:"row items-end justify-end"},Co={class:"col-8 col-xs-10 row justify-end swap-field__balance"},No={key:0,class:"insufficient-error"},Vo={class:"swap-field q-pt-xs"},$o={class:"swap-field__info q-mt-sm"},Po={class:"row items-end justify-end"},Uo={class:"col-8 col-xs-10 row justify-end swap-field__balance"},Do={key:0,class:"insufficient-error"},Io={class:"swap-info q-mt-md q-pt-xs"},Ko=n("dt",null,"Pool tokens amount",-1),Qo=n("dt",null,"Slippage Tolerance",-1),Ro={class:"swap-submit q-mt-md"},jo={key:0,class:"text-weight-medium fs-13 text-center q-mt-md text-negative"},Lo={key:1,class:"row q-mt-md text-center relative-position full-width"},Ho={class:"absolute-right swap-rate__refresh"},Eo={class:"swap-info q-mt-md"},Wo=fo({__name:"DepositBothCard",setup(R){const S=Y(),{state:a,loadingPoolTokens:V,setMax:g,loadPoolTokenAccounts:v}=S,l=_(()=>S.tokenSwap),t=ho(),{state:s,depositBothTokens:e,calcRate:$,openSlippage:I,closeSlippage:j}=t,{handleSearchToken:K,handleFilterToken:L,tokens:T}=_o();L(go);const B=Z(),M=_(()=>a.poolBalance[a.from.mint]?D(a.poolBalance[a.from.mint],a.from.decimals):0),q=_(()=>a.poolBalance[a.to.mint]?D(a.poolBalance[a.to.mint],a.to.decimals):0),y=d=>yo.format(d),m=_(()=>B.tokenBalance(a.from.mint)),p=_(()=>B.tokenBalance(a.to.mint));function A(d,u){a[u?"to":"from"]=d}function b(){g(m.value)}const h=_(()=>Number(s.amountTokenA)>m.value?"Insufficient funds":!1),x=_(()=>Number(s.amountTokenB)>p.value?"Insufficient funds":!1);return G([()=>s.amountTokenA,m,()=>s.amountTokenB,p],d=>{s.active=!h.value&&!x.value}),(d,u)=>{const Q=io,oo=so,eo=lo;return C(),N(J,null,[i(z,{class:"swap-card swap-widget"},{default:f(()=>[i(E,{class:"swap-card__header"},{default:f(()=>[U(" Liquidity ")]),_:1}),i(E,{class:"swap-card__body"},{default:f(()=>[n("div",xo,[n("div",So,[n("div",Mo,[n("div",qo,[n("div",Co,[o(h)?(C(),N("div",No,c(o(h)),1)):F("",!0),U(" Balance: "+c(o(w)(o(m)))+" "+c(o(a).from.symbol),1)])])]),i(O,{modelValue:o(s).amountTokenA,"onUpdate:modelValue":[u[0]||(u[0]=r=>o(s).amountTokenA=r),u[1]||(u[1]=r=>{const P=String(r);P[P.length-1]!=="."&&o($)()})],maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input",onKeypress:o(X)},{append:f(()=>[i(W,{dense:"",unelevated:"",ripple:!1,class:"swap-input__max",onClick:b},{default:f(()=>[U(" MAX ")]),_:1}),i(Q,{options:o(T),token:o(a).from,"swap-token":String(o(a).to.symbol),onHandleSearchToken:o(K),onSetToken:A},null,8,["options","token","swap-token","onHandleSearchToken"])]),_:1},8,["modelValue","onKeypress"])]),n("div",Vo,[n("div",$o,[n("div",Po,[n("div",Uo,[o(x)?(C(),N("div",Do,c(o(x)),1)):F("",!0),U(" Balance: "+c(o(w)(o(p)))+" "+c(o(a).to.symbol),1)])])]),i(O,{modelValue:o(s).amountTokenB,"onUpdate:modelValue":[u[2]||(u[2]=r=>o(s).amountTokenB=r),u[3]||(u[3]=r=>{const P=String(r);P[P.length-1]!=="."&&o($)(!0)})],maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input",onKeypress:o(X)},{append:f(()=>[i(Q,{"swap-token":String(o(a).from.symbol),options:o(T),direction:!0,token:o(a).to,"destination-unavailable":!o(l),onHandleSearchToken:o(K),onSetToken:A},null,8,["swap-token","options","token","destination-unavailable","onHandleSearchToken"])]),_:1},8,["modelValue","onKeypress"])])]),n("div",Io,[n("dl",null,[n("dt",null,"Max "+c(o(a).from.symbol.toUpperCase())+" amount",1),n("dd",null,c(o(w)(o(s).maxAmountTokenA,o(a).from.decimals))+" "+c(o(a).from.symbol.toUpperCase()),1)]),n("dl",null,[n("dt",null,"Max "+c(o(a).to.symbol.toUpperCase())+" amount",1),n("dd",null,c(o(w)(o(s).maxAmountTokenB,o(a).to.decimals))+" "+c(o(a).to.symbol.toUpperCase()),1)]),n("dl",null,[Ko,n("dd",null,c(o(D)(o(s).poolAmount,9)),1)]),n("dl",null,[Qo,n("dd",null,[n("a",{href:"#",onClick:u[4]||(u[4]=(...r)=>o(I)&&o(I)(...r))},c(y(o(s).slippage)),1)])])]),i(oo,{class:"q-mt-md"}),i(eo,{class:"q-mt-md q-mx-auto"}),n("div",Ro,[i(W,{loading:o(s).swapping,disable:!o(s).active||!o(l)||!o(s).amountTokenA,rounded:"",ripple:!1,onClick:o(e)},{default:f(()=>[U(" Add Liquidity ")]),_:1},8,["loading","disable","onClick"])]),o(l)?(C(),N("div",Lo,[n("div",Ho,[i(W,{loading:o(V),class:"swap-card__reload",unelevated:"",color:d.$q.dark.isActive?"white":"primary",round:"",onClick:o(v)},{default:f(()=>[i(To,{name:o(Bo),color:d.$q.dark.isActive?"primary":"white"},null,8,["name","color"])]),_:1},8,["loading","color","onClick"])])])):(C(),N("div",jo," Pool not found ")),n("div",Eo,[n("dl",null,[n("dt",null,"Pool "+c(o(a).from.symbol)+" balance",1),n("dd",null,c(o(w)(o(M))),1)]),n("dl",null,[n("dt",null,"Pool "+c(o(a).to.symbol)+" balance",1),n("dd",null,c(o(w)(o(q))),1)])])]),_:1}),i(Ao,{showing:o(a)?.loading,class:"swap-loading",color:"grey"},null,8,["showing"])]),_:1}),i(vo,{modelValue:o(s).slippageDialog,"onUpdate:modelValue":u[6]||(u[6]=r=>o(s).slippageDialog=r),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:f(()=>[i(z,null,{default:f(()=>[i(E,null,{default:f(()=>[i(wo,{modelValue:o(s).slippage,"onUpdate:modelValue":[u[5]||(u[5]=r=>o(s).slippage=r),o(j)],spread:"","no-caps":"",unelevated:"",ripple:!1,"toggle-color":"secondary",color:"white","text-color":"dark",options:[{label:"0.1%",value:.001},{label:"0.5%",value:.005},{label:"1%",value:.01},{label:"5%",value:.05}]},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),zo={},Fo={class:"main-block row justify-center"};function Oo(R,S){const a=ao,V=Wo,g=no,v=to;return C(),N(J,null,[i(a,{class:"q-mt-lg"}),n("div",Fo,[i(V)]),i(g,{class:"q-mt-lg"}),i(v,{class:"q-mt-lg"})],64)}const te=bo(zo,[["render",Oo]]);export{te as default};
