import{P as me,M as xr,h as Ar,i as Tr}from"./index-cc4482a6.js";var C=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{};function Ae(){throw new Error("setTimeout has not been defined")}function Te(){throw new Error("clearTimeout has not been defined")}var D=Ae,N=Te;typeof C.setTimeout=="function"&&(D=setTimeout);typeof C.clearTimeout=="function"&&(N=clearTimeout);function _e(t){if(D===setTimeout)return setTimeout(t,0);if((D===Ae||!D)&&setTimeout)return D=setTimeout,setTimeout(t,0);try{return D(t,0)}catch{try{return D.call(null,t,0)}catch{return D.call(this,t,0)}}}function _r(t){if(N===clearTimeout)return clearTimeout(t);if((N===Te||!N)&&clearTimeout)return N=clearTimeout,clearTimeout(t);try{return N(t)}catch{try{return N.call(null,t)}catch{return N.call(this,t)}}}var b=[],O=!1,M,V=-1;function Ir(){!O||!M||(O=!1,M.length?b=M.concat(b):V=-1,b.length&&Ie())}function Ie(){if(!O){var t=_e(Ir);O=!0;for(var e=b.length;e;){for(M=b,b=[];++V<e;)M&&M[V].run();V=-1,e=b.length}M=null,O=!1,_r(t)}}function Sr(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];b.push(new Se(t,e)),b.length===1&&!O&&_e(Ie)}function Se(t,e){this.fun=t,this.array=e}Se.prototype.run=function(){this.fun.apply(null,this.array)};var Rr="browser",Fr="browser",Br=!0,br={},Pr=[],Cr="",Ur={},Dr={},Nr={};function L(){}var Mr=L,kr=L,Lr=L,Yr=L,$r=L,Or=L,qr=L;function zr(t){throw new Error("process.binding is not supported")}function Kr(){return"/"}function Wr(t){throw new Error("process.chdir is not supported")}function Hr(){return 0}var Y=C.performance||{},jr=Y.now||Y.mozNow||Y.msNow||Y.oNow||Y.webkitNow||function(){return new Date().getTime()};function Gr(t){var e=jr.call(Y)*.001,r=Math.floor(e),n=Math.floor(e%1*1e9);return t&&(r=r-t[0],n=n-t[1],n<0&&(r--,n+=1e9)),[r,n]}var Vr=new Date;function Jr(){var t=new Date,e=t-Vr;return e/1e3}var J={nextTick:Sr,title:Rr,browser:Br,env:br,argv:Pr,version:Cr,versions:Ur,on:Mr,addListener:kr,once:Lr,off:Yr,removeListener:$r,removeAllListeners:Or,emit:qr,binding:zr,cwd:Kr,chdir:Wr,umask:Hr,hrtime:Gr,platform:Fr,release:Dr,config:Nr,uptime:Jr},Qr=function(t,e,r,n,i,o,s,c){if(J.env.NODE_ENV!=="production"&&e===void 0)throw new Error("invariant requires an error message argument");if(!t){var a;if(e===void 0)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[r,n,i,o,s,c],h=0;a=new Error(e.replace(/%s/g,function(){return f[h++]})),a.name="Invariant Violation"}throw a.framesToPop=1,a}},q=Qr;const Xr={56:"https://bsc-dataseed1.binance.org",97:"https://data-seed-prebsc-1-s1.binance.org:8545",137:"https://rpc-mainnet.maticvigil.com/",80001:"https://rpc-mumbai.matic.today/",43114:"https://api.avax.network/ext/bc/C/rpc",43113:"https://api.avax-test.network/ext/bc/C/rpc"},Zr={1:"ethereum",4:"ethereum",56:"bsc",97:"bsc",137:"polygon",80001:"polygon",43114:"avalanche",43113:"avalanche"},et={1:"mainnet",4:"rinkeby",56:"mainnet",97:"testnet",137:"mainnet",80001:"testnet",43114:"mainnet",43113:"testnet"},rt={1:"https://wallet.blocto.app",4:"https://wallet-testnet.blocto.app",56:"https://wallet.blocto.app",97:"https://wallet-testnet.blocto.app",137:"https://wallet.blocto.app",80001:"https://wallet-testnet.blocto.app",43114:"https://wallet.blocto.app",43113:"https://wallet-testnet.blocto.app"},tt={devnet:"https://wallet-testnet.blocto.app",testnet:"https://wallet-testnet.blocto.app","mainnet-beta":"https://wallet.blocto.app"},nt=["devnet","testnet","mainnet-beta"],ge=["connect","disconnect","message","chainChanged","accountsChanged"],Re=86400*1e3,it="sdk.session";class Fe{constructor(){this.isBlocto=!0,this.isConnecting=!1,this.connected=!1,this.eventListeners={},this.code=null,this.sessionKey=it,this.off=removeEventListener,ge.forEach(e=>{this.eventListeners[e]=[]})}async request(e){}on(e,r){ge.includes(e)&&this.eventListeners[e].push(r)}once(){}removeListener(e,r){const i=this.eventListeners[e].findIndex(o=>o===r);i!==-1&&this.eventListeners[e].splice(i,1)}}const ot="width:100vw;height:100%;position:fixed;top:0;left:0;z-index:20000;border:none;";function z(t){const e=document.createElement("iframe");return e.setAttribute("src",t),e.setAttribute("style",ot),e}function K(t){document.body.appendChild(t)}function R(t){const e=t&&t.parentNode;e&&e.removeChild instanceof Function&&e.removeChild(t)}var $=(t,e,r=window)=>{function n(i){e(i,()=>r.removeEventListener(t,n))}r.addEventListener(t,n)};class st{constructor(){this.storage={}}getItem(e){return this[e]||null}setItem(e,r){this.storage[e]=r}removeItem(e){delete this.storage[e]}}const Be=typeof window<"u"?window.memoryStorage:new st;typeof window<"u"&&(window.memoryStorage=Be);const at=()=>{if(typeof window>"u")return!1;try{window.localStorage.setItem("local_storage_supported","1");const t=window.localStorage.getItem("local_storage_supported");return window.localStorage.removeItem("local_storage_supported"),t==="1"}catch{return!1}},se=at()?window.localStorage:Be,ct=(t,e=null)=>{const r=se.getItem(t);try{return JSON.parse(r)||e}catch{return r||e}},be=(t,e=null)=>{const r=ct(t,null);return r?new Date().getTime()>r.expiry?(Ue(t),e):r.value:e},Pe=(t,e)=>se.setItem(t,typeof e=="string"?e:JSON.stringify(e)),Ce=(t,e,r)=>Pe(t,{value:e,expiry:new Date().getTime()+r}),Ue=t=>{Pe(t,""),se.removeItem(t)};async function Q(t,e){if(t.status===403)throw e.code=null,Ue(e.sessionKey),new Error("[Blocto SDK]: Session expired!");return t.json()}class ut extends Fe{constructor({chainId:e="0x1",rpc:r,server:n,appId:i}){super(),this.accounts=[],q(e,"'chainId' is required"),typeof e=="number"?this.chainId=e:e.includes("0x")?this.chainId=parseInt(e,16):this.chainId=parseInt(e,10),this.networkId=this.chainId,this.chain=Zr[this.chainId],this.net=et[this.chainId],q(this.chain,`unsupported 'chainId': ${this.chainId}`),this.rpc=r||Xr[this.chainId]||{}.RPC||"",q(this.rpc,"'rpc' is required for Ethereum"),this.server=n||rt[this.chainId]||"https://wallet.blocto.app",this.appId=i||{}.APP_ID}tryRetrieveSessionFromStorage(){const e=be(this.sessionKey,{}),r=e&&e.code,n=e&&e.address&&e.address[this.chain];this.connected=!!(r&&n),this.code=r||null,this.accounts=n?[n]:[]}checkNetworkMatched(){const e=window.ethereum;if(e&&e.isBlocto&&parseInt(e.chainId,16)!==this.chainId)throw new Error("Blocto SDK network mismatched")}async send(e,r){switch(!0){case r instanceof Function:return this.sendAsync(e,r);case(typeof e=="string"&&Array.isArray(r)):return this.sendAsync({method:e,params:r});default:return this.sendAsync(e)}}async sendAsync(e,r){const n=new Promise(i=>{if(Array.isArray(e)){const o=e.filter(h=>h.method==="eth_sendTransaction").map(h=>h.params[0]),s=Math.floor(Math.random()*1e4),c={method:"blocto_sendBatchTransaction",params:o},a=this.request(c),f=e.map(({method:h,params:l},m)=>h==="eth_sendTransaction"?a:this.request({id:s+m+1,jsonrpc:"2.0",method:h,params:l}));Promise.allSettled(f).then(h=>i(h.map((l,m)=>({id:s+m+1,jsonrpc:"2.0",result:l.status==="fulfilled"?l.value:void 0,error:l.status!=="fulfilled"?l.reason:void 0}))))}else this.request(e).then(i)});if(r)n.then(i=>r(null,i)).catch(i=>r(i));else return n}async request(e){const r=window.ethereum;if(r&&r.isBlocto)return r.request(e);this.connected||await this.enable();try{let n=null,i=null;switch(e.method){case"eth_requestAccounts":this.accounts=await this.fetchAccounts();case"eth_accounts":i=this.accounts.length?this.accounts:await this.fetchAccounts();break;case"eth_coinbase":{i=this.accounts[0];break}case"eth_chainId":{i=this.chainId,i=`0x${i.toString(16)}`;break}case"net_version":{i=this.networkId||this.chainId,i=`0x${i.toString(16)}`;break}case"eth_signTypedData_v3":case"eth_signTypedData":case"eth_signTypedData_v4":case"personal_sign":case"eth_sign":{i=await this.handleSign(e);break}case"blocto_sendBatchTransaction":case"eth_sendTransaction":i=await this.handleSendTransaction(e);break;case"eth_signTransaction":case"eth_sendRawTransaction":i=null;break;default:n=await this.handleReadRequests(e)}if(n&&!n.result&&n.error){const o=n.error.message?n.error.message:"Request failed";throw new Error(o)}return n?n.result:i}catch(n){throw console.error(n),n}}async enable(){const e=window.ethereum;if(e&&e.isBlocto){if(parseInt(e.chainId,16)!==this.chainId)try{await e.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${this.chainId.toString(16)}`}]}),this.accounts=[e.address]}catch(r){console.error(r)}return new Promise((r,n)=>setTimeout(()=>e.enable().then(r).catch(n),10))}return this.tryRetrieveSessionFromStorage(),new Promise((r,n)=>{if(typeof window>"u"&&n("Currently only supported in browser"),this.connected)return r(this.accounts);const i=encodeURIComponent(window.location.origin),o=z(`${this.server}/authn?l6n=${i}&chain=${this.chain}`);K(o),$("message",(s,c)=>{const a=s;if(a.origin===this.server){if(a.data.type==="FCL::CHALLENGE::RESPONSE"){c(),R(o),this.code=a.data.code,this.connected=!0,this.eventListeners.connect.forEach(h=>h(this.chainId));const f=a.data.address;this.accounts=f?[f[this.chain]]:[],Ce(this.sessionKey,{code:this.code,address:f},Re),r(this.accounts)}a.data.type==="FCL::CHALLENGE::CANCEL"&&(c(),R(o),n(new Error("User declined the login request")))}})})}async fetchAccounts(){this.checkNetworkMatched();const{accounts:e}=await fetch(`${this.server}/api/${this.chain}/accounts?code=${this.code}`).then(r=>Q(r,this));return this.accounts=e,e}async handleReadRequests(e){return this.checkNetworkMatched(),fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:1,jsonrpc:"2.0",...e})}).then(r=>r.json())}async handleSign({method:e,params:r}){const n=`${this.server}/user-signature/${this.chain}`,i=z(n);K(i);let o="";return Array.isArray(r)&&(e==="eth_sign"?o=r[1].slice(2):e==="personal_sign"?o=r[0].slice(2):["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4"].includes(e)&&(o=r[1])),$("message",(s,c)=>{const a=s;a.origin===this.server&&a.data.type==="ETH:FRAME:READY"&&(i.contentWindow&&i.contentWindow.postMessage({type:"ETH:FRAME:READY:RESPONSE",method:e,message:o,chain:this.chain},n),c())}),new Promise((s,c)=>$("message",(a,f)=>{const h=a;h.origin===this.server&&h.data.type==="ETH:FRAME:RESPONSE"&&(h.data.status==="APPROVED"&&(f(),R(i),s(h.data.signature)),h.data.status==="DECLINED"&&(f(),R(i),c(new Error("User declined the signing request"))))}))}async handleSendTransaction(e){this.checkNetworkMatched();const{authorizationId:r}=await fetch(`${this.server}/api/${this.chain}/authz?code=${this.code}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.params)}).then(i=>Q(i,this));if(typeof window>"u")throw new Error("Currently only supported in browser");const n=z(`${this.server}/authz/${this.chain}/${r}`);return K(n),new Promise((i,o)=>$("message",(s,c)=>{const a=s;a.origin===this.server&&a.data.type==="ETH:FRAME:RESPONSE"&&(a.data.status==="APPROVED"&&(c(),R(n),i(a.data.txHash)),a.data.status==="DECLINED"&&(c(),R(n),o(new Error("User declined to send the transaction"))))}))}}var F=[],v=[],ht=typeof Uint8Array<"u"?Uint8Array:Array,ae=!1;function De(){ae=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,r=t.length;e<r;++e)F[e]=t[e],v[t.charCodeAt(e)]=e;v["-".charCodeAt(0)]=62,v["_".charCodeAt(0)]=63}function ft(t){ae||De();var e,r,n,i,o,s,c=t.length;if(c%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=t[c-2]==="="?2:t[c-1]==="="?1:0,s=new ht(c*3/4-o),n=o>0?c-4:c;var a=0;for(e=0,r=0;e<n;e+=4,r+=3)i=v[t.charCodeAt(e)]<<18|v[t.charCodeAt(e+1)]<<12|v[t.charCodeAt(e+2)]<<6|v[t.charCodeAt(e+3)],s[a++]=i>>16&255,s[a++]=i>>8&255,s[a++]=i&255;return o===2?(i=v[t.charCodeAt(e)]<<2|v[t.charCodeAt(e+1)]>>4,s[a++]=i&255):o===1&&(i=v[t.charCodeAt(e)]<<10|v[t.charCodeAt(e+1)]<<4|v[t.charCodeAt(e+2)]>>2,s[a++]=i>>8&255,s[a++]=i&255),s}function lt(t){return F[t>>18&63]+F[t>>12&63]+F[t>>6&63]+F[t&63]}function pt(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(lt(n));return i.join("")}function Ee(t){ae||De();for(var e,r=t.length,n=r%3,i="",o=[],s=16383,c=0,a=r-n;c<a;c+=s)o.push(pt(t,c,c+s>a?a:c+s));return n===1?(e=t[r-1],i+=F[e>>2],i+=F[e<<4&63],i+="=="):n===2&&(e=(t[r-2]<<8)+t[r-1],i+=F[e>>10],i+=F[e>>4&63],i+=F[e<<2&63],i+="="),o.push(i),o.join("")}function re(t,e,r,n,i){var o,s,c=i*8-n-1,a=(1<<c)-1,f=a>>1,h=-7,l=r?i-1:0,m=r?-1:1,p=t[e+l];for(l+=m,o=p&(1<<-h)-1,p>>=-h,h+=c;h>0;o=o*256+t[e+l],l+=m,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;h>0;s=s*256+t[e+l],l+=m,h-=8);if(o===0)o=1-f;else{if(o===a)return s?NaN:(p?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-f}return(p?-1:1)*s*Math.pow(2,o-n)}function Ne(t,e,r,n,i,o){var s,c,a,f=o*8-i-1,h=(1<<f)-1,l=h>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-s))<1&&(s--,a*=2),s+l>=1?e+=m/a:e+=m*Math.pow(2,1-l),e*a>=2&&(s++,a/=2),s+l>=h?(c=0,s=h):s+l>=1?(c=(e*a-1)*Math.pow(2,i),s=s+l):(c=e*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;t[r+p]=c&255,p+=d,c/=256,i-=8);for(s=s<<i|c,f+=i;f>0;t[r+p]=s&255,p+=d,s/=256,f-=8);t[r+p-d]|=A*128}var dt={}.toString,Me=Array.isArray||function(t){return dt.call(t)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var ke=50;u.TYPED_ARRAY_SUPPORT=C.TYPED_ARRAY_SUPPORT!==void 0?C.TYPED_ARRAY_SUPPORT:!0;var wt=X();function X(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function P(t,e){if(X()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=u.prototype):(t===null&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(t,e,r);if(typeof t=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return ce(this,t)}return Le(this,t,e,r)}u.poolSize=8192;u._augment=function(t){return t.__proto__=u.prototype,t};function Le(t,e,r,n){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?Et(t,e,r,n):typeof e=="string"?gt(t,e,r):vt(t,e)}u.from=function(t,e,r){return Le(null,t,e,r)};u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array);function Ye(t){if(typeof t!="number")throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function mt(t,e,r,n){return Ye(e),e<=0?P(t,e):r!==void 0?typeof n=="string"?P(t,e).fill(r,n):P(t,e).fill(r):P(t,e)}u.alloc=function(t,e,r){return mt(null,t,e,r)};function ce(t,e){if(Ye(e),t=P(t,e<0?0:ue(e)|0),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}u.allocUnsafe=function(t){return ce(null,t)};u.allocUnsafeSlow=function(t){return ce(null,t)};function gt(t,e,r){if((typeof r!="string"||r==="")&&(r="utf8"),!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=$e(e,r)|0;t=P(t,n);var i=t.write(e,r);return i!==n&&(t=t.slice(0,i)),t}function oe(t,e){var r=e.length<0?0:ue(e.length)|0;t=P(t,r);for(var n=0;n<r;n+=1)t[n]=e[n]&255;return t}function Et(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return r===void 0&&n===void 0?e=new Uint8Array(e):n===void 0?e=new Uint8Array(e,r):e=new Uint8Array(e,r,n),u.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=u.prototype):t=oe(t,e),t}function vt(t,e){if(B(e)){var r=ue(e.length)|0;return t=P(t,r),t.length===0||e.copy(t,0,0,r),t}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||Yt(e.length)?P(t,0):oe(t,e);if(e.type==="Buffer"&&Me(e.data))return oe(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function ue(t){if(t>=X())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+X().toString(16)+" bytes");return t|0}function yt(t){return+t!=t&&(t=0),u.alloc(+t)}u.isBuffer=Ge;function B(t){return!!(t!=null&&t._isBuffer)}u.compare=function(e,r){if(!B(e)||!B(r))throw new TypeError("Arguments must be Buffers");if(e===r)return 0;for(var n=e.length,i=r.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==r[o]){n=e[o],i=r[o];break}return n<i?-1:i<n?1:0};u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};u.concat=function(e,r){if(!Me(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return u.alloc(0);var n;if(r===void 0)for(r=0,n=0;n<e.length;++n)r+=e[n].length;var i=u.allocUnsafe(r),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!B(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i};function $e(t,e){if(B(t))return t.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;typeof t!="string"&&(t=""+t);var r=t.length;if(r===0)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return je(t).length;default:if(n)return Z(t).length;e=(""+e).toLowerCase(),n=!0}}u.byteLength=$e;function xt(t,e,r){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,e>>>=0,r<=e))return"";for(t||(t="utf8");;)switch(t){case"hex":return Pt(this,e,r);case"utf8":case"utf-8":return ze(this,e,r);case"ascii":return Bt(this,e,r);case"latin1":case"binary":return bt(this,e,r);case"base64":return Rt(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ct(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}u.prototype._isBuffer=!0;function k(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)k(this,r,r+1);return this};u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)k(this,r,r+3),k(this,r+1,r+2);return this};u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)k(this,r,r+7),k(this,r+1,r+6),k(this,r+2,r+5),k(this,r+3,r+4);return this};u.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?ze(this,0,e):xt.apply(this,arguments)};u.prototype.equals=function(e){if(!B(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:u.compare(this,e)===0};u.prototype.inspect=function(){var e="",r=ke;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"};u.prototype.compare=function(e,r,n,i,o){if(!B(e))throw new TypeError("Argument must be a Buffer");if(r===void 0&&(r=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),r<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(r>>>=0,n>>>=0,i>>>=0,o>>>=0,this===e)return 0;for(var s=o-i,c=n-r,a=Math.min(s,c),f=this.slice(i,o),h=e.slice(r,n),l=0;l<a;++l)if(f[l]!==h[l]){s=f[l],c=h[l];break}return s<c?-1:c<s?1:0};function Oe(t,e,r,n,i){if(t.length===0)return-1;if(typeof r=="string"?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0)if(i)r=0;else return-1;if(typeof e=="string"&&(e=u.from(e,n)),B(e))return e.length===0?-1:ve(t,e,r,n,i);if(typeof e=="number")return e=e&255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):ve(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function ve(t,e,r,n,i){var o=1,s=t.length,c=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(t.length<2||e.length<2)return-1;o=2,s/=2,c/=2,r/=2}function a(p,d){return o===1?p[d]:p.readUInt16BE(d*o)}var f;if(i){var h=-1;for(f=r;f<s;f++)if(a(t,f)===a(e,h===-1?0:f-h)){if(h===-1&&(h=f),f-h+1===c)return h*o}else h!==-1&&(f-=f-h),h=-1}else for(r+c>s&&(r=s-c),f=r;f>=0;f--){for(var l=!0,m=0;m<c;m++)if(a(t,f+m)!==a(e,m)){l=!1;break}if(l)return f}return-1}u.prototype.includes=function(e,r,n){return this.indexOf(e,r,n)!==-1};u.prototype.indexOf=function(e,r,n){return Oe(this,e,r,n,!0)};u.prototype.lastIndexOf=function(e,r,n){return Oe(this,e,r,n,!1)};function At(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var c=parseInt(e.substr(s*2,2),16);if(isNaN(c))return s;t[r+s]=c}return s}function Tt(t,e,r,n){return ie(Z(e,t.length-r),t,r,n)}function qe(t,e,r,n){return ie(kt(e),t,r,n)}function _t(t,e,r,n){return qe(t,e,r,n)}function It(t,e,r,n){return ie(je(e),t,r,n)}function St(t,e,r,n){return ie(Lt(e,t.length-r),t,r,n)}u.prototype.write=function(e,r,n,i){if(r===void 0)i="utf8",n=this.length,r=0;else if(n===void 0&&typeof r=="string")i=r,n=this.length,r=0;else if(isFinite(r))r=r|0,isFinite(n)?(n=n|0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-r;if((n===void 0||n>o)&&(n=o),e.length>0&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return At(this,e,r,n);case"utf8":case"utf-8":return Tt(this,e,r,n);case"ascii":return qe(this,e,r,n);case"latin1":case"binary":return _t(this,e,r,n);case"base64":return It(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return St(this,e,r,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}};u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Rt(t,e,r){return e===0&&r===t.length?Ee(t):Ee(t.slice(e,r))}function ze(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o=t[i],s=null,c=o>239?4:o>223?3:o>191?2:1;if(i+c<=r){var a,f,h,l;switch(c){case 1:o<128&&(s=o);break;case 2:a=t[i+1],(a&192)===128&&(l=(o&31)<<6|a&63,l>127&&(s=l));break;case 3:a=t[i+1],f=t[i+2],(a&192)===128&&(f&192)===128&&(l=(o&15)<<12|(a&63)<<6|f&63,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:a=t[i+1],f=t[i+2],h=t[i+3],(a&192)===128&&(f&192)===128&&(h&192)===128&&(l=(o&15)<<18|(a&63)<<12|(f&63)<<6|h&63,l>65535&&l<1114112&&(s=l))}}s===null?(s=65533,c=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),i+=c}return Ft(n)}var ye=4096;function Ft(t){var e=t.length;if(e<=ye)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=ye));return r}function Bt(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]&127);return n}function bt(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function Pt(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=Mt(t[o]);return i}function Ct(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+n[o+1]*256);return i}u.prototype.slice=function(e,r){var n=this.length;e=~~e,r=r===void 0?n:~~r,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),r<0?(r+=n,r<0&&(r=0)):r>n&&(r=n),r<e&&(r=e);var i;if(u.TYPED_ARRAY_SUPPORT)i=this.subarray(e,r),i.__proto__=u.prototype;else{var o=r-e;i=new u(o,void 0);for(var s=0;s<o;++s)i[s]=this[s+e]}return i};function w(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUIntLE=function(e,r,n){e=e|0,r=r|0,n||w(e,r,this.length);for(var i=this[e],o=1,s=0;++s<r&&(o*=256);)i+=this[e+s]*o;return i};u.prototype.readUIntBE=function(e,r,n){e=e|0,r=r|0,n||w(e,r,this.length);for(var i=this[e+--r],o=1;r>0&&(o*=256);)i+=this[e+--r]*o;return i};u.prototype.readUInt8=function(e,r){return r||w(e,1,this.length),this[e]};u.prototype.readUInt16LE=function(e,r){return r||w(e,2,this.length),this[e]|this[e+1]<<8};u.prototype.readUInt16BE=function(e,r){return r||w(e,2,this.length),this[e]<<8|this[e+1]};u.prototype.readUInt32LE=function(e,r){return r||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};u.prototype.readUInt32BE=function(e,r){return r||w(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};u.prototype.readIntLE=function(e,r,n){e=e|0,r=r|0,n||w(e,r,this.length);for(var i=this[e],o=1,s=0;++s<r&&(o*=256);)i+=this[e+s]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*r)),i};u.prototype.readIntBE=function(e,r,n){e=e|0,r=r|0,n||w(e,r,this.length);for(var i=r,o=1,s=this[e+--i];i>0&&(o*=256);)s+=this[e+--i]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*r)),s};u.prototype.readInt8=function(e,r){return r||w(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};u.prototype.readInt16LE=function(e,r){r||w(e,2,this.length);var n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};u.prototype.readInt16BE=function(e,r){r||w(e,2,this.length);var n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};u.prototype.readInt32LE=function(e,r){return r||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};u.prototype.readInt32BE=function(e,r){return r||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};u.prototype.readFloatLE=function(e,r){return r||w(e,4,this.length),re(this,e,!0,23,4)};u.prototype.readFloatBE=function(e,r){return r||w(e,4,this.length),re(this,e,!1,23,4)};u.prototype.readDoubleLE=function(e,r){return r||w(e,8,this.length),re(this,e,!0,52,8)};u.prototype.readDoubleBE=function(e,r){return r||w(e,8,this.length),re(this,e,!1,52,8)};function g(t,e,r,n,i,o){if(!B(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}u.prototype.writeUIntLE=function(e,r,n,i){if(e=+e,r=r|0,n=n|0,!i){var o=Math.pow(2,8*n)-1;g(this,e,r,n,o,0)}var s=1,c=0;for(this[r]=e&255;++c<n&&(s*=256);)this[r+c]=e/s&255;return r+n};u.prototype.writeUIntBE=function(e,r,n,i){if(e=+e,r=r|0,n=n|0,!i){var o=Math.pow(2,8*n)-1;g(this,e,r,n,o,0)}var s=n-1,c=1;for(this[r+s]=e&255;--s>=0&&(c*=256);)this[r+s]=e/c&255;return r+n};u.prototype.writeUInt8=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[r]=e&255,r+1};function te(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>(n?i:1-i)*8}u.prototype.writeUInt16LE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[r]=e&255,this[r+1]=e>>>8):te(this,e,r,!0),r+2};u.prototype.writeUInt16BE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[r]=e>>>8,this[r+1]=e&255):te(this,e,r,!1),r+2};function ne(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>(n?i:3-i)*8&255}u.prototype.writeUInt32LE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=e&255):ne(this,e,r,!0),r+4};u.prototype.writeUInt32BE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255):ne(this,e,r,!1),r+4};u.prototype.writeIntLE=function(e,r,n,i){if(e=+e,r=r|0,!i){var o=Math.pow(2,8*n-1);g(this,e,r,n,o-1,-o)}var s=0,c=1,a=0;for(this[r]=e&255;++s<n&&(c*=256);)e<0&&a===0&&this[r+s-1]!==0&&(a=1),this[r+s]=(e/c>>0)-a&255;return r+n};u.prototype.writeIntBE=function(e,r,n,i){if(e=+e,r=r|0,!i){var o=Math.pow(2,8*n-1);g(this,e,r,n,o-1,-o)}var s=n-1,c=1,a=0;for(this[r+s]=e&255;--s>=0&&(c*=256);)e<0&&a===0&&this[r+s+1]!==0&&(a=1),this[r+s]=(e/c>>0)-a&255;return r+n};u.prototype.writeInt8=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[r]=e&255,r+1};u.prototype.writeInt16LE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[r]=e&255,this[r+1]=e>>>8):te(this,e,r,!0),r+2};u.prototype.writeInt16BE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[r]=e>>>8,this[r+1]=e&255):te(this,e,r,!1),r+2};u.prototype.writeInt32LE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[r]=e&255,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24):ne(this,e,r,!0),r+4};u.prototype.writeInt32BE=function(e,r,n){return e=+e,r=r|0,n||g(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255):ne(this,e,r,!1),r+4};function Ke(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function We(t,e,r,n,i){return i||Ke(t,e,r,4),Ne(t,e,r,n,23,4),r+4}u.prototype.writeFloatLE=function(e,r,n){return We(this,e,r,!0,n)};u.prototype.writeFloatBE=function(e,r,n){return We(this,e,r,!1,n)};function He(t,e,r,n,i){return i||Ke(t,e,r,8),Ne(t,e,r,n,52,8),r+8}u.prototype.writeDoubleLE=function(e,r,n){return He(this,e,r,!0,n)};u.prototype.writeDoubleBE=function(e,r,n){return He(this,e,r,!1,n)};u.prototype.copy=function(e,r,n,i){if(n||(n=0),!i&&i!==0&&(i=this.length),r>=e.length&&(r=e.length),r||(r=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-r<i-n&&(i=e.length-r+n);var o=i-n,s;if(this===e&&n<r&&r<i)for(s=o-1;s>=0;--s)e[s+r]=this[s+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)e[s+r]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),r);return o};u.prototype.fill=function(e,r,n,i){if(typeof e=="string"){if(typeof r=="string"?(i=r,r=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),e.length===1){var o=e.charCodeAt(0);o<256&&(e=o)}if(i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else typeof e=="number"&&(e=e&255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;r=r>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);var s;if(typeof e=="number")for(s=r;s<n;++s)this[s]=e;else{var c=B(e)?e:Z(new u(e,i).toString()),a=c.length;for(s=0;s<n-r;++s)this[s+r]=c[s%a]}return this};var Ut=/[^+\/0-9A-Za-z-_]/g;function Dt(t){if(t=Nt(t).replace(Ut,""),t.length<2)return"";for(;t.length%4!==0;)t=t+"=";return t}function Nt(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Mt(t){return t<16?"0"+t.toString(16):t.toString(16)}function Z(t,e){e=e||1/0;for(var r,n=t.length,i=null,o=[],s=0;s<n;++s){if(r=t.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return o}function kt(t){for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r)&255);return e}function Lt(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function je(t){return ft(Dt(t))}function ie(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Yt(t){return t!==t}function Ge(t){return t!=null&&(!!t._isBuffer||Ve(t)||$t(t))}function Ve(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function $t(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&Ve(t.slice(0,0))}var H=Object.freeze({__proto__:null,Buffer:u,INSPECT_MAX_BYTES:ke,SlowBuffer:yt,isBuffer:Ge,kMaxLength:wt});function Ot(t,e){return e={exports:{}},t(e,e.exports),e.exports}function he(t){return t&&t.default||t}var Je=Ot(function(t,e){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=H.Buffer;function n(o,s){for(var c in o)s[c]=o[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=H:(n(H,e),e.Buffer=i);function i(o,s,c){return r(o,s,c)}i.prototype=Object.create(r.prototype),n(r,i),i.from=function(o,s,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,s,c)},i.alloc=function(o,s,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var a=r(o);return s!==void 0?typeof c=="string"?a.fill(s,c):a.fill(s):a.fill(0),a},i.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},i.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return H.SlowBuffer(o)}});Je.Buffer;var j=Je.Buffer;function qt(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(e[o]!==255)throw new TypeError(i+" is ambiguous");e[o]=n}var s=t.length,c=t.charAt(0),a=Math.log(s)/Math.log(256),f=Math.log(256)/Math.log(s);function h(p){if((Array.isArray(p)||p instanceof Uint8Array)&&(p=j.from(p)),!j.isBuffer(p))throw new TypeError("Expected Buffer");if(p.length===0)return"";for(var d=0,A=0,y=0,T=p.length;y!==T&&p[y]===0;)y++,d++;for(var _=(T-y)*f+1>>>0,E=new Uint8Array(_);y!==T;){for(var I=p[y],U=0,x=_-1;(I!==0||U<A)&&x!==-1;x--,U++)I+=256*E[x]>>>0,E[x]=I%s>>>0,I=I/s>>>0;if(I!==0)throw new Error("Non-zero carry");A=U,y++}for(var S=_-A;S!==_&&E[S]===0;)S++;for(var W=c.repeat(d);S<_;++S)W+=t.charAt(E[S]);return W}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return j.alloc(0);for(var d=0,A=0,y=0;p[d]===c;)A++,d++;for(var T=(p.length-d)*a+1>>>0,_=new Uint8Array(T);p[d];){var E=e[p.charCodeAt(d)];if(E===255)return;for(var I=0,U=T-1;(E!==0||I<y)&&U!==-1;U--,I++)E+=s*_[U]>>>0,_[U]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=I,d++}for(var x=T-y;x!==T&&_[x]===0;)x++;var S=j.allocUnsafe(A+(T-x));S.fill(0,0,A);for(var W=A;x!==T;)S[W++]=_[x++];return S}function m(p){var d=l(p);if(d)return d;throw new Error("Non-base"+s+" character")}return{encode:h,decodeUnsafe:l,decode:m}}var zt=qt,Kt="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",xe=zt(Kt);class Wt extends Fe{constructor({net:e="mainnet-beta",server:r,appId:n,rpc:i}){super(),this.accounts=[],q(e,"'net' is required"),q(nt.includes(e),"unsupported net"),this.net=e,this.rpc=i||(e==="mainnet-beta"?"https://free.rpcpool.com":`https://api.${e}.solana.com`),this.server=r||tt[this.net]||"https://wallet.blocto.app",this.appId=n||{}.APP_ID}tryRetrieveSessionFromStorage(){const e=be(this.sessionKey,{}),r=e&&e.code,n=e&&e.address&&e.address.solana;this.connected=!!(r&&n),this.code=r||null,this.accounts=n?[n]:[]}async request(e){this.connected||await this.connect();try{let r=null,n=null;switch(e.method){case"connect":n=await this.fetchAccounts();break;case"disconnect":this.disconnect();break;case"getAccounts":n=this.accounts.length?this.accounts:await this.fetchAccounts();break;case"getAccountInfo":{const i=await this.handleReadRequests(e),[o,s]=i.result.value.data;n={...i.result.value,data:u.from(o,s),owner:new me(i.result.value.owner)};break}case"convertToProgramWalletTransaction":n=await this.handleConvertTransaction(e);break;case"signAndSendTransaction":n=await this.handleSignAndSendTransaction(e);break;case"signTransaction":case"signAllTransactions":throw new Error(`Blocto is program wallet, which doesn't support ${e.method}. Use signAndSendTransaction instead.`);default:r=await this.handleReadRequests(e)}if(r&&!r.result&&r.error){const i=r.error.message?r.error.message:"Request failed";throw new Error(i)}return r?r.result:n}catch(r){throw console.error(r),r}}async connect(){const e=window.solana;return e&&e.isBlocto?new Promise(r=>{e.once("connect",n=>{this.accounts=[n.toBase58()],r()}),e.connect()}):(this.tryRetrieveSessionFromStorage(),new Promise((r,n)=>{if(typeof window>"u"&&n("Currently only supported in browser"),this.connected)return r();const i=encodeURIComponent(window.location.origin),o=z(`${this.server}/authn?l6n=${i}&chain=solana`);K(o),$("message",(s,c)=>{const a=s;if(a.origin===this.server){if(a.data.type==="FCL::CHALLENGE::RESPONSE"){c(),R(o),this.code=a.data.code,this.connected=!0,this.eventListeners.connect.forEach(h=>h(this.net));const f=a.data.address;this.accounts=f?[f.solana]:[],Ce(this.sessionKey,{code:this.code,address:f},Re),r()}a.data.type==="FCL::CHALLENGE::CANCEL"&&(c(),R(o),n(new Error("User declined the login request")))}})}))}async disconnect(){const e=window.solana;if(e&&e.isBlocto){await e.dicconnect();return}this.code=null,this.accounts=[],this.eventListeners.disconnect.forEach(r=>r())}async fetchAccounts(){const{accounts:e}=await fetch(`${this.server}/api/solana/accounts?code=${this.code}`).then(r=>r.json());return this.accounts=e,e}async handleReadRequests(e){return fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:1,jsonrpc:"2.0",...e})}).then(r=>r.json())}async convertToProgramWalletTransaction(e){const r=window.solana;if(r&&r.isBlocto)return r.convertToProgramWalletTransaction(e);const n=await this.request({method:"convertToProgramWalletTransaction",params:{message:e.serializeMessage().toString("hex")}});return this.toTransaction(n,[])}async signAndSendTransaction(e,r){const n=window.solana;if(n&&n.isBlocto)return n.signAndSendTransaction(e);const i={};if(r){r.commitment&&(i.commitment=r.commitment);const o=r?r._rpcEndpoint:null;o&&o!==this.rpc&&(this.rpc=o,this.disconnect(),await this.connect())}return this.request({method:"signAndSendTransaction",params:{signatures:await this.collectSignatures(e),message:e.serializeMessage().toString("hex"),...i}})}toTransaction(e,r){const n=xr.from(u.from(e,"hex")),i=new Ar;return i.recentBlockhash=n.recentBlockhash,n.header.numRequiredSignatures>0&&(i.feePayer=n.accountKeys[0]),r.forEach((o,s)=>{const c={signature:o===me.default.toBase58()?null:xe.decode(o),publicKey:n.accountKeys[s]};i.signatures.push(c)}),n.instructions.forEach(o=>{const s=o.accounts.map(c=>({pubkey:n.accountKeys[c],isSigner:c<n.header.numRequiredSignatures,isWritable:n.isAccountWritable(c)}));i.instructions.push(new Tr({keys:s,programId:n.accountKeys[o.programIdIndex],data:xe.decode(o.data)}))}),i}async collectSignatures(e){return e.signatures.reduce((r,n)=>(n.signature&&(r[n.publicKey.toBase58()]=n.signature.toString("hex")),r),{})}async handleConvertTransaction(e){return fetch(`${this.server}/api/solana/convertToWalletTx?code=${this.code}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:this.code,...e.params})}).then(r=>Q(r,this))}async handleSignAndSendTransaction(e){const{authorizationId:r}=await fetch(`${this.server}/api/solana/authz?code=${this.code}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:this.code,...e.params})}).then(i=>Q(i,this));if(typeof window>"u")throw new Error("Currently only supported in browser");const n=z(`${this.server}/authz/solana/${r}`);return K(n),new Promise((i,o)=>$("message",(s,c)=>{const a=s;a.origin===this.server&&a.data.type==="SOL:FRAME:RESPONSE"&&(a.data.status==="APPROVED"&&(c(),R(n),i(a.data.txHash)),a.data.status==="DECLINED"&&(c(),R(n),o(new Error("User declined to send the transaction"))))}))}}var Ht={},jt=Object.freeze({__proto__:null,default:Ht});function Qe(t,e){for(var r=0,n=t.length-1;n>=0;n--){var i=t[n];i==="."?t.splice(n,1):i===".."?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}var Gt=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,fe=function(t){return Gt.exec(t).slice(1)};function ee(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:"/";if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)continue;t=n+"/"+t,e=n.charAt(0)==="/"}return t=Qe(de(t.split("/"),function(i){return!!i}),!e).join("/"),(e?"/":"")+t||"."}function le(t){var e=pe(t),r=Jt(t,-1)==="/";return t=Qe(de(t.split("/"),function(n){return!!n}),!e).join("/"),!t&&!e&&(t="."),t&&r&&(t+="/"),(e?"/":"")+t}function pe(t){return t.charAt(0)==="/"}function Xe(){var t=Array.prototype.slice.call(arguments,0);return le(de(t,function(e,r){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function Ze(t,e){t=ee(t).substr(1),e=ee(e).substr(1);function r(f){for(var h=0;h<f.length&&f[h]==="";h++);for(var l=f.length-1;l>=0&&f[l]==="";l--);return h>l?[]:f.slice(h,l-h+1)}for(var n=r(t.split("/")),i=r(e.split("/")),o=Math.min(n.length,i.length),s=o,c=0;c<o;c++)if(n[c]!==i[c]){s=c;break}for(var a=[],c=s;c<n.length;c++)a.push("..");return a=a.concat(i.slice(s)),a.join("/")}var er="/",rr=":";function tr(t){var e=fe(t),r=e[0],n=e[1];return!r&&!n?".":(n&&(n=n.substr(0,n.length-1)),r+n)}function nr(t,e){var r=fe(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r}function ir(t){return fe(t)[3]}var Vt={extname:ir,basename:nr,dirname:tr,sep:er,delimiter:rr,relative:Ze,join:Xe,isAbsolute:pe,normalize:le,resolve:ee};function de(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}var Jt="ab".substr(-1)==="b"?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)},Qt=Object.freeze({__proto__:null,resolve:ee,normalize:le,isAbsolute:pe,join:Xe,relative:Ze,sep:er,delimiter:rr,dirname:tr,basename:nr,extname:ir,default:Vt}),G;function or(){if(typeof G>"u"){var t=new ArrayBuffer(2),e=new Uint8Array(t),r=new Uint16Array(t);if(e[0]=1,e[1]=2,r[0]===258)G="BE";else if(r[0]===513)G="LE";else throw new Error("unable to figure out endianess")}return G}function sr(){return typeof C.location<"u"?C.location.hostname:""}function ar(){return[]}function cr(){return 0}function ur(){return Number.MAX_VALUE}function hr(){return Number.MAX_VALUE}function fr(){return[]}function lr(){return"Browser"}function pr(){return typeof C.navigator<"u"?C.navigator.appVersion:""}function dr(){}function wr(){}function Xt(){return"javascript"}function Zt(){return"browser"}function we(){return"/tmp"}var mr=we,gr=`
`,en={EOL:gr,tmpdir:mr,tmpDir:we,networkInterfaces:dr,getNetworkInterfaces:wr,release:pr,type:lr,cpus:fr,totalmem:hr,freemem:ur,uptime:cr,loadavg:ar,hostname:sr,endianness:or},rn=Object.freeze({__proto__:null,endianness:or,hostname:sr,loadavg:ar,uptime:cr,freemem:ur,totalmem:hr,cpus:fr,type:lr,release:pr,networkInterfaces:dr,getNetworkInterfaces:wr,arch:Xt,platform:Zt,tmpDir:we,tmpdir:mr,EOL:gr,default:en}),tn=he(jt),Er=he(Qt),nn=he(rn);function vr(t){console.log(`[dotenv][DEBUG] ${t}`)}const on=`
`,sn=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,an=/\\n/g,cn=/\r\n|\n|\r/;function yr(t,e){const r=!!(e&&e.debug),n={};return t.toString().split(cn).forEach(function(i,o){const s=i.match(sn);if(s!=null){const c=s[1];let a=s[2]||"";const f=a.length-1,h=a[0]==='"'&&a[f]==='"';a[0]==="'"&&a[f]==="'"||h?(a=a.substring(1,f),h&&(a=a.replace(an,on))):a=a.trim(),n[c]=a}else r&&vr(`did not match key and value when parsing line ${o+1}: ${i}`)}),n}function un(t){return t[0]==="~"?Er.join(nn.homedir(),t.slice(1)):t}function hn(t){let e=Er.resolve(J.cwd(),".env"),r="utf8",n=!1;t&&(t.path!=null&&(e=un(t.path)),t.encoding!=null&&(r=t.encoding),t.debug!=null&&(n=!0));try{const i=yr(tn.readFileSync(e,{encoding:r}),{debug:n});return Object.keys(i).forEach(function(o){Object.prototype.hasOwnProperty.call(J.env,o)?n&&vr(`"${o}" is already defined in \`process.env\` and will not be overwritten`):J.env[o]=i[o]}),{parsed:i}}catch(i){return{error:i}}}var fn=hn,ln=yr,pn={config:fn,parse:ln};pn.config();class wn{constructor({appId:e,ethereum:r,solana:n}){r&&(this.ethereum=new ut({...r,appId:e})),n&&(this.solana=new Wt({...n,appId:e}))}}export{wn as default};
