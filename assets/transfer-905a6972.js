import{g as J,T as oe,a as ie,c as re,b as W,Q as K,o as ce,_ as le,d as ue,e as de}from"./AppDescriptionTop-5b967428.js";import{k as y,P as v,m as V,n as fe,S as $,q as z,s as pe,u as ve,t as me,v as l,w as I,x as _e,y as Z,z as ye,A as ke,B as h,C as E,F as q,G as B,H as O,I as be,J as ge,K as H,M as we,L as he,N as U,O as Te,Q as Se,R as Ae,o as P,U as xe,V as T,W as Ne,j as d,X as C,Y as Q,Z as r,$ as i,i as G,a0 as Re,a1 as L,a2 as j,a3 as D,a4 as Fe,a5 as Ce,a6 as Ee,a7 as Me,_ as Ie,a8 as Be}from"./index-28080a10.js";var Pe=Object.defineProperty,We=(s,e,t)=>e in s?Pe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ke=(s,e,t)=>(We(s,typeof e!="symbol"?e+"":e,t),t);const Ve=new y.BeetArgsStruct([["instructionDiscriminator",y.uniformFixedSizeArray(y.u8,8)],["amount",y.u64]],"SplTransferInstructionArgs"),qe=[67,186,237,99,235,243,166,198];function Oe(s,e,t=new v("J4pyN7p9dAovEQKoZJV1jUbM3FrCBPLCS2dyiRUnwi5c")){const[o]=Ve.serialize({instructionDiscriminator:qe,...e}),u=[{pubkey:s.sender,isWritable:!0,isSigner:!0},{pubkey:s.receiver,isWritable:!0,isSigner:!1},{pubkey:s.tokenMint,isWritable:!1,isSigner:!1},{pubkey:s.source,isWritable:!0,isSigner:!1},{pubkey:s.destination,isWritable:!0,isSigner:!1},{pubkey:s.policy,isWritable:!1,isSigner:!1},{pubkey:s.proofRequest,isWritable:!1,isSigner:!1},{pubkey:s.tokenProgram??fe,isWritable:!1,isSigner:!1},{pubkey:s.systemProgram??$.programId,isWritable:!1,isSigner:!1}];if(s.anchorRemainingAccounts!=null)for(const k of s.anchorRemainingAccounts)u.push(k);return new z({programId:t,keys:u,data:o})}const Ue=new y.BeetArgsStruct([["instructionDiscriminator",y.uniformFixedSizeArray(y.u8,8)],["amount",y.u64]],"TransferInstructionArgs"),Qe=[163,52,200,231,140,3,69,186];function Le(s,e,t=new v("J4pyN7p9dAovEQKoZJV1jUbM3FrCBPLCS2dyiRUnwi5c")){const[o]=Ue.serialize({instructionDiscriminator:Qe,...e}),u=[{pubkey:s.sender,isWritable:!0,isSigner:!0},{pubkey:s.receiver,isWritable:!0,isSigner:!1},{pubkey:s.policy,isWritable:!1,isSigner:!1},{pubkey:s.proofRequest,isWritable:!1,isSigner:!1},{pubkey:s.systemProgram??$.programId,isWritable:!1,isSigner:!1}];if(s.anchorRemainingAccounts!=null)for(const k of s.anchorRemainingAccounts)u.push(k);return new z({programId:t,keys:u,data:o})}const je="J4pyN7p9dAovEQKoZJV1jUbM3FrCBPLCS2dyiRUnwi5c",De=new v(je);class Je{constructor(e){Ke(this,"programId",De),this.provider=e}get connection(){return this.provider.connection}async transfer(e,t){const o=this.createTransferTx(e);return this.provider.sendAndConfirm(o,[],t)}createTransferTx(e){const t=Le({proofRequest:e.proofRequest,policy:e.policy,sender:this.provider.publicKey,receiver:e.receiver},{amount:e.amount});return new V().add(t)}async getTransferFee(e){const t=this.createTransferTx(e);return this.transactionFee(t)}async transferToken(e,t){const o=await this.createTransferTokenTx(e);return this.provider.sendAndConfirm(o,[],t)}async createTransferTokenTx(e){const t=new V;try{await J(this.connection,e.destination)}catch(o){(o instanceof oe||o instanceof ie)&&t.add(re(this.provider.publicKey,e.destination,e.receiver,e.tokenMint))}return t.add(Oe({proofRequest:e.proofRequest,policy:e.policy,sender:this.provider.publicKey,receiver:e.receiver,source:e.source,destination:e.destination,tokenMint:e.tokenMint},{amount:e.amount})),t}async getTransferTokenFee(e){const t=await this.createTransferTokenTx(e);return this.transactionFee(t)}async transactionFee(e){e.recentBlockhash=(await this.connection.getLatestBlockhash("finalized")).blockhash,e.feePayer=this.provider.publicKey;const{value:t}=await this.connection.getFeeForMessage(e.compileMessage(),"confirmed");return Number(t)}}const $e=pe("transfer",()=>{const s=ve(),e=me(),t=l(()=>e.tokens),o=I(),{state:u,getUserTokens:k}=I(),f=l(()=>o.certificate),N=l(()=>o.requiredPolicy),M=l(()=>o.certificateValid),S=0,g=_e(),{publicKey:m}=Z(),{notify:R}=ye(),n=ke({address:"",value:void 0,loading:!1,token:void 0,fee:S,valid:!1});h(t,()=>{!n.token&&t.value[0]&&(n.token=t.value[0])},{immediate:!0});function A(){n.value=void 0,n.fee=S}h(()=>n.token,()=>{A(),o.policySpec=n.token?.name??""}),h(()=>g.value?.publicKey,a=>{a||(A(),n.address="")}),h(()=>n.address,async()=>{n.valid=E(n.address)});const _=l(()=>{const a=n.token?.mint??"";return E(a)?new v(a):""}),b=l(()=>E(n.address)?new v(n.address):""),p=q(),c=q(!1);h([_,b,()=>n.valid],async()=>{if(n.token?.mint===B)return c.value=!0;if(_.value&&b.value&&n.valid)try{return p.value=await W(_.value,b.value),await J(s.connection,p.value),c.value=!0}catch{c.value=!1}c.value=!1}),h([()=>n.valid,()=>n.value,p],()=>{n.valid&&Number(n.value)>0?x():n.fee=S});const F=l(()=>new Je(new O(s.connection,g.value??{publicKey:v.default},O.defaultOptions())));async function x(){const a=await be(g.value?.publicKey,n.address,Number(n.value),s.connection),w=await ge(a,s.connection)+H;return n.fee=c.value?w:w+we}async function X(){try{if(n.loading=!0,console.log("[debug] on transfer certificate === ",f.value),M.value){let a;n.token?.mint===B?a=await Y():a=await ee(),R({type:"positive",message:"Transaction confirmed",actions:[{label:"Explore",color:"white",target:"_blank",href:`https://explorer.solana.com/tx/${a}?cluster=${s.cluster}`,onClick:()=>!1}]}),A(),await k()}else he()}catch(a){console.error("verifyTransfer error: ",a)}finally{n.loading=!1}}async function Y(){if(f.value){const a=new U(Number(n.value)*Te),w=new v(n.address);return await F.value.transfer({amount:a,receiver:w,proofRequest:f.value.pubkey,policy:new v(N.value)})}}async function ee(){if(!m.value||!n.token?.mint)return;const a=u.tokens.find(ae=>ae.mint===n.token?.mint);if(!a||!_.value||!b.value||!g.value||!f.value)return;const w=await W(_.value,m.value),te=new U(Number(n.value)*10**a.decimals);return await F.value.transferToken({destination:p.value,source:w,tokenMint:_.value,amount:te,receiver:b.value,proofRequest:f.value.pubkey,policy:new v(N.value)})}function ne(a){n.value=a}function se(a){n.token=a}return{state:n,setMax:ne,setToken:se,verifyTransfer:X}}),ze={class:"swap-form"},Ze={class:"swap-field"},He={class:"swap-field__info"},Ge={class:"row"},Xe=r("div",{class:"col-2 swap-field__label"}," AMOUNT ",-1),Ye={class:"col row justify-end swap-field__balance q-pr-sm"},en={key:0,class:"insufficient-error"},nn=r("div",{class:"col-3 swap-field__label q-pl-sm"}," ASSET ",-1),sn={class:"row justify-between",style:{gap:"10px"}},tn={class:"transfer-address"},an=r("div",{class:"col transfer-address__label"}," Address ",-1),on={class:"swap-info"},rn=r("dt",null,"Transfer fee:",-1),cn={class:"swap-submit transfer-submit"},ln=Se({__name:"TransferCard",setup(s){const{state:e,setMax:t,setToken:o,verifyTransfer:u}=$e(),{state:k,tokenBalance:f}=I(),{handleSearchToken:N,tokens:M}=Ae(),S=l(()=>[...M.value].sort((p,c)=>f(c.symbol)-f(p.symbol))),{connected:g}=Z(),m=l(()=>e.token?.mint?f(e.token.mint):0),R=l(()=>m.value===0),n=l(()=>Number(e.value)>m.value);async function A(){const p=n.value?"Insufficient funds":"Not valid address";if(!e.valid||n.value)return Ce.create({type:"negative",timeout:2e3,message:p});u()}function _(){t(m.value),e.token?.mint===B&&(e.value=m.value-Ee-3*Me-H)}const b=l(()=>Number(e.value)>0&&E(e.address));return(p,c)=>{const F=le;return P(),xe(Ne,{class:"swap-card transfer-card"},{default:T(()=>[d(Q,{class:"swap-card__header"},{default:T(()=>[C(" Transfer ")]),_:1}),d(Q,{class:"swap-card__body"},{default:T(()=>[r("div",ze,[r("div",Ze,[r("div",He,[r("div",Ge,[Xe,r("div",Ye,[i(n)?(P(),G("div",en," Insufficient funds ")):Re("",!0),C(" Balance: "+L(i(j)(i(m))),1)]),nn])]),r("div",sn,[d(K,{modelValue:i(e).value,"onUpdate:modelValue":c[0]||(c[0]=x=>i(e).value=x),disable:i(R),maxlength:14,outlined:"",placeholder:"0.0",class:"swap-input col",onKeypress:i(ce)},{append:T(()=>[d(D,{dense:"",unelevated:"",ripple:!1,class:"swap-input__max",onClick:_},{default:T(()=>[C(" MAX ")]),_:1})]),_:1},8,["modelValue","disable","onKeypress"]),d(F,{disable:!i(g),options:i(S),onHandleSearchToken:i(N),onSetToken:i(o)},null,8,["disable","options","onHandleSearchToken","onSetToken"])])])]),r("div",tn,[an,d(K,{modelValue:i(e).address,"onUpdate:modelValue":c[1]||(c[1]=x=>i(e).address=x),disable:i(R),maxlength:50,outlined:"",class:"swap-input col"},null,8,["modelValue","disable"])]),r("div",on,[r("dl",null,[rn,r("dd",null,L(i(j)(i(e).fee,6)),1)])]),r("div",cn,[d(D,{loading:i(e)?.loading,disable:!i(b),rounded:"",ripple:!1,onClick:A},{default:T(()=>[C(" Send ")]),_:1},8,["loading","disable"])])]),_:1}),d(Fe,{showing:i(k)?.loading,class:"swap-loading",color:"grey"},null,8,["showing"])]),_:1})}}}),un={},dn={class:"main-block row justify-center"};function fn(s,e){const t=ue,o=ln,u=de;return P(),G(Be,null,[d(t,{class:"q-mt-xl"}),r("div",dn,[d(o)]),d(u,{class:"q-mt-lg"})],64)}const mn=Ie(un,[["render",fn]]);export{mn as default};
