import{ao as re,ap as O,b2 as ie,a as te,ar as ce,P as C,as as ue,am as de,V as E,w as oe,v as P,o as v,Y as x,Z as _,a3 as t,i as h,a2 as l,a5 as g,ad as me,aG as pe,b3 as we,a4 as q,$ as ae,a0 as T,aW as ke,j as s,b4 as ye,u as ne,z as se,b5 as fe,G as N,b6 as _e,b7 as ve,b8 as be,x as ge,y as Se,B as j,aw as le,ah as G,b9 as Te,aO as Fe,ba as $,bb as z,bc as W,W as he,a1 as J,aM as Ae,aJ as Be,aK as Ve,a7 as b,a8 as V,bd as X,aE as K,aF as De,aX as Me,_ as Ne}from"./index-439cc3d7.js";import{_ as Ce}from"./SelectToken.vue_vue_type_script_setup_true_lang-e8a491bd.js";import{u as Pe,s as Y}from"./swap-89e2735b.js";import{a as qe}from"./internal-641e0318.js";import"./associatedTokenAccount-9f5efe28.js";var Z;(function(r){r[r.MintTokens=0]="MintTokens",r[r.FreezeAccount=1]="FreezeAccount",r[r.AccountOwner=2]="AccountOwner",r[r.CloseAccount=3]="CloseAccount"})(Z||(Z={}));const ee=re([O("instruction"),O("authorityType"),O("newAuthorityOption"),ie("newAuthority")]);function Ue(r,o,i,w,A=[],m=de){const e=qe([{pubkey:r,isSigner:!1,isWritable:!0}],o,A),p=te.Buffer.alloc(ee.span);return ee.encode({instruction:ce.SetAuthority,authorityType:i,newAuthorityOption:w?1:0,newAuthority:w||new C(0)},p),new ue({keys:e,programId:m,data:p})}const $e={key:0,class:"policy-card__policy q-pa-md"},Ke={class:"policy-card__policy__info"},xe={class:"policy-card__policy__subtitle"},Ie={class:"policy-card__policy__subtitle"},Oe=l("div",{class:"policy-card__policy__subtitle"}," Rules: ",-1),We={class:"q-ml-xs"},Ee={key:0},Re=E({__name:"SelectPolicyItem",props:{policyData:Object,policy:Object},setup(r){const o=oe(),i=P(()=>o.serviceData),w=P(()=>o.serviceLoading);return(A,m)=>(v(),x(ae,{class:""},{default:_(()=>[t(w)?q("",!0):(v(),h("div",$e,[l("div",Ke,[l("div",xe," Address: "+g(r.policy?.toBase58()),1),l("div",Ie," Name: "+g(t(i)?.name)+" "+g(r.policyData?.name),1),Oe,l("div",We,[(v(!0),h(me,null,pe(r.policyData?.rules,(e,p)=>(v(),h("div",{key:p},[e.key!=="maxAge"&&e.key!=="expectedDateTo"||e.label!=="0"?(v(),h("span",Ee,g(t(we)(e.key,e.label,e.value)),1)):q("",!0)]))),128))])])]))]),_:1}))}}),He={key:0},Le={key:1},Qe=E({__name:"CreatePoolTokenData",props:{balance:[String,Number],mint:String},setup(r){return(o,i)=>(v(),h("div",null,[r.mint?(v(),h("div",He,[l("div",null," balance: "+g(r.balance),1),l("div",null,[T(" mint: "+g(t(ke)(r.mint))+" ",1),s(ye,{anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:_(()=>[T(g(r.mint),1)]),_:1})])])):(v(),h("div",Le," Select token "))]))}});function je(){const r=ne(),{notify:o}=se(),i=fe(r,"cluster"),w=N(!1);async function A(m,{onSuccess:e,onError:p,idx:k,commitment:B=_e,sendTimeout:D=ve,confirmTimeout:M=be}={}){k=k??"";let F=o({progress:!0,type:"ongoing",message:k?`Sending transaction "${k}" ...`:"Sending transaction...",timeout:D});const f={label:"Close",color:"white"};w.value=!0;let c="";try{const d=await m;c=String(typeof d=="object"?await d.signature:await m)}catch(d){w.value=!1,F(),String(d?.message).startsWith("User rejected")||o({message:k?`Transaction "${k}" error`:"Transaction error",caption:d?.message,type:"negative",timeout:0,actions:[f]});return}const y={label:"Explore",color:"white",target:"_blank",href:`https://solscan.io/tx/${c}?cluster=${i.value}`,onClick:()=>!1};try{F(),F=o({progress:!0,type:"ongoing",message:k?`Confirming transaction "${k}" ...`:"Confirming transaction...",actions:[y],timeout:M});const d=await r.connection.getLatestBlockhash(),S=await r.connection.confirmTransaction({blockhash:d.blockhash,lastValidBlockHeight:d.lastValidBlockHeight,signature:c},B);if(F(),S.value.err)throw new Error(JSON.stringify(S.value.err));F=o({message:k?`Transaction "${k}" confirmed`:"Transaction confirmed",type:"positive",actions:[y]}),e&&e(c)}catch(d){F(),o({message:k?`Transaction "${k}" error`:"Transaction error",caption:d.message,type:"negative",timeout:0,actions:[y,f]}),p&&p(d),console.error(d)}finally{w.value=!1}}return{monitorTransaction:A,sending:w}}function Ge(){const r=Pe(),o=ge(),{publicKey:i}=Se(),w=ne(),{monitorTransaction:A}=je(),{notify:m}=se(),e=j({tokenA:void 0,tokenB:void 0,policy:void 0,hostFeeNumerator:0,hostFeeDenominator:1e3,tradeFeeNumerator:0,tradeFeeDenominator:1e3,ownerTradeFeeNumerator:0,ownerTradeFeeDenominator:1e3,ownerWithdrawFeeNumerator:0,ownerWithdrawFeeDenominator:1e3,creating:!1,tokenSwap:void 0,poolMint:void 0,poolFeeAccount:void 0,swapTokenA:void 0,swapTokenB:void 0}),p=j({name:"",symbol:"",metadataUrl:"",isMutable:!1});async function k(){!i.value||!o.value||(e.tokenSwap=le.generate(),console.log("[create swap] token swap pk = ",e.tokenSwap.publicKey.toBase58()),console.log("[create swap] token swap sk = ",e.tokenSwap.secretKey.toString()))}async function B(){if(!i.value||!o.value||!e.tokenSwap)return;const f=r.swapClient.swapAuthority(e.tokenSwap.publicKey),c=new G;e.creating=!0;try{const u=await Te(w.connection,c,i.value,i.value,Fe),y=C.findProgramAddressSync([te.Buffer.from("metadata"),$.PROGRAM_ID.toBuffer(),u.publicKey.toBuffer()],$.PROGRAM_ID)[0],d={name:p.name,symbol:p.symbol,uri:p.metadataUrl,sellerFeeBasisPoints:0,creators:null,collection:null,uses:null},S=$.createCreateMetadataAccountV3Instruction({metadata:y,mint:u.publicKey,mintAuthority:i.value,payer:i.value,updateAuthority:i.value},{createMetadataAccountArgsV3:{data:d,isMutable:p.isMutable,collectionDetails:null}});c.add(S);const I=Ue(u.publicKey,i.value,0,f);c.add(I);const U=$.createUpdateMetadataAccountV2Instruction({metadata:y,updateAuthority:i.value},{updateMetadataAccountArgsV2:{data:d,updateAuthority:f,primarySaleHappened:!0,isMutable:!0}});c.add(U),console.log("[create swap] poolMint = ",u.publicKey.toBase58()),c.instructions.length>0&&await A(z(w.connection,o.value,c.instructions,[u]),{onSuccess:()=>{e.poolMint=u.publicKey,m({type:"positive",message:"Pool mint created successfully."})}})}catch(u){console.error(u),m({type:"negative",message:`${u}`})}finally{e.creating=!1}}async function D(){if(!i.value||!o.value)return m({type:"negative",message:"Connect wallet"});if(!e.tokenSwap)return m({type:"negative",message:"Define tokenSwap"});if(!e.poolMint)return m({type:"negative",message:"Define pool mint"});if(!e.tokenA||!e.tokenB)return m({type:"negative",message:"Select tokens"});const f=r.swapClient.swapAuthority(e.tokenSwap.publicKey),c=new G;e.creating=!0;try{const u=await W(w.connection,c,e.poolMint,i.value),y=await W(w.connection,c,new C(e.tokenA.mint),f,i.value,!0),d=await W(w.connection,c,new C(e.tokenB.mint),f,i.value,!0);console.log("[create swap] poolFeeAccount = ",u.toBase58()),console.log("[create swap] swapTokenA = ",y.toBase58()),console.log("[create swap] swapTokenB = ",d.toBase58()),c.instructions.length>0?await A(z(w.connection,o.value,c.instructions),{commitment:"finalized",onSuccess:()=>{e.poolFeeAccount=u,e.swapTokenA=y,e.swapTokenB=d,m({type:"positive",message:"Pool accounts created successfully."})}}):(e.poolFeeAccount=u,e.swapTokenA=y,e.swapTokenB=d)}catch(u){console.error(u),m({type:"negative",message:`${u}`})}finally{e.creating=!1}}async function M(){if(!(!i.value||!o.value||!e.tokenSwap||!e.poolMint||!e.poolFeeAccount||!e.swapTokenA||!e.swapTokenB)){if(!e.tokenA||!e.tokenB)return m({type:"negative",message:"Select tokens"});if(!e.policy)return m({type:"negative",message:"Select policy"});console.log("createTokenSwap: ",{tokenSwap:e.tokenSwap.publicKey.toBase58(),poolMint:e.poolMint.toBase58(),poolFee:e.poolFeeAccount.toBase58(),destination:e.poolFeeAccount.toBase58(),tokenA:e.swapTokenA.toBase58(),tokenB:e.swapTokenB.toBase58(),policy:e.policy.pubkey.toBase58(),curveType:Y.ConstantProduct,curveParameters:[],fees:{tradeFeeNumerator:e.tradeFeeNumerator,tradeFeeDenominator:e.tradeFeeDenominator,ownerTradeFeeNumerator:e.ownerTradeFeeNumerator,ownerTradeFeeDenominator:e.ownerTradeFeeDenominator,ownerWithdrawFeeNumerator:e.ownerWithdrawFeeNumerator,ownerWithdrawFeeDenominator:e.ownerWithdrawFeeDenominator,hostFeeNumerator:e.hostFeeNumerator,hostFeeDenominator:e.hostFeeDenominator}}),e.creating=!0;try{const f=await r.swapClient.createTokenSwap({tokenSwap:e.tokenSwap,poolMint:e.poolMint,poolFee:e.poolFeeAccount,destination:e.poolFeeAccount,tokenA:e.swapTokenA,tokenB:e.swapTokenB,policy:e.policy.pubkey,curveType:Y.ConstantProduct,curveParameters:[],fees:{tradeFeeNumerator:e.tradeFeeNumerator,tradeFeeDenominator:e.tradeFeeDenominator,ownerTradeFeeNumerator:e.ownerTradeFeeNumerator,ownerTradeFeeDenominator:e.ownerTradeFeeDenominator,ownerWithdrawFeeNumerator:e.ownerWithdrawFeeNumerator,ownerWithdrawFeeDenominator:e.ownerWithdrawFeeDenominator,hostFeeNumerator:e.hostFeeNumerator,hostFeeDenominator:e.hostFeeDenominator}});m({type:"positive",message:`Swap Pool created successfully. ${e.tokenSwap?.publicKey.toBase58()}`}),console.log("[create swap] tokenSwap result = ",f)}catch(f){console.error(f),m({type:"negative",message:`${f}`})}finally{e.creating=!1}}}function F(){e.hostFeeNumerator=0,e.hostFeeDenominator=1e3,e.tradeFeeNumerator=0,e.tradeFeeDenominator=1e3,e.ownerTradeFeeNumerator=0,e.ownerTradeFeeDenominator=1e3,e.ownerWithdrawFeeNumerator=0,e.ownerWithdrawFeeDenominator=1e3,e.policy=void 0,e.tokenA=void 0,e.tokenB=void 0,p.name="",p.symbol="",p.metadataUrl=""}return{state:e,metadataState:p,reset:F,generateSwapKeypair:k,createPoolMint:B,createPoolAccounts:D,createTokenSwap:M}}const ze={class:"row"},Je={class:"row q-mt-md"},Xe={class:"q-mt-md"},Ye=l("div",null,"Policy:",-1),Ze={class:"row q-mt-md"},et={class:"row q-mt-md"},tt={class:"row q-mt-md"},ot={class:"row q-mt-md"},at={class:"q-mt-lg row"},nt={class:"q-mt-mt"},st=l("div",{class:"text-subtitle2"}," Token Swap ",-1),lt={style:{"word-break":"break-all"}},rt={key:0},it={class:"q-mt-sm row"},ct={class:"q-mt-xl column"},ut=l("div",null,"LP token metadata",-1),dt={class:"q-mt-xs row"},mt={key:0},pt={class:"q-mt-sm row"},wt={class:"q-mt-xl row"},kt=l("div",{class:"text-warning"}," Top up pool tokenA and tokenB accounts before create pool ",-1),yt={class:"q-mt-xl row"},ft=E({__name:"CreateSwapCard",setup(r){const{state:o,createTokenSwap:i,createPoolAccounts:w,generateSwapKeypair:A,createPoolMint:m,metadataState:e}=Ge(),{handleSearchToken:p,tokens:k}=he(),B=oe(),D=P(()=>B.servicePolicy),M=P(()=>o.tokenA?B.tokenBalance(o.tokenA.mint):0),F=P(()=>o.tokenB?B.tokenBalance(o.tokenB.mint):0);function f(U,n){o[U]=n}const c=N(!1),u=N(!1),y=N("");function d(){y.value&&(o.tokenSwap=le.fromSecretKey(Uint8Array.from(JSON.parse(`[${y.value}]`))))}const S=N("");function I(){S.value&&(o.poolMint=new C(S.value))}return(U,n)=>{const R=Ce,H=Qe,L=Re,Q=Me;return v(),x(ae,{class:"swap-cardswap-widget full-width"},{default:_(()=>[s(J,{class:"swap-card__header"},{default:_(()=>[T(" Create Pool ")]),_:1}),s(J,{class:"swap-card__body"},{default:_(()=>[l("div",ze,[s(R,{options:t(k),token:t(o).tokenA,"swap-token":String(t(o).tokenA?.symbol),onHandleSearchToken:t(p),onSetToken:n[0]||(n[0]=a=>f("tokenA",a))},null,8,["options","token","swap-token","onHandleSearchToken"]),s(H,{class:"q-ml-lg q-mt-xs",balance:t(M),mint:t(o).tokenA?.mint},null,8,["balance","mint"])]),l("div",Je,[s(R,{options:t(k),token:t(o).tokenB,"swap-token":String(t(o).tokenB?.symbol),onHandleSearchToken:t(p),onSetToken:n[1]||(n[1]=a=>f("tokenB",a))},null,8,["options","token","swap-token","onHandleSearchToken"]),s(H,{class:"q-ml-lg q-mt-xs",balance:t(F),mint:t(o).tokenB?.mint},null,8,["balance","mint"])]),l("div",Xe,[Ye,s(Ae,{modelValue:t(o).policy,"onUpdate:modelValue":n[2]||(n[2]=a=>t(o).policy=a),"option-disable":"inactive","popup-content-class":"transition-duration",outlined:"",options:t(D),dense:"","options-dense":!1,"option-value":"mint","option-label":"name"},{selected:_(()=>[t(o).policy?(v(),x(L,{key:t(o).policy.pubkey?.toBase58(),policy:t(o).policy.pubkey,"policy-data":t(o).policy.data},null,8,["policy","policy-data"])):q("",!0)]),option:_(a=>[s(Be,Ve(a.itemProps,{class:"token-select__token"}),{default:_(()=>[(v(),x(L,{key:a.opt.pubkey,policy:a.opt.pubkey,"policy-data":a.opt.data},null,8,["policy","policy-data"]))]),_:2},1040)]),_:1},8,["modelValue","options"])]),l("div",Ze,[s(b,{modelValue:t(o).hostFeeNumerator,"onUpdate:modelValue":n[3]||(n[3]=a=>t(o).hostFeeNumerator=a),class:"q-mr-md",label:"Host fee Numerator"},null,8,["modelValue"]),s(b,{modelValue:t(o).hostFeeDenominator,"onUpdate:modelValue":n[4]||(n[4]=a=>t(o).hostFeeDenominator=a),label:"Host fee Denominator"},null,8,["modelValue"])]),l("div",et,[s(b,{modelValue:t(o).tradeFeeNumerator,"onUpdate:modelValue":n[5]||(n[5]=a=>t(o).tradeFeeNumerator=a),class:"q-mr-md",label:"Trade fee Numerator"},null,8,["modelValue"]),s(b,{modelValue:t(o).tradeFeeDenominator,"onUpdate:modelValue":n[6]||(n[6]=a=>t(o).tradeFeeDenominator=a),label:"Trade fee Denominator"},null,8,["modelValue"])]),l("div",tt,[s(b,{modelValue:t(o).ownerTradeFeeNumerator,"onUpdate:modelValue":n[7]||(n[7]=a=>t(o).ownerTradeFeeNumerator=a),class:"q-mr-md",label:"Owner trade fee Numerator"},null,8,["modelValue"]),s(b,{modelValue:t(o).ownerTradeFeeDenominator,"onUpdate:modelValue":n[8]||(n[8]=a=>t(o).ownerTradeFeeDenominator=a),label:"Owner trade fee Denominator"},null,8,["modelValue"])]),l("div",ot,[s(b,{modelValue:t(o).ownerWithdrawFeeNumerator,"onUpdate:modelValue":n[9]||(n[9]=a=>t(o).ownerWithdrawFeeNumerator=a),class:"q-mr-md",label:"Owner withdraw fee Numerator"},null,8,["modelValue"]),s(b,{modelValue:t(o).ownerWithdrawFeeDenominator,"onUpdate:modelValue":n[10]||(n[10]=a=>t(o).ownerWithdrawFeeDenominator=a),label:"Owner withdraw fee Denominator"},null,8,["modelValue"])]),l("div",at,[s(V,{class:"q-ml-auto",onClick:t(A)},{default:_(()=>[T(" Generate Swap Keypair ")]),_:1},8,["onClick"])]),l("div",nt,[st,l("div",null,"Public key: "+g(t(o).tokenSwap?.publicKey.toBase58()),1),l("div",lt," Secret key: "+g(t(o).tokenSwap?.secretKey.toString()),1),t(o).tokenSwap?(v(),h("div",rt,[s(Q,{text:t(o).tokenSwap.secretKey.toString()},null,8,["text"]),T(" Copy Token Swap secret key ")])):q("",!0)]),s(X,{modelValue:t(c),"onUpdate:modelValue":n[12]||(n[12]=a=>K(c)?c.value=a:null),label:"Set token swap from secret key"},{default:_(()=>[s(b,{modelValue:t(y),"onUpdate:modelValue":n[11]||(n[11]=a=>K(y)?y.value=a:null),class:"q-mr-md",label:"Token Swap Secret"},null,8,["modelValue"]),l("div",it,[s(V,{class:"q-ml-auto",disable:!t(y),onClick:d},{default:_(()=>[T(" Set Swap Keypair ")]),_:1},8,["disable"])])]),_:1},8,["modelValue"]),l("div",ct,[ut,s(b,{modelValue:t(e).name,"onUpdate:modelValue":n[13]||(n[13]=a=>t(e).name=a),class:"q-mr-md",label:"name"},null,8,["modelValue"]),s(b,{modelValue:t(e).symbol,"onUpdate:modelValue":n[14]||(n[14]=a=>t(e).symbol=a),class:"q-mr-md",label:"symbol"},null,8,["modelValue"]),s(b,{modelValue:t(e).metadataUrl,"onUpdate:modelValue":n[15]||(n[15]=a=>t(e).metadataUrl=a),class:"q-mr-md",label:"url"},null,8,["modelValue"]),s(De,{modelValue:t(e).isMutable,"onUpdate:modelValue":n[16]||(n[16]=a=>t(e).isMutable=a),class:"q-mr-md q-mt-sm",size:"lg",label:"is Mutable"},null,8,["modelValue"])]),l("div",dt,[s(V,{class:"q-ml-auto",disable:!!t(o).poolMint,loading:t(o).creating,onClick:t(m)},{default:_(()=>[T(" Create Pool Mint ")]),_:1},8,["disable","loading","onClick"])]),l("div",null,"Pool mint: "+g(t(o).poolMint?.toBase58()),1),t(o).poolMint?(v(),h("div",mt,[s(Q,{text:t(o).poolMint?.toBase58()},null,8,["text"]),T(" Copy Pool Mint public key ")])):q("",!0),s(X,{modelValue:t(u),"onUpdate:modelValue":n[18]||(n[18]=a=>K(u)?u.value=a:null),label:"Set pool mint manually"},{default:_(()=>[s(b,{modelValue:t(S),"onUpdate:modelValue":n[17]||(n[17]=a=>K(S)?S.value=a:null),class:"q-mr-md",label:"Pool Mint"},null,8,["modelValue"]),l("div",pt,[s(V,{class:"q-ml-auto",disable:!t(S),onClick:I},{default:_(()=>[T(" Set Pool Mint ")]),_:1},8,["disable"])])]),_:1},8,["modelValue"]),l("div",wt,[s(V,{class:"q-ml-auto",loading:t(o).creating,onClick:t(w)},{default:_(()=>[T(" Create Pool token accounts ")]),_:1},8,["loading","onClick"])]),l("div",null,"Pool fee account: "+g(t(o).poolFeeAccount?.toBase58()),1),l("div",null,"Pool token A account: "+g(t(o).swapTokenA?.toBase58()),1),l("div",null,"Pool token B account: "+g(t(o).swapTokenB?.toBase58()),1),kt,l("div",yt,[s(V,{class:"q-ml-auto",loading:t(o).creating,onClick:t(i)},{default:_(()=>[T(" Create Pool ")]),_:1},8,["loading","onClick"])])]),_:1})]),_:1})}}}),_t={},vt={class:"main-block row justify-center"};function bt(r,o){const i=ft;return v(),h("div",vt,[s(i,{class:"q-mt-md"})])}const At=Ne(_t,[["render",bt]]);export{At as default};
